<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUKESH ALGO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
               /* ===== GLOBAL ===== */
               :root {
                  --top-offset: 140px;
                    --sidebar-width: 220px;
                    --primary-color: #007bff;
                    --secondary-color: #0056b3;
                    --success-color: #00ff00;
                    --danger-color: #ff0000;
                    --warning-color: #ff9900;
                    --info-color: #00ccff;
                    --purple-color: #9d4edd;
                    --dark-bg: #0d0d0d;
                    --panel-bg: #141414;
                    --border-color: #222;
                    --accent-color: #00ccff;
                }

                *{
                  box-sizing: border-box;
                  margin: 0;
                  padding: 0;
                }


                body {
                  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                  background: var(--dark-bg);
                  color: #fff;
                    min-height: 100vh;
                    overflow-x: hidden;
                }


                .hidden { display: none !important; }
                .content-page { content-visibility: auto; contain-intrinsic-size: 0 500px; }
                .content-page.hidden { content-visibility: hidden; }
                * { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }


                /* ===== HEADER ===== */
                .header {
                  background: linear-gradient(135deg, #000 0%, #222 100%);
                  padding: 15px 20px;

                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    position: relative;
                    border-bottom: 2px solid var(--accent-color);
                    height: 100px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    z-index: 1000;
                }

                .app-title {
                  display: flex;
                  align-items: center;
                  gap: 15px;
                }

                .bull, .bear {
                  font-size: 42px;
                  animation: pulse 2s infinite;
                }


                .bull {
                  color: var(--success-color);
                  text-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
                }
                .bear {
                  color: var(--danger-color);
                  text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
                }


                @keyframes pulse {
                 0%, 100% { transform: scale(1); }
                    50% { transform: scale(1.1); }
                }

                .title-text {
                   font-size: 46px;
                   font-weight: 900;
                   letter-spacing: 3px;
                   background: linear-gradient(90deg, #00ffcc, #00ff00, #00ccff, #ff00ff);
                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;
                    background-clip: text;
                    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
                }


                /* ===== LIVE WATCH ===== */
                .live-watch-container {
                    position: absolute;
                    right: 20px;
                    top: 50%;
                    transform: translateY(-50%);
                    text-align: center;
                }

                .live-watch {
                    font-size: 14px;
                    color: #aaa;
                    margin-bottom: 2px;
                }

                .digital-clock {
                   font-size: 22px;
                   font-weight: bold;
                    color: var(--accent-color);
                    text-shadow: 0 0 10px rgba(0, 204, 255, 0.5);
                    background: rgba(0, 0, 0, 0.3);
                    padding: 5px 12px;
                    border-radius: 8px;
                    border: 1px solid rgba(0, 204, 255, 0.3);
                }


                .user-box {
                  position: absolute;

                    right: 200px;
                    top: 50%;
                    transform: translateY(-50%);
                    text-align: right;
                }


                .user-name {
                  font-size: 25px;
                    font-weight: bold;
                    color: #fff;
                    margin-bottom: 5px;
                }

                .pl-box {
                   margin-top: 6px;
                   padding: 8px 16px;
                   font-size: 20px;
                   font-weight: bold;
                   border-radius: 10px;
                   background: linear-gradient(135deg, #111 0%, #333 100%);
                   display: inline-block;
                   transition: all 0.3s ease;
                   border: 1px solid rgba(255, 255, 255, 0.1);
                   box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
                }

                /* ===== ENHANCED HORIZONTAL MARKET TICKER ===== */
                .market-ticker-container {
                  background: linear-gradient(90deg, #111 0%, #222 50%, #111 100%);
                    padding: 10px 0;
                    border-bottom: 2px solid rgba(0, 204, 255, 0.5);
                    overflow: hidden;
                    position: fixed;
                    top: 100px;
                    left: 0;
                    right: 0;
                    height: 60px;
                    z-index: 999;
                }

                .ticker-header {
                   position: absolute;
                   left: 0;
                   top: 0;
                    background: linear-gradient(90deg, #ff0000, #ff9900);
                    color: white;
                    padding: 10px 20px;
                    font-weight: bold;
                    z-index: 10;
                    border-right: 2px solid rgba(255,255,255,0.3);
                }

                .market-ticker {
                  display: flex;
                  animation: tickerScroll 30s linear infinite;
                  white-space: nowrap;
                  padding-left: 120px;
                }

                .ticker-item-horizontal {
                   display: flex;
                   align-items: center;
                   padding: 0 25px;
                   border-right: 1px solid rgba(255, 255, 255, 0.1);
                   background: rgba(0, 0, 0, 0.3);
                   margin: 5px 0;
                   border-radius: 5px;
                   position: relative;
                    transition: all 0.3s ease;
                }

                .ticker-item-horizontal:hover {
                    background: rgba(0, 204, 255, 0.2);
                    transform: scale(1.05);
                }


                .ticker-symbol {
                   color: #fff;

                    font-weight: bold;
                    margin-right: 8px;
                    min-width: 80px;
                    font-size: 16px;
                }


                .ticker-price {
                   color: var(--success-color);
                    font-weight: bold;
                    font-size: 18px;
                    margin-right: 5px;
                    text-shadow: 0 0 5px currentColor;
                }

                .ticker-change {
                   color: var(--danger-color);
                   font-size: 14px;
                   font-weight: bold;
                   padding: 2px 8px;
                   border-radius: 3px;
                   background: rgba(0,0,0,0.3);
                }

                .positive {
                  color: var(--success-color) !important;
                  background: rgba(0, 255, 0, 0.1) !important;
                }
                .negative {
                  color: var(--danger-color) !important;
                    background: rgba(255, 0, 0, 0.1) !important;
                }

                .delete-ticker {
                    background: rgba(255, 0, 0, 0.7);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 20px;
                    height: 20px;

                    margin-left: 10px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: bold;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    opacity: 0;
                    transition: all 0.3s ease;
                }


                .ticker-item-horizontal:hover .delete-ticker {
                   opacity: 1;
                }

                .delete-ticker:hover {
                  background: rgba(255, 0, 0, 1);
                  transform: scale(1.2);
                }

                @keyframes tickerScroll {
                  0% { transform: translateX(0); }
                  100% { transform: translateX(-50%); }
                }


                /* ===== SEPARATED NAVIGATION POPUP (LEFT SIDE) ===== */
                .nav-hover-trigger {
                  position: fixed;
                  top: 180px;
                    left: 0;
                    background: linear-gradient(135deg, var(--accent-color), #0066cc);
                    color: white;
                    border: none;
                    padding: 12px 15px;
                    border-radius: 0 10px 10px 0;
                    cursor: pointer;
                    z-index: 999;
                    font-size: 20px;
                    transition: all 0.3s ease;

                    box-shadow: 2px 0 10px rgba(0,0,0,0.3);
                }

                .nav-hover-trigger:hover {
                  padding-left: 20px;
                    background: linear-gradient(135deg, #00ccff, #0099ff);
                }

                .nav-popup {
                  position: fixed;
                  top: 180px;
                  left: -300px;
                  width: 300px;
                  background: linear-gradient(180deg, #141414 0%, #1a1a1a 100%);
                  border-radius: 0 15px 15px 0;
                  padding: 15px 10px;
                  overflow-y: auto;
                  border-right: 2px solid rgba(0, 204, 255, 0.5);
                  border-bottom: 2px solid rgba(0, 204, 255, 0.5);
                  border-top: 2px solid rgba(0, 204, 255, 0.5);
                  box-shadow: 5px 5px 15px rgba(0, 0, 0, 0.5);
                  transition: left 0.3s ease;
                  z-index: 998;
                  max-height: 80vh;
                }

                .nav-popup.show {
                  left: 0;
                }


                .nav-popup-header {
                  color: var(--accent-color);
                  font-size: 18px;
                    font-weight: bold;
                    margin-bottom: 15px;
                    padding-bottom: 10px;
                    border-bottom: 2px solid rgba(0, 204, 255, 0.5);
                    text-align: center;
                    text-transform: uppercase;

                    letter-spacing: 2px;
                    cursor: pointer;
                    user-select: none;
                }


                .nav-popup button {
                  width: 100%;
                  margin-bottom: 8px;
                    padding: 12px 15px;
                    background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    color: #fff;
                    cursor: pointer;
                    border-radius: 8px;
                    font-size: 14px;
                    text-align: left;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    position: relative;
                    overflow: hidden;
                }


                .nav-popup button::before {
                  content: '';
                  position: absolute;
                  left: 0;
                  top: 0;
                    width: 5px;
                    height: 100%;
                    background: var(--accent-color);
                    transform: scaleY(0);
                    transition: transform 0.3s ease;
                }


                .nav-popup button i {
                  font-size: 16px;
                  width: 20px;

                    text-align: center;
                    color: var(--accent-color);
                }

                .nav-popup button:hover {
                    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%)
                    transform: translateX(5px);
                    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
                }

                .nav-popup button:hover::before {
                  transform: scaleY(1);
                }

                .nav-popup button.active {
                  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%)
                  border-color: var(--accent-color);
                }

                .nav-popup button.active::before {
                  transform: scaleY(1);
                }

                /* ===== BROKER-STYLE WATCHLIST PANEL ===== */
                .watchlist-panel {
                    position: fixed;
                    top: 160px;
                    right: 0;
                    width: 320px;
                    height: calc(100vh - 160px);
                    background: #1a1a2e;
                    border-left: 1px solid #2a2a3e;
                    z-index: 997;
                    display: flex;
                    flex-direction: column;
                    box-shadow: -2px 0 10px rgba(0,0,0,0.3);
                }

                .wl-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 10px 12px;
                    border-bottom: 1px solid #2a2a3e;
                    background: #141428;
                }

                .wl-header-left {
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .wl-title {
                    color: #fff;
                    font-size: 13px;
                    font-weight: 600;
                    letter-spacing: 0.5px;
                }

                .wl-count {
                    background: #2a2a3e;
                    color: #888;
                    font-size: 11px;
                    padding: 2px 6px;
                    border-radius: 3px;
                }

                .wl-header-right {
                    display: flex;
                    gap: 4px;
                }

                .wl-icon-btn {
                    background: none;
                    border: none;
                    color: #666;
                    cursor: pointer;
                    padding: 4px 6px;
                    border-radius: 3px;
                    font-size: 13px;
                    transition: all 0.2s;
                }

                .wl-icon-btn:hover {
                    color: #fff;
                    background: #2a2a3e;
                }

                .wl-search-container {
                    position: relative;
                    padding: 8px 12px;
                    border-bottom: 1px solid #2a2a3e;
                }

                .wl-search-icon {
                    position: absolute;
                    left: 20px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #555;
                    font-size: 12px;
                }

                .wl-search-input {
                    width: 100%;
                    padding: 8px 10px 8px 30px;
                    background: #222240;
                    border: 1px solid #333;
                    color: #fff;
                    border-radius: 4px;
                    font-size: 12px;
                    box-sizing: border-box;
                    outline: none;
                    transition: border-color 0.2s;
                }

                .wl-search-input:focus {
                    border-color: var(--accent-color);
                }

                .wl-search-input::placeholder {
                    color: #555;
                    font-size: 11px;
                }

                .wl-search-results {
                    position: absolute;
                    top: 100%;
                    left: 12px;
                    right: 12px;
                    background: #1e1e36;
                    border: 1px solid #333;
                    border-radius: 0 0 4px 4px;
                    max-height: 200px;
                    overflow-y: auto;
                    z-index: 1000;
                }

                .wl-search-result-item {
                    padding: 8px 12px;
                    cursor: pointer;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #2a2a3e;
                    font-size: 12px;
                }

                .wl-search-result-item:hover {
                    background: #2a2a4e;
                }

                .wl-search-result-item .sr-symbol {
                    color: #fff;
                    font-weight: 600;
                }

                .wl-search-result-item .sr-name {
                    color: #888;
                    font-size: 11px;
                }

                .wl-search-result-item .sr-exchange {
                    background: #333;
                    color: #aaa;
                    padding: 1px 5px;
                    border-radius: 2px;
                    font-size: 10px;
                }

                .wl-tabs {
                    display: flex;
                    border-bottom: 1px solid #2a2a3e;
                    background: #141428;
                }

                .wl-tab {
                    flex: 1;
                    padding: 8px 4px;
                    background: none;
                    border: none;
                    border-bottom: 2px solid transparent;
                    color: #666;
                    cursor: pointer;
                    font-size: 11px;
                    font-weight: 500;
                    transition: all 0.2s;
                    text-align: center;
                }

                .wl-tab:hover {
                    color: #aaa;
                }

                .wl-tab.active {
                    color: var(--accent-color);
                    border-bottom-color: var(--accent-color);
                }

                .wl-stocks-list {
                    flex: 1;
                    overflow-y: auto;
                    overflow-x: hidden;
                }

                .wl-stocks-list::-webkit-scrollbar {
                    width: 4px;
                }

                .wl-stocks-list::-webkit-scrollbar-thumb {
                    background: #333;
                    border-radius: 2px;
                }

                .wl-item {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 8px 12px;
                    border-bottom: 1px solid #1e1e36;
                    cursor: pointer;
                    transition: background 0.15s;
                    position: relative;
                }

                .wl-item:hover {
                    background: #222240;
                }

                .wl-item-left {
                    display: flex;
                    flex-direction: column;
                    gap: 2px;
                    min-width: 0;
                    flex: 1;
                }

                .wl-item-symbol {
                    color: #fff;
                    font-size: 13px;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 6px;
                }

                .wl-item-exchange {
                    background: #2a2a3e;
                    color: #888;
                    padding: 1px 4px;
                    border-radius: 2px;
                    font-size: 9px;
                    font-weight: 400;
                }

                .wl-item-exchange.exchange-nfo {
                    background: rgba(156, 78, 221, 0.25);
                    color: #b388ff;
                }

                .wl-item-exchange.exchange-bse {
                    background: rgba(255, 152, 0, 0.2);
                    color: #ffb74d;
                }

                .wl-item-name {
                    color: #666;
                    font-size: 10px;
                    white-space: nowrap;
                    overflow: hidden;
                    text-overflow: ellipsis;
                }

                .wl-item-right {
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    gap: 2px;
                    min-width: 90px;
                }

                .wl-item-price {
                    font-size: 13px;
                    font-weight: 600;
                }

                .wl-item-change {
                    font-size: 11px;
                    display: flex;
                    gap: 6px;
                }

                .wl-item-change .change-abs {
                    font-weight: 500;
                }

                .wl-item-change .change-pct {
                    font-weight: 500;
                }

                .wl-positive .wl-item-price { color: #00cc66; }
                .wl-positive .wl-item-change { color: #00cc66; }
                .wl-negative .wl-item-price { color: #ff4444; }
                .wl-negative .wl-item-change { color: #ff4444; }
                .wl-neutral .wl-item-price { color: #fff; }
                .wl-neutral .wl-item-change { color: #888; }

                /* Hover action buttons overlay */
                .wl-item-actions {
                    display: none;
                    position: absolute;
                    right: 8px;
                    top: 50%;
                    transform: translateY(-50%);
                    gap: 4px;
                    z-index: 10;
                }

                .wl-item:hover .wl-item-actions {
                    display: flex;
                }

                .wl-item:hover .wl-item-right {
                    visibility: hidden;
                }

                .wl-action-buy {
                    background: #00cc66;
                    color: #fff;
                    border: none;
                    padding: 4px 10px;
                    border-radius: 3px;
                    font-size: 11px;
                    font-weight: 700;
                    cursor: pointer;
                    transition: background 0.15s;
                }

                .wl-action-buy:hover { background: #00aa55; }

                .wl-action-sell {
                    background: #ff4444;
                    color: #fff;
                    border: none;
                    padding: 4px 10px;
                    border-radius: 3px;
                    font-size: 11px;
                    font-weight: 700;
                    cursor: pointer;
                    transition: background 0.15s;
                }

                .wl-action-sell:hover { background: #dd3333; }

                .wl-action-more {
                    background: #333;
                    color: #fff;
                    border: none;
                    padding: 4px 6px;
                    border-radius: 3px;
                    font-size: 11px;
                    cursor: pointer;
                    transition: background 0.15s;
                }

                .wl-action-more:hover { background: #444; }

                .wl-action-delete {
                    background: none;
                    border: none;
                    color: #ff4444;
                    cursor: pointer;
                    padding: 4px 6px;
                    font-size: 12px;
                    border-radius: 3px;
                    transition: all 0.15s;
                }

                .wl-action-delete:hover { background: rgba(255,68,68,0.15); }

                /* Pagination */
                .wl-pagination {
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    gap: 4px;
                    padding: 8px 12px;
                    border-top: 1px solid #2a2a3e;
                    background: #141428;
                }

                .wl-page-btn {
                    background: none;
                    border: 1px solid #333;
                    color: #888;
                    width: 28px;
                    height: 28px;
                    border-radius: 3px;
                    cursor: pointer;
                    font-size: 11px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    transition: all 0.2s;
                }

                .wl-page-btn:hover {
                    border-color: var(--accent-color);
                    color: #fff;
                }

                .wl-page-btn.active {
                    background: var(--accent-color);
                    border-color: var(--accent-color);
                    color: #fff;
                }

                .wl-empty {
                    text-align: center;
                    color: #555;
                    padding: 30px 15px;
                    font-size: 12px;
                }

                /* ===== LARGER CONTENT (ADJUSTED FOR WATCHLIST PANEL) ===== */
                .content {
                  margin-top: 160px;
                    margin-left: 0;
                    margin-right: 320px; /* Space for watchlist panel */
                    padding: 20px;
                    min-height: calc(100vh - var(--top-offset));
                    transition: all 0.3s ease;
                    overflow: auto;
                    position: relative;
                    width: calc(100% - 320px); /* Adjusted for watchlist panel */
                    height: calc(100vh - 160px);
                    overflow-y: auto;

                    overflow-x: hidden;
                }

                /* ===== ENHANCED OPEN POSITIONS CONTAINER ===== */
                .open-positions-container {
                    display: flex;
                    gap: 20px;
                    min-height: calc(100vh - var(--top-offset) - 40px);
                    height: auto;
                    width: 100%;
                    overflow: visible;
                }

                /* ===== ENHANCED POSITIONS MAIN CONTENT ===== */
                .positions-main {
                  flex: 1;
                  background: #1a1a1a;
                  border-radius: 10px;
                  padding: 25px;
                  border: 1px solid #333;
                  min-height: calc(100vh - 220px);
                  overflow: auto;
                }


                .positions-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 25px;
                }

                .positions-header h2 {
                  color: var(--accent-color);
                    font-size: 28px;
                    margin: 0;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .add-position-btn {
                  background: linear-gradient(135deg, #00cc00, #009900);
                  color: white;
                  border: none;
                    padding: 12px 24px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                }

                .add-position-btn:hover {
                  background: linear-gradient(135deg, #00ff00, #00cc00);
                }

                /* Table Styles */
                .positions-table {
                  width: 100%;
                  border-collapse: collapse;
                  background: #2b2b2b;
                  font-size: 14px;
                  min-width: 1500px;
                }

                .positions-table th {
                    background: #4a4a4a;
                    padding: 15px 10px;
                    border: 1px solid #555;
                    text-align: center;
                    font-weight: bold;
                    color: var(--accent-color);
                    font-size: 15px;
                    white-space: nowrap;
                }

                .positions-table td {
                  padding: 12px 10px;
                  border: 1px solid #555;
                  text-align: center;
                  font-size: 14px;
                }

                .positions-table tr:hover {
                    background: #3a3a3a;
                }


                /* Order Type Styling */
                .order-type-buy {
                  background: #00aa66;
                  color: #fff;
                  padding: 6px 10px;
                  border-radius: 4px;
                  font-size: 12px;
                  font-weight: bold;
                }

                .order-type-sell {
                  background: #ff4444;
                  color: #fff;
                  padding: 6px 10px;
                  border-radius: 4px;
                  font-size: 12px;
                  font-weight: bold;
                }


                /* Order Condition Styling */
                .order-condition {
                  padding: 6px 10px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: bold;
                }

                .condition-intraday {

                    background: #0077ff;
                    color: #fff;
                }

                .condition-positional {
                    background: #aa00ff;
                    color: #fff;
                }


                .condition-bo {
                  background: #ff8800;
                  color: #fff;
                }

                .condition-st {
                  background: #ff0088;
                  color: #fff;
                }

                .condition-msl {
                  background: #008888;
                  color: #fff;
                }


                /* Qty Columns */
                .buy-qty {
                  color: #00ff88;
                  font-weight: bold;
                }


                .sell-qty {
                   color: #ff4444;
                   font-weight: bold;
                }

                /* P&L Colors */
                .pl-positive {
                   color: #00ff88;
                   font-weight: bold;

                }

                .pl-negative {
                   color: #ff4444;
                   font-weight: bold;
                }

                /* Symbol Quick Menu */
                .symbol-cell {
                   position: relative;
                   cursor: pointer;
                }

                .quick-popup {
                  position: absolute;
                  top: 100%;
                  left: 0;
                  background: #1f1f1f;
                  padding: 8px;
                  border-radius: 5px;
                  display: none;
                  gap: 4px;
                  z-index: 100;
                }


                .symbol-cell:hover .quick-popup {
                   display: flex;
                }


                .q-btn {
                   padding: 6px 10px;
                   font-size: 12px;
                   border: none;
                    border-radius: 3px;
                    cursor: pointer;
                    color: #fff;
                }

                .q-btn.buy {

                    background: #00aa66;
                }

                .q-btn.sell {
                   background: #ff4444;
                }

                .q-btn.chart {
                    background: #0077ff;
                }


                .q-btn.depth {
                   background: #888;
                }

                .q-btn.delete-btn-main {
                   background: #aa0000;
                }

                .q-btn.more {
                   background: #555;
                   position: relative;
                }


                .more-menu-main {
                  position: absolute;
                  top: 100%;
                  left: 0;
                  background: #111;
                    display: none;
                    border-radius: 4px;
                }


                .more-menu-main div {
                  padding: 8px 12px;
                  font-size: 12px;
                    cursor: pointer;
                }

                .more-menu-main div:hover {
                  background: #444;
                }

                .q-btn.more:hover .more-menu-main {
                    display: block;
                }

                /* Source Menu */
                .source-wrap {
                  position: relative;
                }

                .source-btn {
                  background: #0077ff;
                  border: none;
                  color: #fff;
                  padding: 6px 12px;
                  border-radius: 4px;
                  cursor: pointer;
                  font-size: 12px;
                }

                .source-menu {
                  position: absolute;
                  top: 100%;
                  left: 0;
                  background: #1f1f1f;
                  display: none;
                }

                .source-menu div {
                  padding: 8px 12px;
                    font-size: 12px;
                    cursor: pointer;
                }


                .source-menu div:hover {
                  background: #444;

                }

                .source-wrap:hover .source-menu {
                  display: block;
                }


                /* Action Button */
                .action-btn {
                    background: #555;
                    border: none;
                    color: #fff;
                    padding: 8px 12px;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 12px;
                    font-weight: bold;
                }

                .action-btn:hover {
                  background: #666;
                }

                /* ===== LARGER MODALS ===== */
                .modal {
                  position: fixed;
                  inset: 0;
                  background: rgba(0, 0, 0, 0.8);
                  display: none;
                  justify-content: center;
                    align-items: center;
                    z-index: 9999;
                    overflow: auto;
                    padding: 20px;
                }

                .modal-box {
                    width: 600px;
                    max-width: 95%;
                    max-height: 90vh;

                    background: #2f2f2f;
                    border-radius: 10px;
                    padding: 20px;
                    border: 2px solid var(--accent-color);
                    overflow-y: auto;
                    overflow-x: hidden;
                }

                .modal-header {
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 20px;
                }

                .modal-header h3 {
                  margin: 0;
                  font-size: 22px;
                  color: var(--accent-color);
                }

                .modal-header button {
                  background: none;
                  border: none;
                  color: #fff;
                  font-size: 24px;
                  cursor: pointer;
                }


                .tabs {
                   display: flex;
                   margin-top: 10px;
                   background: #333;
                    border-radius: 5px;
                    overflow: hidden;
                }


                .tabs button {
                   flex: 1;

                    background: none;
                    border: none;
                    padding: 12px;
                    color: #fff;
                    cursor: pointer;
                    font-size: 14px;
                    transition: all 0.3s ease;
                }


                .tabs button:hover {
                   background: #444;
                }

                .tabs button.active {
                   background: #0077ff;
                   font-weight: bold;
                }

                .tab-content {
                   display: none;
                   margin-top: 15px;
                }

                .tab-content.active {
                   display: block;
                }

                .modal-box input,
                .modal-box select,
                .modal-box textarea {
                  width: 100%;
                  padding: 10px;
                  margin: 8px 0;
                    background: #444;
                    border: none;
                    color: #fff;
                    font-size: 14px;
                    border-radius: 4px;
                }

                .modal-box textarea {
                  height: 120px;
                  resize: vertical;
                  font-family: 'Courier New', monospace;
                }

                .full-btn {
                    width: 100%;
                    padding: 12px;
                    margin-top: 15px;
                    border: none;
                    color: #fff;
                    cursor: pointer;
                    font-size: 16px;
                    font-weight: bold;
                    border-radius: 4px;
                }

                .success {
                  background: #00aa66;
                }

                .danger {
                  background: #ff4444;
                }

                .info {
                   background: #0077ff;
                }

                /* ===== NEW POSITION SECTION STYLES ===== */
                .position-section {
                    margin: 15px 0;
                    background: #222;
                    border-radius: 8px;
                    border-left: 4px solid var(--accent-color);
                    overflow: hidden;
                }

                .position-section-header {
                  padding: 15px 20px;
                  background: rgba(0, 204, 255, 0.1);
                  display: flex;
                    justify-content: space-between;
                    align-items: center;
                    cursor: pointer;
                    user-select: none;
                }


                .position-section-header h4 {
                  color: var(--accent-color);
                  margin: 0;
                  display: flex;
                  align-items: center;
                  gap: 8px;
                  font-size: 16px;
                }

                .position-section-toggle {
                  background: none;
                  border: none;
                  color: var(--accent-color);
                  cursor: pointer;
                  font-size: 14px;
                  padding: 6px 10px;
                  border-radius: 3px;
                  transition: all 0.3s ease;
                }

                .position-section-toggle:hover {
                  background: rgba(0, 204, 255, 0.2);
                }

                .position-section-body {
                    padding: 20px;
                    max-height: 400px;
                    overflow-y: auto;

                    transition: all 0.3s ease;
                }

                .position-section-body.collapsed {
                  display: none;
                }

                /* ===== ENABLE/DISABLE OPTIONS WITH MOUSE CLICK ===== */
                .enable-option {
                  background: rgba(0, 204, 255, 0.1);
                  padding: 12px 15px;
                  border-radius: 5px;
                  margin: 10px 0;
                  cursor: pointer;
                  transition: all 0.3s ease;
                  border-left: 4px solid transparent;
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                }

                .enable-option:hover {
                  background: rgba(0, 204, 255, 0.2);
                  border-left-color: var(--accent-color);
                }

                .enable-option.active {
                  background: rgba(0, 204, 255, 0.3);
                  border-left-color: var(--success-color);
                }

                .enable-status {
                  width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }

                .enable-status.enabled {
                  background: var(--success-color);
                  color: #000;
                }


                .enable-status.disabled {
                  background: var(--danger-color);
                    color: #fff;
                }


                /* ===== PARTITION & ADD QUANTITY SECTION STYLES ===== */
                .partition-section {
                  margin: 15px 0;
                  background: #222;
                  border-radius: 8px;
                  border-left: 4px solid var(--warning-color);
                  overflow: hidden;
                }

                .partition-section-header {
                  padding: 15px 20px;
                  background: rgba(255, 153, 0, 0.1);
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  cursor: pointer;
                  user-select: none;
                }


                .partition-section-header h4 {
                  color: var(--warning-color);
                  margin: 0;
                    display: flex;
                    align-items: center;
                    gap: 8px;
                    font-size: 16px;
                }

                .partition-section-toggle {
                  background: none;
                  border: none;
                  color: var(--warning-color);
                  cursor: pointer;
                    font-size: 14px;
                    padding: 6px 10px;
                    border-radius: 3px;
                    transition: all 0.3s ease;
                }


                .partition-section-toggle:hover {
                  background: rgba(255, 153, 0, 0.2);
                }

                .partition-section-body {
                  padding: 20px;
                  transition: all 0.3s ease;
                }

                .partition-section-body.collapsed {
                  display: none;
                }


                .partition-grid {
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 20px;
                }


                .partition-column {
                  display: flex;
                  flex-direction: column;
                    gap: 15px;
                }


                .partition-item {
                  background: #333;
                  padding: 15px;

                    border-radius: 5px;
                    border: 1px solid #444;
                }

                .partition-item h5 {
                    color: var(--accent-color);
                    font-size: 14px;
                    margin-bottom: 10px;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                }

                .partition-row {
                  display: grid;
                  grid-template-columns: 1fr 1fr;
                  gap: 10px;
                }

                /* ===== ENHANCED SCROLLING ===== */
                .content::-webkit-scrollbar {
                  width: 12px;
                }


                .content::-webkit-scrollbar-track {
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 5px;
                }


                .content::-webkit-scrollbar-thumb {
                  background: linear-gradient(135deg, var(--accent-color), #0066cc);
                  border-radius: 5px;
                }


                .content::-webkit-scrollbar-thumb:hover {
                  background: linear-gradient(135deg, #00ccff, #0099ff);
                }

                /* Position Section Scrollbar */

                .position-section-body::-webkit-scrollbar {
                  width: 8px;
                }

                .position-section-body::-webkit-scrollbar-track {
                    background: rgba(0, 0, 0, 0.2);
                    border-radius: 3px;
                }


                .position-section-body::-webkit-scrollbar-thumb {
                  background: var(--accent-color);
                  border-radius: 3px;
                }

                /* Watchlist Scrollbar */
                .watchlist-panel .watchlist-stocks::-webkit-scrollbar {
                  width: 6px;
                }

                .watchlist-panel .watchlist-stocks::-webkit-scrollbar-track {
                  background: rgba(0, 0, 0, 0.3);
                  border-radius: 3px;
                }


                .watchlist-panel .watchlist-stocks::-webkit-scrollbar-thumb {
                  background: #0077ff;
                  border-radius: 3px;
                }


                /* Modal Scrollbar */
                .modal-box::-webkit-scrollbar {
                  width: 8px;
                }


                .modal-box::-webkit-scrollbar-track {
                  background: rgba(0, 0, 0, 0.2);
                    border-radius: 3px;
                }

                .modal-box::-webkit-scrollbar-thumb {
                  background: var(--warning-color);
                  border-radius: 3px;
                }


                /* ===== RESPONSIVE ===== */
                @media (max-width: 1200px) {
                  .open-positions-container {
                        flex-direction: column;
                    }


                    .positions-main {
                      min-height: auto;
                    }
                }

                @media (max-width: 1100px) {
                 .watchlist-panel {
                   width: 280px;
                 }

                    .content {
                      margin-right: 280px;
                      width: calc(100% - 280px);
                    }
                }

                @media (max-width: 900px) {
                 .content {
                        margin-top: 160px;
                        padding: 15px;
                    }


                    .watchlist-panel {
                      display: none; /* Hide watchlist on smaller screens */
                    }


                    .content {
                      margin-right: 0;

                        width: 100%;
                    }

                    .nav-hover-trigger {
                      top: 160px;
                        padding: 10px 12px;
                        font-size: 18px;
                    }


                    .nav-popup {
                      top: 160px;
                      width: 250px;
                    }
                }

                @media (max-width: 768px) {
                 .header {
                   flex-direction: column;
                   height: auto;
                   padding: 15px;
                 }

                    .app-title {
                      margin-bottom: 15px;
                    }

                    .live-watch-container {
                        position: relative;
                        right: auto;
                        top: auto;
                        transform: none;
                        margin: 10px 0;
                    }


                    .user-box {
                      position: relative;
                        right: auto;
                        top: auto;
                        transform: none;

                        text-align: center;
                        margin-top: 10px;
                    }

                    .content {
                        margin: 10px;
                        margin-top: 160px;
                    }


                    .nav-popup button {
                      padding: 10px 12px;
                      font-size: 13px;
                    }

                    .positions-table {
                      font-size: 12px;
                    }

                    .positions-table th,
                    .positions-table td {
                      padding: 8px 6px;
                    }

                    .q-btn {
                       padding: 5px 8px;
                       font-size: 11px;
                    }

                    .modal-box {
                        width: 95%;
                        margin: 10px;
                    }


                    .section-grid,
                    .partition-grid {
                       grid-template-columns: 1fr;
                    }

                    .position-row {

                        flex-direction: column;
                        align-items: flex-start;
                    }

                    .position-toggle {
                        width: 100%;
                        justify-content: space-between;
                    }


                    .position-controls {
                      width: 100%;
                    }
                }

                @media (max-width: 480px) {
                 .title-text {
                    font-size: 32px;
                 }

                    .bull, .bear {
                      font-size: 32px;
                    }

                    .user-name {
                      font-size: 20px;
                    }

                    .pl-box {
                       font-size: 16px;
                        padding: 6px 12px;
                    }

                    .partition-row {
                        grid-template-columns: 1fr;
                    }


                    .nav-popup {
                      width: 220px;
                    }

                }
             </style>
</head>
<body>
    <!-- ===== HEADER ===== -->
    <div class="header">
        <div class="app-title">
            <span class="bull">&#x1F402;</span>
            <span class="title-text">MUKESH ALGO</span>
            <span class="bear">&#x1F43B;</span>
        </div>

        <!-- USER BOX -->
        <div class="user-box">
            <div class="user-name">Mukeshbhai</div>
            <div class="pl-box" id="plBox">P/L : 1,25,430</div>
        </div>

        <!-- LIVE WATCH -->
        <div class="live-watch-container">
            <div class="live-watch">LIVE</div>
            <div class="digital-clock" id="digitalClock">00:00:00</div>
        </div>
    </div>

    <!-- ===== ENHANCED HORIZONTAL MARKET TICKER ===== -->
    <div class="market-ticker-container">
        <div class="ticker-header">LIVE MARKET</div>
        <div class="market-ticker" id="marketTicker">
            <!-- Ticker items will be populated by JavaScript -->
        </div>
    </div>

    <!-- ===== SEPARATE NAVIGATION POPUP (LEFT SIDE) ===== -->
    <button class="nav-hover-trigger" id="navHoverTrigger" onmouseenter="showNavPopup()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="nav-popup" id="navPopup" onmouseleave="hideNavPopup()">
        <div class="nav-popup-header">
            <i class="fas fa-bars"></i> NAVIGATION
        </div>
        <button onclick="showPage('openPositionsPage')">
            <i class="fas fa-chart-line"></i> Open Positions
        </button>
        <button onclick="showPage('orderbookPage')">
            <i class="fas fa-book"></i> Order Book
        </button>
        <button onclick="showPage('screenerPage')">
            <i class="fas fa-search"></i> Screener
        </button>
        <button onclick="showPage('strategyCreationPage')">
            <i class="fas fa-chess-board"></i> Strategy Creation
        </button>
        <button onclick="showPage('reportPage')">
            <i class="fas fa-chart-bar"></i> Reports
        </button>
        <button onclick="showPage('profilePage')">
            <i class="fas fa-user"></i> Profile
        </button>
        <button onclick="showPage('brokerPage')">
            <i class="fas fa-university"></i> Broker
        </button>
        <button onclick="showPage('marketplacePage')">
            <i class="fas fa-store"></i> Market Place
        </button>
        <button onclick="showPage('paperTradingPage')">
            <i class="fas fa-file-invoice-dollar"></i> Paper Trading
        </button>
        <button onclick="showPage('myPlanPage')">
            <i class="fas fa-calendar-alt"></i> My Plan
        </button>
        <button onclick="showPage('backtestPage')">
            <i class="fas fa-history"></i> Backtest
        </button>
        <button onclick="showPage('settingsPage')">
            <i class="fas fa-cog"></i> Settings
        </button>
        <button onclick="showPage('alPage')">
            <i class="fas fa-robot"></i> AL
        </button>
        <button onclick="showPage('logPage')">
            <i class="fas fa-clipboard-list"></i> Log
        </button>

        <!-- Dashboard Controls -->
        <div style="margin-top: 20px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 5px;">
            <h4 style="color: var(--accent-color); font-size: 14px; margin-bottom: 10px; text-transform: uppercase;">
                <i class="fas fa-expand"></i> VIEW CONTROLS
            </h4>
            <button onclick="fullScreenMode()" style="width:100%; margin-bottom:5px; padding:8px; background: linear-gradient(135deg, #0077ff, #0055cc); border: none; color: #fff; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-expand"></i> Full Screen
            </button>
            <button onclick="resetAllData()" style="width:100%; padding:8px; background: linear-gradient(135deg, #ff4444, #cc0000); border: none; color: #fff; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-redo"></i> Reset Data
            </button>
        </div>

        <button onclick="logOut()" style="margin-top: 20px; width:100%; padding:10px; background: linear-gradient(135deg, #ff4444, #cc0000); border: none; color: #fff; border-radius: 5px; cursor: pointer;">
            <i class="fas fa-sign-out-alt"></i> Log Out
        </button>
    </div>

    <!-- ===== SEPARATE WATCHLIST PANEL (RIGHT SIDE - ALWAYS VISIBLE) ===== -->
    <div class="watchlist-panel" id="watchlistPanel">
        <div class="wl-header">
            <div class="wl-header-left">
                <i class="fas fa-star" style="color: var(--accent-color);"></i>
                <span class="wl-title">WATCHLIST</span>
                <span class="wl-count" id="wlCount">0/50</span>
            </div>
            <div class="wl-header-right">
                <button class="wl-icon-btn" onclick="refreshWatchlist()" title="Refresh"><i class="fas fa-sync-alt"></i></button>
                <button class="wl-icon-btn" onclick="toggleWatchlistSettings()" title="Settings"><i class="fas fa-cog"></i></button>
            </div>
        </div>

        <div class="wl-search-container">
            <i class="fas fa-search wl-search-icon"></i>
            <input id="watchlistSearch" class="wl-search-input" placeholder="Search eg: INFY, NIFTY FUT, NIFTY 25000 CE" autocomplete="off">
            <div class="wl-search-results" id="wlSearchResults" style="display:none;"></div>
        </div>

        <div class="wl-tabs">
            <button class="wl-tab active" data-tab="watchlist" onclick="switchWatchlistTab('watchlist')">Watchlist</button>
            <button class="wl-tab" data-tab="predefined" onclick="switchWatchlistTab('predefined')">Predefined</button>
            <button class="wl-tab" data-tab="optionchain" onclick="switchWatchlistTab('optionchain')">Option Chain</button>
        </div>

        <div class="wl-stocks-list" id="watchlistStocks">
            <div class="wl-empty">No stocks in watchlist. Search and add stocks above.</div>
        </div>

        <div class="wl-pagination" id="wlPagination"></div>
    </div>

    <!-- ===== MAIN CONTENT ===== -->
    <div class="content" id="mainContent">
        <!-- Open Positions Page -->
        <div class="content-page" id="openPositionsPage">
            <div class="open-positions-container">
                <div class="positions-main">
                    <div class="positions-header">
                        <h2><i class="fas fa-chart-line"></i> Open Positions</h2>
                        <button class="add-position-btn" onclick="openAddPositionModal()">
                            <i class="fas fa-plus"></i> Add Position
                        </button>
                    </div>

                    <div style="overflow-x: auto;">
                        <table class="positions-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Symbol</th>
                                    <th>Order Type</th>
                                    <th>Order Condition</th>
                                    <th>Entry Price</th>
                                    <th>Current Price</th>
                                    <th>Buy Qty</th>
                                    <th>Sell Qty</th>
                                    <th>Buy Avg Price</th>
                                    <th>Sell Avg Price</th>
                                    <th>Day P&amp;L</th>
                                    <th>Net P&amp;L</th>
                                    <th>Net %</th>
                                    <th>Source</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="positionsTable">
                                <!-- Positions will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Other Pages -->
        <div class="content-page hidden" id="orderbookPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- ============================================================
     MUKESH ALGO - Order Management Page
     Inner HTML for: <div class="content-page hidden" id="orderbookPage">
     ============================================================ -->

<!-- Quick Order Form + Page Header Row -->
<div style="display:flex; align-items:flex-start; justify-content:space-between; flex-wrap:wrap; gap:16px; margin-bottom:20px;">

  <!-- Page Title -->
  <div>
    <h2 style="margin:0 0 4px 0; font-size:22px; font-weight:700; color:#fff; letter-spacing:0.5px;">
      <i class="fas fa-book-open" style="color:#00ccff; margin-right:8px;"></i>Order Management
    </h2>
    <p style="margin:0; font-size:13px; color:#888;">Monitor orders, positions, holdings &amp; funds in real-time</p>
  </div>

  <!-- Quick Order Form -->
  <div id="quickOrderForm" style="
    background:#1a1a1a;
    border:1px solid #2a2a2a;
    border-radius:10px;
    padding:14px 18px;
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
    box-shadow:0 4px 20px rgba(0,0,0,0.4);
  ">
    <span style="font-size:12px; font-weight:600; color:#00ccff; text-transform:uppercase; letter-spacing:1px; margin-right:4px;">
      <i class="fas fa-bolt"></i> Quick Order
    </span>

    <!-- Symbol Input -->
    <input type="text" id="qo_symbol" placeholder="Symbol e.g. NIFTY" style="
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      color:#fff;
      padding:8px 12px;
      font-size:13px;
      width:130px;
      outline:none;
      transition:border-color 0.2s;
    " onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />

    <!-- BUY / SELL Toggle -->
    <div style="display:flex; border-radius:6px; overflow:hidden; border:1px solid #333;">
      <button id="qo_buyBtn" onclick="setOrderSide('BUY')" style="
        padding:8px 16px;
        font-size:12px;
        font-weight:700;
        border:none;
        cursor:pointer;
        background:#00c853;
        color:#fff;
        transition:all 0.2s;
        letter-spacing:0.5px;
      ">BUY</button>
      <button id="qo_sellBtn" onclick="setOrderSide('SELL')" style="
        padding:8px 16px;
        font-size:12px;
        font-weight:700;
        border:none;
        cursor:pointer;
        background:#2a2a2a;
        color:#888;
        transition:all 0.2s;
        letter-spacing:0.5px;
      ">SELL</button>
    </div>

    <!-- Qty -->
    <input type="number" id="qo_qty" placeholder="Qty" min="1" value="1" style="
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      color:#fff;
      padding:8px 10px;
      font-size:13px;
      width:70px;
      outline:none;
      transition:border-color 0.2s;
    " onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />

    <!-- Order Type -->
    <select id="qo_orderType" onchange="toggleLimitPrice()" style="
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      color:#fff;
      padding:8px 10px;
      font-size:13px;
      width:100px;
      outline:none;
      cursor:pointer;
      appearance:none;
      -webkit-appearance:none;
      background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');
      background-repeat:no-repeat;
      background-position:right 8px center;
      background-size:16px;
    ">
      <option value="MARKET">MARKET</option>
      <option value="LIMIT">LIMIT</option>
      <option value="SL">SL</option>
      <option value="SL-M">SL-M</option>
    </select>

    <!-- Price (shown for LIMIT / SL) -->
    <input type="number" id="qo_price" placeholder="Price" step="0.05" style="
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      color:#fff;
      padding:8px 10px;
      font-size:13px;
      width:90px;
      outline:none;
      display:none;
      transition:border-color 0.2s;
    " onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />

    <!-- Broker Selector -->
    <select id="qo_broker" style="
      background:#111;
      border:1px solid #333;
      border-radius:6px;
      color:#fff;
      padding:8px 10px;
      font-size:13px;
      width:130px;
      outline:none;
      cursor:pointer;
      appearance:none;
      -webkit-appearance:none;
      background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');
      background-repeat:no-repeat;
      background-position:right 8px center;
      background-size:16px;
    ">
      <option value="">Select Broker</option>
      <option value="zerodha">Zerodha</option>
      <option value="angel">Angel One</option>
      <option value="fyers">Fyers</option>
      <option value="upstox">Upstox</option>
      <option value="dhan">Dhan</option>
      <option value="all">All Brokers</option>
    </select>

    <!-- Place Order Button -->
    <button id="qo_placeBtn" onclick="placeQuickOrder()" style="
      background:linear-gradient(135deg, #00ccff 0%, #0088cc 100%);
      color:#fff;
      border:none;
      border-radius:6px;
      padding:8px 20px;
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      transition:all 0.2s;
      letter-spacing:0.5px;
      box-shadow:0 2px 10px rgba(0,204,255,0.3);
    " onmouseover="this.style.boxShadow='0 4px 20px rgba(0,204,255,0.5)'; this.style.transform='translateY(-1px)'"
       onmouseout="this.style.boxShadow='0 2px 10px rgba(0,204,255,0.3)'; this.style.transform='translateY(0)'">
      <i class="fas fa-paper-plane" style="margin-right:6px;"></i>Place Order
    </button>
  </div>
</div>

<!-- Tab Navigation -->
<div id="ob_tabBar" style="
  display:flex;
  gap:0;
  margin-bottom:20px;
  border-bottom:2px solid #222;
  position:relative;
">
  <button class="ob-tab active" data-tab="orders" onclick="switchObTab('orders')" style="
    background:transparent;
    border:none;
    color:#00ccff;
    font-size:14px;
    font-weight:600;
    padding:12px 24px;
    cursor:pointer;
    position:relative;
    transition:color 0.2s;
    letter-spacing:0.3px;
    border-bottom:2px solid #00ccff;
    margin-bottom:-2px;
  ">
    <i class="fas fa-list-alt" style="margin-right:6px;"></i>Orders
    <span id="ob_ordersCount" style="
      background:#00ccff;
      color:#000;
      font-size:10px;
      font-weight:700;
      padding:2px 7px;
      border-radius:10px;
      margin-left:6px;
      display:inline-block;
    ">0</span>
  </button>
  <button class="ob-tab" data-tab="positions" onclick="switchObTab('positions')" style="
    background:transparent;
    border:none;
    color:#888;
    font-size:14px;
    font-weight:600;
    padding:12px 24px;
    cursor:pointer;
    position:relative;
    transition:color 0.2s;
    letter-spacing:0.3px;
    border-bottom:2px solid transparent;
    margin-bottom:-2px;
  ">
    <i class="fas fa-crosshairs" style="margin-right:6px;"></i>Positions
    <span id="ob_positionsCount" style="
      background:#333;
      color:#888;
      font-size:10px;
      font-weight:700;
      padding:2px 7px;
      border-radius:10px;
      margin-left:6px;
      display:inline-block;
    ">0</span>
  </button>
  <button class="ob-tab" data-tab="holdings" onclick="switchObTab('holdings')" style="
    background:transparent;
    border:none;
    color:#888;
    font-size:14px;
    font-weight:600;
    padding:12px 24px;
    cursor:pointer;
    position:relative;
    transition:color 0.2s;
    letter-spacing:0.3px;
    border-bottom:2px solid transparent;
    margin-bottom:-2px;
  ">
    <i class="fas fa-wallet" style="margin-right:6px;"></i>Holdings
    <span id="ob_holdingsCount" style="
      background:#333;
      color:#888;
      font-size:10px;
      font-weight:700;
      padding:2px 7px;
      border-radius:10px;
      margin-left:6px;
      display:inline-block;
    ">0</span>
  </button>
  <button class="ob-tab" data-tab="funds" onclick="switchObTab('funds')" style="
    background:transparent;
    border:none;
    color:#888;
    font-size:14px;
    font-weight:600;
    padding:12px 24px;
    cursor:pointer;
    position:relative;
    transition:color 0.2s;
    letter-spacing:0.3px;
    border-bottom:2px solid transparent;
    margin-bottom:-2px;
  ">
    <i class="fas fa-rupee-sign" style="margin-right:6px;"></i>Funds
  </button>

  <!-- Auto-refresh indicator -->
  <div style="margin-left:auto; display:flex; align-items:center; gap:8px; padding-right:8px;">
    <span id="ob_lastUpdated" style="font-size:11px; color:#555;">Last updated: --:--:--</span>
    <button onclick="refreshOrderbook()" title="Refresh" style="
      background:transparent;
      border:1px solid #333;
      border-radius:6px;
      color:#888;
      padding:6px 10px;
      cursor:pointer;
      font-size:12px;
      transition:all 0.2s;
    " onmouseover="this.style.borderColor='#00ccff'; this.style.color='#00ccff'"
       onmouseout="this.style.borderColor='#333'; this.style.color='#888'">
      <i class="fas fa-sync-alt"></i>
    </button>
  </div>
</div>


<!-- ===================== ORDERS TAB ===================== -->
<div id="ob_tab_orders" style="display:block;">

  <!-- Filter Row -->
  <div style="
    display:flex;
    align-items:center;
    justify-content:space-between;
    flex-wrap:wrap;
    gap:10px;
    margin-bottom:16px;
  ">
    <!-- Status Filters -->
    <div style="display:flex; gap:6px; flex-wrap:wrap;">
      <button class="ob-filter-btn active" data-filter="all" onclick="filterOrders('all', this)" style="
        background:#00ccff;
        color:#000;
        border:none;
        border-radius:6px;
        padding:7px 16px;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        letter-spacing:0.3px;
      ">All</button>
      <button class="ob-filter-btn" data-filter="open" onclick="filterOrders('open', this)" style="
        background:#1a1a1a;
        color:#888;
        border:1px solid #333;
        border-radius:6px;
        padding:7px 16px;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        letter-spacing:0.3px;
      ">
        <i class="fas fa-clock" style="margin-right:4px; color:#ff9800;"></i>Open
      </button>
      <button class="ob-filter-btn" data-filter="completed" onclick="filterOrders('completed', this)" style="
        background:#1a1a1a;
        color:#888;
        border:1px solid #333;
        border-radius:6px;
        padding:7px 16px;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        letter-spacing:0.3px;
      ">
        <i class="fas fa-check-circle" style="margin-right:4px; color:#00c853;"></i>Completed
      </button>
      <button class="ob-filter-btn" data-filter="cancelled" onclick="filterOrders('cancelled', this)" style="
        background:#1a1a1a;
        color:#888;
        border:1px solid #333;
        border-radius:6px;
        padding:7px 16px;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
        transition:all 0.2s;
        letter-spacing:0.3px;
      ">
        <i class="fas fa-times-circle" style="margin-right:4px; color:#f44336;"></i>Cancelled
      </button>
    </div>

    <!-- Broker Filter + Search -->
    <div style="display:flex; gap:8px; align-items:center;">
      <div style="position:relative;">
        <i class="fas fa-search" style="position:absolute; left:10px; top:50%; transform:translateY(-50%); color:#555; font-size:12px;"></i>
        <input type="text" id="ob_searchOrders" placeholder="Search symbol..." oninput="searchOrders(this.value)" style="
          background:#111;
          border:1px solid #333;
          border-radius:6px;
          color:#fff;
          padding:7px 12px 7px 32px;
          font-size:12px;
          width:160px;
          outline:none;
          transition:border-color 0.2s;
        " onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <select id="ob_brokerFilter" onchange="filterOrdersByBroker(this.value)" style="
        background:#111;
        border:1px solid #333;
        border-radius:6px;
        color:#fff;
        padding:7px 30px 7px 10px;
        font-size:12px;
        outline:none;
        cursor:pointer;
        appearance:none;
        -webkit-appearance:none;
        background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');
        background-repeat:no-repeat;
        background-position:right 6px center;
        background-size:16px;
      ">
        <option value="all">All Brokers</option>
        <option value="zerodha">Zerodha</option>
        <option value="angel">Angel One</option>
        <option value="fyers">Fyers</option>
        <option value="upstox">Upstox</option>
        <option value="dhan">Dhan</option>
      </select>
    </div>
  </div>

  <!-- Orders Table Card -->
  <div style="
    background:#1a1a1a;
    border:1px solid #2a2a2a;
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
  ">
    <div style="overflow-x:auto;">
      <table id="ob_ordersTable" style="width:100%; border-collapse:collapse; min-width:900px;">
        <thead>
          <tr style="background:#111; border-bottom:1px solid #2a2a2a;">
            <th style="padding:12px 16px; text-align:left; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Time</th>
            <th style="padding:12px 16px; text-align:left; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Symbol</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Type</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Qty</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Price</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Status</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Broker</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Actions</th>
          </tr>
        </thead>
        <tbody id="ob_ordersBody">
          <!-- Orders populated dynamically via addOrderToTable() -->
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div id="ob_ordersEmpty" style="
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:60px 20px;
      text-align:center;
    ">
      <div style="
        width:80px;
        height:80px;
        border-radius:50%;
        background:#111;
        display:flex;
        align-items:center;
        justify-content:center;
        margin-bottom:16px;
      ">
        <i class="fas fa-inbox" style="font-size:32px; color:#333;"></i>
      </div>
      <p style="margin:0 0 6px 0; font-size:16px; font-weight:600; color:#555;">No orders found</p>
      <p style="margin:0; font-size:13px; color:#444;">Place an order using the quick order form above or wait for algo signals</p>
    </div>
  </div>
</div>


<!-- ===================== POSITIONS TAB ===================== -->
<div id="ob_tab_positions" style="display:none;">

  <!-- Positions Summary Bar -->
  <div style="
    display:flex;
    gap:16px;
    margin-bottom:16px;
    flex-wrap:wrap;
  ">
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(0,204,255,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-crosshairs" style="color:#00ccff; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Open Positions</div>
        <div id="ob_openPosCount" style="font-size:20px; font-weight:700; color:#fff;">0</div>
      </div>
    </div>
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(0,200,83,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-chart-line" style="color:#00c853; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Total P&amp;L</div>
        <div id="ob_totalPnl" style="font-size:20px; font-weight:700; color:#00c853;">+&#8377;0.00</div>
      </div>
    </div>
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(255,152,0,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-calendar-day" style="color:#ff9800; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Day's P&amp;L</div>
        <div id="ob_dayPnl" style="font-size:20px; font-weight:700; color:#00c853;">+&#8377;0.00</div>
      </div>
    </div>
  </div>

  <!-- Positions Table Card -->
  <div style="
    background:#1a1a1a;
    border:1px solid #2a2a2a;
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
  ">
    <div style="overflow-x:auto;">
      <table id="ob_positionsTable" style="width:100%; border-collapse:collapse; min-width:850px;">
        <thead>
          <tr style="background:#111; border-bottom:1px solid #2a2a2a;">
            <th style="padding:12px 16px; text-align:left; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Symbol</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Type</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Qty</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Avg Price</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">LTP</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">P&amp;L</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Broker</th>
          </tr>
        </thead>
        <tbody id="ob_positionsBody">
          <!-- Positions populated dynamically via renderPositions() -->
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div id="ob_positionsEmpty" style="
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:60px 20px;
      text-align:center;
    ">
      <div style="
        width:80px;
        height:80px;
        border-radius:50%;
        background:#111;
        display:flex;
        align-items:center;
        justify-content:center;
        margin-bottom:16px;
      ">
        <i class="fas fa-crosshairs" style="font-size:32px; color:#333;"></i>
      </div>
      <p style="margin:0 0 6px 0; font-size:16px; font-weight:600; color:#555;">No open positions</p>
      <p style="margin:0; font-size:13px; color:#444;">Active positions will appear here once orders are executed</p>
    </div>

    <!-- Total P&L Footer -->
    <div id="ob_positionsPnlFooter" style="
      display:none;
      border-top:1px solid #2a2a2a;
      background:#111;
      padding:14px 16px;
    ">
      <div style="display:flex; justify-content:flex-end; align-items:center; gap:24px; flex-wrap:wrap;">
        <div style="text-align:right;">
          <span style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Unrealised P&amp;L</span>
          <span id="ob_unrealisedPnl" style="font-size:16px; font-weight:700; color:#00c853; margin-left:12px;">+&#8377;0.00</span>
        </div>
        <div style="width:1px; height:28px; background:#2a2a2a;"></div>
        <div style="text-align:right;">
          <span style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Realised P&amp;L</span>
          <span id="ob_realisedPnl" style="font-size:16px; font-weight:700; color:#00c853; margin-left:12px;">+&#8377;0.00</span>
        </div>
        <div style="width:1px; height:28px; background:#2a2a2a;"></div>
        <div style="text-align:right;">
          <span style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px; font-weight:700;">Total P&amp;L</span>
          <span id="ob_footerTotalPnl" style="font-size:18px; font-weight:700; color:#00c853; margin-left:12px;">+&#8377;0.00</span>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- ===================== HOLDINGS TAB ===================== -->
<div id="ob_tab_holdings" style="display:none;">

  <!-- Holdings Summary -->
  <div style="
    display:flex;
    gap:16px;
    margin-bottom:16px;
    flex-wrap:wrap;
  ">
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(0,204,255,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-cubes" style="color:#00ccff; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Total Holdings</div>
        <div id="ob_holdingsTotalCount" style="font-size:20px; font-weight:700; color:#fff;">0</div>
      </div>
    </div>
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(0,204,255,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-money-bill-wave" style="color:#00ccff; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Investment Value</div>
        <div id="ob_investmentVal" style="font-size:20px; font-weight:700; color:#fff;">&#8377;0.00</div>
      </div>
    </div>
    <div style="
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:8px;
      padding:12px 20px;
      display:flex;
      align-items:center;
      gap:12px;
    ">
      <div style="
        width:40px;
        height:40px;
        border-radius:8px;
        background:rgba(0,200,83,0.1);
        display:flex;
        align-items:center;
        justify-content:center;
      ">
        <i class="fas fa-percentage" style="color:#00c853; font-size:16px;"></i>
      </div>
      <div>
        <div style="font-size:11px; color:#555; text-transform:uppercase; letter-spacing:0.5px;">Overall P&amp;L</div>
        <div id="ob_holdingsPnl" style="font-size:20px; font-weight:700; color:#00c853;">+&#8377;0.00 (0.00%)</div>
      </div>
    </div>
  </div>

  <!-- Holdings Table Card -->
  <div style="
    background:#1a1a1a;
    border:1px solid #2a2a2a;
    border-radius:10px;
    overflow:hidden;
    box-shadow:0 4px 20px rgba(0,0,0,0.3);
  ">
    <div style="overflow-x:auto;">
      <table id="ob_holdingsTable" style="width:100%; border-collapse:collapse; min-width:900px;">
        <thead>
          <tr style="background:#111; border-bottom:1px solid #2a2a2a;">
            <th style="padding:12px 16px; text-align:left; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Symbol</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Qty</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Avg Price</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">LTP</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Current Value</th>
            <th style="padding:12px 16px; text-align:right; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">P&amp;L</th>
            <th style="padding:12px 16px; text-align:center; font-size:11px; font-weight:700; color:#555; text-transform:uppercase; letter-spacing:1px;">Broker</th>
          </tr>
        </thead>
        <tbody id="ob_holdingsBody">
          <!-- Holdings populated dynamically via renderHoldings() -->
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div id="ob_holdingsEmpty" style="
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:60px 20px;
      text-align:center;
    ">
      <div style="
        width:80px;
        height:80px;
        border-radius:50%;
        background:#111;
        display:flex;
        align-items:center;
        justify-content:center;
        margin-bottom:16px;
      ">
        <i class="fas fa-wallet" style="font-size:32px; color:#333;"></i>
      </div>
      <p style="margin:0 0 6px 0; font-size:16px; font-weight:600; color:#555;">No holdings found</p>
      <p style="margin:0; font-size:13px; color:#444;">Your delivery holdings across all connected brokers will appear here</p>
    </div>
  </div>
</div>


<!-- ===================== FUNDS TAB ===================== -->
<div id="ob_tab_funds" style="display:none;">

  <!-- Funds Grid -->
  <div id="ob_fundsGrid" style="
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(340px, 1fr));
    gap:16px;
  ">

    <!-- Empty State (shown when no brokers connected) -->
    <div id="ob_fundsEmpty" style="
      grid-column:1 / -1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:60px 20px;
      text-align:center;
      background:#1a1a1a;
      border:1px solid #2a2a2a;
      border-radius:10px;
    ">
      <div style="
        width:80px;
        height:80px;
        border-radius:50%;
        background:#111;
        display:flex;
        align-items:center;
        justify-content:center;
        margin-bottom:16px;
      ">
        <i class="fas fa-university" style="font-size:32px; color:#333;"></i>
      </div>
      <p style="margin:0 0 6px 0; font-size:16px; font-weight:600; color:#555;">No brokers connected</p>
      <p style="margin:0; font-size:13px; color:#444;">Connect a broker from Settings to view fund details</p>
    </div>

    <!-- Broker fund cards are generated dynamically via renderFunds() -->
  </div>
</div>


<!-- ===================== JAVASCRIPT ===================== -->
<script>
(function() {
  'use strict';

  /* ---------- STATE ---------- */
  var currentOrderSide = 'BUY';
  var currentStatusFilter = 'all';
  var currentBrokerFilter = 'all';
  var currentSearchTerm = '';

  /* ============================
     QUICK ORDER FORM LOGIC
     ============================ */
  window.setOrderSide = function(side) {
    currentOrderSide = side;
    var buyBtn  = document.getElementById('qo_buyBtn');
    var sellBtn = document.getElementById('qo_sellBtn');
    if (side === 'BUY') {
      buyBtn.style.background  = '#00c853'; buyBtn.style.color  = '#fff';
      sellBtn.style.background = '#2a2a2a'; sellBtn.style.color = '#888';
    } else {
      sellBtn.style.background = '#f44336'; sellBtn.style.color = '#fff';
      buyBtn.style.background  = '#2a2a2a'; buyBtn.style.color  = '#888';
    }
  };

  window.toggleLimitPrice = function() {
    var orderType = document.getElementById('qo_orderType').value;
    var priceEl   = document.getElementById('qo_price');
    priceEl.style.display = (orderType === 'LIMIT' || orderType === 'SL') ? 'block' : 'none';
  };

  window.placeQuickOrder = function() {
    var symbol    = document.getElementById('qo_symbol').value.trim().toUpperCase();
    var qty       = parseInt(document.getElementById('qo_qty').value, 10);
    var orderType = document.getElementById('qo_orderType').value;
    var price     = parseFloat(document.getElementById('qo_price').value) || 0;
    var broker    = document.getElementById('qo_broker').value;

    if (!symbol) { showToast('Please enter a symbol', 'error'); return; }
    if (!qty || qty < 1) { showToast('Please enter valid quantity', 'error'); return; }
    if (!broker) { showToast('Please select a broker', 'error'); return; }
    if ((orderType === 'LIMIT' || orderType === 'SL') && (!price || price <= 0)) {
      showToast('Please enter a valid price', 'error'); return;
    }

    var orderData = {
      symbol: symbol,
      side: currentOrderSide,
      qty: qty,
      orderType: orderType,
      price: (orderType === 'LIMIT' || orderType === 'SL') ? price : 0,
      broker: broker
    };

    console.log('[MUKESH ALGO] Placing order:', orderData);

    // Disable button while processing
    var btn = document.getElementById('qo_placeBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-right:6px;"></i>Placing...';
    btn.style.opacity = '0.7';

    // Simulate API call (replace with actual API integration)
    setTimeout(function() {
      btn.disabled = false;
      btn.innerHTML = '<i class="fas fa-paper-plane" style="margin-right:6px;"></i>Place Order';
      btn.style.opacity = '1';

      // Add order to table
      addOrderToTable({
        time: new Date().toLocaleTimeString('en-IN', { hour12: false }),
        symbol: symbol,
        side: currentOrderSide,
        qty: qty,
        price: price || 'MKT',
        status: 'OPEN',
        broker: broker,
        orderId: 'ORD' + Date.now()
      });

      showToast(currentOrderSide + ' order placed for ' + symbol, 'success');
      if (typeof addLog === 'function') addLog('SUCCESS', 'order', currentOrderSide + ' ' + orderType + ' order: ' + symbol + ' x' + qty + (price ? ' @ ' + price : ' @ MKT'));

      // Reset form
      document.getElementById('qo_symbol').value = '';
      document.getElementById('qo_qty').value = '1';
    }, 800);
  };


  /* ============================
     TAB SWITCHING
     ============================ */
  window.switchObTab = function(tab) {
    // Hide all tab panels
    var tabs = ['orders', 'positions', 'holdings', 'funds'];
    tabs.forEach(function(t) {
      var panel = document.getElementById('ob_tab_' + t);
      if (panel) panel.style.display = 'none';
    });

    // Show selected panel
    var activePanel = document.getElementById('ob_tab_' + tab);
    if (activePanel) activePanel.style.display = 'block';

    // Update tab buttons
    var tabBar = document.getElementById('ob_tabBar');
    if (tabBar) {
      var buttons = tabBar.querySelectorAll('button[data-tab]');
      buttons.forEach(function(btn) {
        if (btn.getAttribute('data-tab') === tab) {
          btn.style.color = '#00ccff';
          btn.style.borderBottomColor = '#00ccff';
          var badge = btn.querySelector('span');
          if (badge) {
            badge.style.background = '#00ccff';
            badge.style.color = '#000';
          }
        } else {
          btn.style.color = '#888';
          btn.style.borderBottomColor = 'transparent';
          var badge = btn.querySelector('span');
          if (badge) {
            badge.style.background = '#333';
            badge.style.color = '#888';
          }
        }
      });
    }
  };


  /* ============================
     ORDERS: FILTERING & SEARCH
     ============================ */
  window.filterOrders = function(filter, btnEl) {
    currentStatusFilter = filter;

    // Update filter button styles
    document.querySelectorAll('.ob-filter-btn').forEach(function(btn) {
      if (btn === btnEl) {
        btn.style.background = '#00ccff';
        btn.style.color = '#000';
        btn.style.border = 'none';
      } else {
        btn.style.background = '#1a1a1a';
        btn.style.color = '#888';
        btn.style.border = '1px solid #333';
      }
    });

    applyOrderFilters();
  };

  window.filterOrdersByBroker = function(broker) {
    currentBrokerFilter = broker;
    applyOrderFilters();
  };

  window.searchOrders = function(term) {
    currentSearchTerm = term.toLowerCase();
    applyOrderFilters();
  };

  function applyOrderFilters() {
    var rows = document.querySelectorAll('#ob_ordersBody tr');
    var visibleCount = 0;

    rows.forEach(function(row) {
      var status = (row.getAttribute('data-status') || '').toLowerCase();
      var broker = (row.getAttribute('data-broker') || '').toLowerCase();
      var symbol = (row.getAttribute('data-symbol') || '').toLowerCase();

      var statusMatch = (currentStatusFilter === 'all') || (status === currentStatusFilter);
      var brokerMatch = (currentBrokerFilter === 'all') || (broker === currentBrokerFilter);
      var searchMatch = !currentSearchTerm || symbol.indexOf(currentSearchTerm) !== -1;

      if (statusMatch && brokerMatch && searchMatch) {
        row.style.display = '';
        visibleCount++;
      } else {
        row.style.display = 'none';
      }
    });

    // Toggle empty state
    var emptyEl = document.getElementById('ob_ordersEmpty');
    if (emptyEl) {
      emptyEl.style.display = visibleCount === 0 ? 'flex' : 'none';
    }
  }


  /* ============================
     ORDERS: ADD ROW
     ============================ */
  window.addOrderToTable = function(order) {
    var tbody = document.getElementById('ob_ordersBody');
    if (!tbody) return;

    // Hide empty state
    var emptyEl = document.getElementById('ob_ordersEmpty');
    if (emptyEl) emptyEl.style.display = 'none';

    var sideColor = order.side === 'BUY' ? '#00c853' : '#f44336';
    var sideBg    = order.side === 'BUY' ? 'rgba(0,200,83,0.1)' : 'rgba(244,67,54,0.1)';

    var statusColor, statusBg;
    switch ((order.status || '').toUpperCase()) {
      case 'OPEN':
      case 'PENDING':
      case 'TRIGGER PENDING':
        statusColor = '#ff9800'; statusBg = 'rgba(255,152,0,0.1)'; break;
      case 'COMPLETE':
      case 'COMPLETED':
      case 'EXECUTED':
        statusColor = '#00c853'; statusBg = 'rgba(0,200,83,0.1)'; break;
      case 'CANCELLED':
      case 'REJECTED':
        statusColor = '#f44336'; statusBg = 'rgba(244,67,54,0.1)'; break;
      default:
        statusColor = '#888'; statusBg = 'rgba(136,136,136,0.1)';
    }

    var isOpen = ['OPEN', 'PENDING', 'TRIGGER PENDING'].indexOf(order.status.toUpperCase()) !== -1;

    var brokerLabel = order.broker.charAt(0).toUpperCase() + order.broker.slice(1);

    var tr = document.createElement('tr');
    tr.setAttribute('data-status', order.status.toLowerCase());
    tr.setAttribute('data-broker', order.broker.toLowerCase());
    tr.setAttribute('data-symbol', order.symbol.toLowerCase());
    tr.setAttribute('data-orderid', order.orderId || '');
    tr.style.cssText = 'border-bottom:1px solid #222; transition:background 0.15s;';
    tr.onmouseover = function() { this.style.background = '#222'; };
    tr.onmouseout  = function() { this.style.background = 'transparent'; };

    tr.innerHTML =
      '<td style="padding:12px 16px; font-size:13px; color:#888; white-space:nowrap;">' +
        '<i class="far fa-clock" style="margin-right:6px; color:#555;"></i>' + order.time +
      '</td>' +
      '<td style="padding:12px 16px; font-size:13px; font-weight:600; color:#fff; white-space:nowrap;">' +
        order.symbol +
      '</td>' +
      '<td style="padding:12px 16px; text-align:center;">' +
        '<span style="display:inline-block; padding:4px 12px; border-radius:4px; font-size:11px; font-weight:700; color:' + sideColor + '; background:' + sideBg + '; letter-spacing:0.5px;">' +
          order.side +
        '</span>' +
      '</td>' +
      '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">' +
        order.qty +
      '</td>' +
      '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">' +
        (typeof order.price === 'number' && order.price > 0 ? '&#8377;' + order.price.toFixed(2) : 'MKT') +
      '</td>' +
      '<td style="padding:12px 16px; text-align:center;">' +
        '<span style="display:inline-block; padding:4px 12px; border-radius:4px; font-size:11px; font-weight:600; color:' + statusColor + '; background:' + statusBg + ';">' +
          '<i class="fas fa-circle" style="font-size:6px; margin-right:5px; vertical-align:middle;"></i>' +
          order.status.toUpperCase() +
        '</span>' +
      '</td>' +
      '<td style="padding:12px 16px; text-align:center; font-size:12px; color:#aaa;">' +
        brokerLabel +
      '</td>' +
      '<td style="padding:12px 16px; text-align:center;">' +
        (isOpen
          ? '<button onclick="cancelOrder(\'' + order.orderId + '\', this)" title="Cancel Order" style="' +
              'background:rgba(244,67,54,0.1); color:#f44336; border:1px solid rgba(244,67,54,0.3); ' +
              'border-radius:6px; padding:5px 12px; font-size:11px; font-weight:600; cursor:pointer; ' +
              'transition:all 0.2s; letter-spacing:0.3px;' +
            '" onmouseover="this.style.background=\'rgba(244,67,54,0.2)\'; this.style.borderColor=\'#f44336\'"' +
            '  onmouseout="this.style.background=\'rgba(244,67,54,0.1)\'; this.style.borderColor=\'rgba(244,67,54,0.3)\'">' +
              '<i class="fas fa-times" style="margin-right:4px;"></i>Cancel' +
            '</button>'
          : '<span style="color:#444; font-size:12px;">--</span>'
        ) +
      '</td>';

    // Prepend new order at top
    if (tbody.firstChild) {
      tbody.insertBefore(tr, tbody.firstChild);
    } else {
      tbody.appendChild(tr);
    }

    // Update count badge
    updateOrderCount();
  };


  /* ============================
     ORDERS: CANCEL
     ============================ */
  window.cancelOrder = function(orderId, btnEl) {
    if (!confirm('Cancel order ' + orderId + '?')) return;

    btnEl.disabled = true;
    btnEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    btnEl.style.opacity = '0.5';

    console.log('[MUKESH ALGO] Cancelling order:', orderId);

    // Simulate API call (replace with actual backend call)
    setTimeout(function() {
      var row = btnEl.closest('tr');
      if (row) {
        row.setAttribute('data-status', 'cancelled');
        // Update status badge
        var statusCell = row.children[5];
        if (statusCell) {
          statusCell.innerHTML =
            '<span style="display:inline-block; padding:4px 12px; border-radius:4px; font-size:11px; font-weight:600; color:#f44336; background:rgba(244,67,54,0.1);">' +
              '<i class="fas fa-circle" style="font-size:6px; margin-right:5px; vertical-align:middle;"></i>CANCELLED' +
            '</span>';
        }
        // Update actions column
        var actionCell = row.children[7];
        if (actionCell) {
          actionCell.innerHTML = '<span style="color:#444; font-size:12px;">--</span>';
        }
      }
      showToast('Order ' + orderId + ' cancelled', 'warning');
      applyOrderFilters();
    }, 500);
  };


  /* ============================
     POSITIONS: RENDER
     ============================ */
  window.renderPositions = function(positions) {
    var tbody = document.getElementById('ob_positionsBody');
    var emptyEl = document.getElementById('ob_positionsEmpty');
    var footer  = document.getElementById('ob_positionsPnlFooter');
    if (!tbody) return;

    tbody.innerHTML = '';

    if (!positions || positions.length === 0) {
      if (emptyEl) emptyEl.style.display = 'flex';
      if (footer) footer.style.display = 'none';
      updateBadge('positions', 0);
      return;
    }

    if (emptyEl) emptyEl.style.display = 'none';
    if (footer) footer.style.display = 'block';

    var totalUnrealised = 0;
    var totalRealised = 0;

    positions.forEach(function(pos) {
      var pnl = (pos.ltp - pos.avgPrice) * pos.qty;
      if (pos.side === 'SELL' || pos.side === 'SHORT') pnl = -pnl;
      totalUnrealised += pnl;

      var pnlColor = pnl >= 0 ? '#00c853' : '#f44336';
      var pnlSign  = pnl >= 0 ? '+' : '';
      var sideColor = (pos.side === 'BUY' || pos.side === 'LONG') ? '#00c853' : '#f44336';
      var sideBg    = (pos.side === 'BUY' || pos.side === 'LONG') ? 'rgba(0,200,83,0.1)' : 'rgba(244,67,54,0.1)';
      var sideLabel = (pos.side === 'BUY' || pos.side === 'LONG') ? 'LONG' : 'SHORT';
      var brokerLabel = pos.broker.charAt(0).toUpperCase() + pos.broker.slice(1);

      var tr = document.createElement('tr');
      tr.style.cssText = 'border-bottom:1px solid #222; transition:background 0.15s;';
      tr.onmouseover = function() { this.style.background = '#222'; };
      tr.onmouseout  = function() { this.style.background = 'transparent'; };

      tr.innerHTML =
        '<td style="padding:12px 16px; font-size:13px; font-weight:600; color:#fff;">' + pos.symbol + '</td>' +
        '<td style="padding:12px 16px; text-align:center;">' +
          '<span style="display:inline-block; padding:4px 12px; border-radius:4px; font-size:11px; font-weight:700; color:' + sideColor + '; background:' + sideBg + '; letter-spacing:0.5px;">' +
            sideLabel +
          '</span>' +
        '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">' + pos.qty + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#ccc; text-align:right;">&#8377;' + pos.avgPrice.toFixed(2) + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">&#8377;' + pos.ltp.toFixed(2) + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; text-align:right; font-weight:700; color:' + pnlColor + ';">' +
          pnlSign + '&#8377;' + Math.abs(pnl).toFixed(2) +
        '</td>' +
        '<td style="padding:12px 16px; text-align:center; font-size:12px; color:#aaa;">' + brokerLabel + '</td>';

      tbody.appendChild(tr);
    });

    // Update summary values
    var totalPnl = totalUnrealised + totalRealised;
    var pnlColor = function(val) { return val >= 0 ? '#00c853' : '#f44336'; };
    var pnlStr   = function(val) { return (val >= 0 ? '+' : '') + '&#8377;' + Math.abs(val).toFixed(2); };

    setHTML('ob_unrealisedPnl', pnlStr(totalUnrealised));
    setColor('ob_unrealisedPnl', pnlColor(totalUnrealised));
    setHTML('ob_realisedPnl', pnlStr(totalRealised));
    setColor('ob_realisedPnl', pnlColor(totalRealised));
    setHTML('ob_footerTotalPnl', pnlStr(totalPnl));
    setColor('ob_footerTotalPnl', pnlColor(totalPnl));
    setHTML('ob_totalPnl', pnlStr(totalPnl));
    setColor('ob_totalPnl', pnlColor(totalPnl));
    setHTML('ob_dayPnl', pnlStr(totalPnl));
    setColor('ob_dayPnl', pnlColor(totalPnl));
    setHTML('ob_openPosCount', positions.length.toString());

    updateBadge('positions', positions.length);
  };


  /* ============================
     HOLDINGS: RENDER
     ============================ */
  window.renderHoldings = function(holdings) {
    var tbody = document.getElementById('ob_holdingsBody');
    var emptyEl = document.getElementById('ob_holdingsEmpty');
    if (!tbody) return;

    tbody.innerHTML = '';

    if (!holdings || holdings.length === 0) {
      if (emptyEl) emptyEl.style.display = 'flex';
      updateBadge('holdings', 0);
      return;
    }

    if (emptyEl) emptyEl.style.display = 'none';

    var totalInvestment = 0;
    var totalCurrent = 0;

    holdings.forEach(function(h) {
      var currentVal = h.qty * h.ltp;
      var investVal  = h.qty * h.avgPrice;
      var pnl = currentVal - investVal;
      var pnlPct = investVal > 0 ? ((pnl / investVal) * 100) : 0;
      totalInvestment += investVal;
      totalCurrent += currentVal;

      var pnlColor = pnl >= 0 ? '#00c853' : '#f44336';
      var pnlSign  = pnl >= 0 ? '+' : '';
      var brokerLabel = h.broker.charAt(0).toUpperCase() + h.broker.slice(1);

      var tr = document.createElement('tr');
      tr.style.cssText = 'border-bottom:1px solid #222; transition:background 0.15s;';
      tr.onmouseover = function() { this.style.background = '#222'; };
      tr.onmouseout  = function() { this.style.background = 'transparent'; };

      tr.innerHTML =
        '<td style="padding:12px 16px; font-size:13px; font-weight:600; color:#fff;">' + h.symbol + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">' + h.qty + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#ccc; text-align:right;">&#8377;' + h.avgPrice.toFixed(2) + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">&#8377;' + h.ltp.toFixed(2) + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; color:#fff; text-align:right; font-weight:500;">&#8377;' + currentVal.toFixed(2) + '</td>' +
        '<td style="padding:12px 16px; font-size:13px; text-align:right; font-weight:700; color:' + pnlColor + ';">' +
          pnlSign + '&#8377;' + Math.abs(pnl).toFixed(2) +
          ' <span style="font-size:11px; font-weight:500;">(' + pnlSign + pnlPct.toFixed(2) + '%)</span>' +
        '</td>' +
        '<td style="padding:12px 16px; text-align:center; font-size:12px; color:#aaa;">' + brokerLabel + '</td>';

      tbody.appendChild(tr);
    });

    var totalPnl = totalCurrent - totalInvestment;
    var totalPnlPct = totalInvestment > 0 ? ((totalPnl / totalInvestment) * 100) : 0;
    var pnlColor = totalPnl >= 0 ? '#00c853' : '#f44336';
    var pnlSign  = totalPnl >= 0 ? '+' : '';

    setHTML('ob_holdingsTotalCount', holdings.length.toString());
    setHTML('ob_investmentVal', '&#8377;' + totalInvestment.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }));
    setHTML('ob_holdingsPnl', pnlSign + '&#8377;' + Math.abs(totalPnl).toFixed(2) + ' (' + pnlSign + totalPnlPct.toFixed(2) + '%)');
    setColor('ob_holdingsPnl', pnlColor);

    updateBadge('holdings', holdings.length);
  };


  /* ============================
     FUNDS: RENDER
     ============================ */
  window.renderFunds = function(brokerFunds) {
    var grid = document.getElementById('ob_fundsGrid');
    var emptyEl = document.getElementById('ob_fundsEmpty');
    if (!grid) return;

    // Remove existing fund cards (keep empty state element)
    var existingCards = grid.querySelectorAll('.ob-fund-card');
    existingCards.forEach(function(c) { c.remove(); });

    if (!brokerFunds || brokerFunds.length === 0) {
      if (emptyEl) emptyEl.style.display = 'flex';
      return;
    }

    if (emptyEl) emptyEl.style.display = 'none';

    brokerFunds.forEach(function(fund) {
      var brokerLabel = fund.broker.charAt(0).toUpperCase() + fund.broker.slice(1);
      var usedPct = fund.totalBalance > 0 ? ((fund.usedMargin / fund.totalBalance) * 100) : 0;

      var card = document.createElement('div');
      card.className = 'ob-fund-card';
      card.style.cssText =
        'background:#1a1a1a; border:1px solid #2a2a2a; border-radius:10px; padding:20px; ' +
        'box-shadow:0 4px 20px rgba(0,0,0,0.3); transition:border-color 0.2s;';
      card.onmouseover = function() { this.style.borderColor = '#00ccff'; };
      card.onmouseout  = function() { this.style.borderColor = '#2a2a2a'; };

      card.innerHTML =
        /* Card Header */
        '<div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:20px; padding-bottom:14px; border-bottom:1px solid #222;">' +
          '<div style="display:flex; align-items:center; gap:10px;">' +
            '<div style="width:36px; height:36px; border-radius:8px; background:rgba(0,204,255,0.1); display:flex; align-items:center; justify-content:center;">' +
              '<i class="fas fa-university" style="color:#00ccff; font-size:14px;"></i>' +
            '</div>' +
            '<div>' +
              '<div style="font-size:15px; font-weight:700; color:#fff;">' + brokerLabel + '</div>' +
              '<div style="font-size:11px; color:#555;">Connected</div>' +
            '</div>' +
          '</div>' +
          '<div style="width:10px; height:10px; border-radius:50%; background:#00c853; box-shadow:0 0 6px rgba(0,200,83,0.5);"></div>' +
        '</div>' +

        /* Margin Usage Bar */
        '<div style="margin-bottom:18px;">' +
          '<div style="display:flex; justify-content:space-between; margin-bottom:6px;">' +
            '<span style="font-size:11px; color:#555;">Margin Usage</span>' +
            '<span style="font-size:11px; color:#888; font-weight:600;">' + usedPct.toFixed(1) + '%</span>' +
          '</div>' +
          '<div style="width:100%; height:6px; background:#111; border-radius:3px; overflow:hidden;">' +
            '<div style="width:' + usedPct + '%; height:100%; background:linear-gradient(90deg, #00ccff, ' + (usedPct > 80 ? '#f44336' : '#0088cc') + '); border-radius:3px; transition:width 0.5s;"></div>' +
          '</div>' +
        '</div>' +

        /* Fund Details */
        '<div style="display:flex; flex-direction:column; gap:12px;">' +
          /* Available Margin */
          '<div style="display:flex; justify-content:space-between; align-items:center;">' +
            '<div style="display:flex; align-items:center; gap:8px;">' +
              '<div style="width:8px; height:8px; border-radius:50%; background:#00c853;"></div>' +
              '<span style="font-size:12px; color:#888;">Available Margin</span>' +
            '</div>' +
            '<span style="font-size:15px; font-weight:700; color:#00c853;">&#8377;' + fund.availableMargin.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '</span>' +
          '</div>' +
          /* Used Margin */
          '<div style="display:flex; justify-content:space-between; align-items:center;">' +
            '<div style="display:flex; align-items:center; gap:8px;">' +
              '<div style="width:8px; height:8px; border-radius:50%; background:#ff9800;"></div>' +
              '<span style="font-size:12px; color:#888;">Used Margin</span>' +
            '</div>' +
            '<span style="font-size:15px; font-weight:700; color:#ff9800;">&#8377;' + fund.usedMargin.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '</span>' +
          '</div>' +
          /* Divider */
          '<div style="border-top:1px dashed #333; margin:4px 0;"></div>' +
          /* Total Balance */
          '<div style="display:flex; justify-content:space-between; align-items:center;">' +
            '<div style="display:flex; align-items:center; gap:8px;">' +
              '<div style="width:8px; height:8px; border-radius:50%; background:#00ccff;"></div>' +
              '<span style="font-size:13px; color:#ccc; font-weight:600;">Total Balance</span>' +
            '</div>' +
            '<span style="font-size:17px; font-weight:700; color:#fff;">&#8377;' + fund.totalBalance.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) + '</span>' +
          '</div>' +
        '</div>';

      grid.appendChild(card);
    });
  };


  /* ============================
     REFRESH
     ============================ */
  window.refreshOrderbook = function() {
    var ts = new Date().toLocaleTimeString('en-IN', { hour12: false });
    var el = document.getElementById('ob_lastUpdated');
    if (el) el.textContent = 'Last updated: ' + ts;

    console.log('[MUKESH ALGO] Refreshing orderbook data...');

    // Trigger data fetch from your backend (implement as needed)
    if (typeof fetchOrderbookData === 'function') {
      fetchOrderbookData();
    }
  };


  /* ============================
     HELPERS
     ============================ */
  function setHTML(id, html) {
    var el = document.getElementById(id);
    if (el) el.innerHTML = html;
  }

  function setColor(id, color) {
    var el = document.getElementById(id);
    if (el) el.style.color = color;
  }

  function updateOrderCount() {
    var rows = document.querySelectorAll('#ob_ordersBody tr');
    updateBadge('orders', rows.length);
  }

  function updateBadge(tab, count) {
    var el = document.getElementById('ob_' + tab + 'Count');
    if (el) el.textContent = count;
  }

  function showToast(message, type) {
    // Remove existing toast
    var existing = document.getElementById('ob_toast');
    if (existing) existing.remove();

    var bgColor, iconClass;
    switch (type) {
      case 'success': bgColor = '#00c853'; iconClass = 'fas fa-check-circle'; break;
      case 'error':   bgColor = '#f44336'; iconClass = 'fas fa-exclamation-circle'; break;
      case 'warning': bgColor = '#ff9800'; iconClass = 'fas fa-exclamation-triangle'; break;
      default:        bgColor = '#00ccff'; iconClass = 'fas fa-info-circle';
    }

    var toast = document.createElement('div');
    toast.id = 'ob_toast';
    toast.style.cssText =
      'position:fixed; top:20px; right:20px; z-index:10000; ' +
      'background:#1a1a1a; border:1px solid ' + bgColor + '; border-radius:8px; ' +
      'padding:12px 20px; display:flex; align-items:center; gap:10px; ' +
      'box-shadow:0 8px 32px rgba(0,0,0,0.5); ' +
      'animation:obToastIn 0.3s ease; max-width:360px;';
    toast.innerHTML =
      '<i class="' + iconClass + '" style="color:' + bgColor + '; font-size:16px;"></i>' +
      '<span style="color:#fff; font-size:13px; font-weight:500;">' + message + '</span>';

    document.body.appendChild(toast);

    setTimeout(function() {
      toast.style.opacity = '0';
      toast.style.transform = 'translateX(20px)';
      toast.style.transition = 'all 0.3s ease';
      setTimeout(function() { toast.remove(); }, 300);
    }, 3000);
  }

  // Inject toast animation keyframes
  if (!document.getElementById('ob_toastStyles')) {
    var style = document.createElement('style');
    style.id = 'ob_toastStyles';
    style.textContent =
      '@keyframes obToastIn { from { opacity:0; transform:translateX(20px); } to { opacity:1; transform:translateX(0); } }';
    document.head.appendChild(style);
  }

})();
</script>

        </div>

<div class="content-page hidden" id="screenerPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>


  <!-- Page Header -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;">
    <div>
      <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
        <i class="fas fa-crosshairs" style="color:#00ccff;margin-right:10px;"></i>Scanner / Screener
      </h2>
      <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Scan markets in real-time using Chartink or custom filters</p>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <span id="scannerLiveIndicator" style="display:inline-flex;align-items:center;gap:6px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:6px 14px;font-size:12px;color:#888;">
        <span style="width:8px;height:8px;border-radius:50%;background:#555;display:inline-block;" id="scannerDot"></span>
        No Active Scans
      </span>
      <button style="background:linear-gradient(135deg,#00ccff 0%,#0099cc 100%);color:#0d0d0d;border:none;border-radius:8px;padding:8px 18px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;" title="Refresh all data">
        <i class="fas fa-sync-alt"></i> Refresh
      </button>
    </div>
  </div>

  <!-- ===================== SECTION 1: CHARTINK SCANNER ===================== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
      <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
        <i class="fas fa-chart-bar" style="color:#00ccff;margin-right:8px;"></i>Chartink Scanner
      </h3>
      <span style="font-size:11px;color:#888;background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;">
        <i class="fas fa-link" style="margin-right:4px;color:#00ccff;"></i>Paste any Chartink screener URL to auto-scan
      </span>
    </div>

    <!-- Chartink URL Input -->
    <div style="margin-bottom:18px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">Chartink Screener URL</label>
      <div style="display:flex;gap:8px;">
        <div style="flex:1;position:relative;">
          <i class="fas fa-globe" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);color:#555;font-size:13px;"></i>
          <input type="text" id="chartinkUrl" placeholder="https://chartink.com/screener/your-screener-name" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px 10px 36px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
        </div>
        <button style="background:#111;border:1px solid #333;border-radius:8px;padding:10px 16px;color:#00ccff;font-size:13px;cursor:pointer;white-space:nowrap;" title="Validate URL">
          <i class="fas fa-check-circle"></i> Validate
        </button>
      </div>
    </div>

    <!-- Scanner Configuration Grid -->
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;margin-bottom:20px;">

      <!-- Scan Interval -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-clock" style="color:#00ccff;margin-right:4px;"></i>Scan Interval
        </label>
        <select id="scanInterval" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
          <option value="1">1 Minute</option>
          <option value="5" selected>5 Minutes</option>
          <option value="15">15 Minutes</option>
        </select>
      </div>

      <!-- Start Time -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-play-circle" style="color:#00cc88;margin-right:4px;"></i>Start Time
        </label>
        <input type="time" id="scanStartTime" value="09:15" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;" />
      </div>

      <!-- End Time -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-stop-circle" style="color:#ff4444;margin-right:4px;"></i>End Time
        </label>
        <input type="time" id="scanEndTime" value="15:15" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;" />
      </div>

      <!-- No New Trade Time -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-ban" style="color:#ff8800;margin-right:4px;"></i>No-New-Trade After
        </label>
        <input type="time" id="noNewTradeTime" value="14:30" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;" />
      </div>

      <!-- Capital Per Stock -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-rupee-sign" style="color:#00ccff;margin-right:4px;"></i>Capital Per Stock
        </label>
        <select id="capitalMode" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
          <option value="auto">Auto (Equal Split)</option>
          <option value="fixedQty">Fixed Quantity</option>
          <option value="fixedAmt">Fixed Amount</option>
        </select>
      </div>

      <!-- Capital Value -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-coins" style="color:#ffcc00;margin-right:4px;"></i>Value (Qty / Amount)
        </label>
        <input type="number" id="capitalValue" placeholder="e.g. 50000" value="50000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>

      <!-- Max Trades -->
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-layer-group" style="color:#aa66ff;margin-right:4px;"></i>Max Trades
        </label>
        <input type="number" id="maxTrades" placeholder="Max trades" value="10" min="1" max="50" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>

    </div>

    <!-- SL / Target / TSL Row -->
    <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:16px;margin-bottom:20px;">
      <h4 style="margin:0 0 14px 0;font-size:13px;color:#aaa;font-weight:600;">
        <i class="fas fa-shield-alt" style="color:#00ccff;margin-right:6px;"></i>Risk Management
      </h4>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;">

        <!-- Stop Loss -->
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Stop Loss (%)</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input type="number" id="slPercent" placeholder="SL %" value="1.5" step="0.1" min="0" style="flex:1;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff4444;font-size:13px;font-weight:600;outline:none;" onfocus="this.style.borderColor='#ff4444'" onblur="this.style.borderColor='#333'" />
            <span style="color:#ff4444;font-size:13px;font-weight:700;">%</span>
          </div>
        </div>

        <!-- Target -->
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Target (%)</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input type="number" id="targetPercent" placeholder="Target %" value="3.0" step="0.1" min="0" style="flex:1;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#00cc88;font-size:13px;font-weight:600;outline:none;" onfocus="this.style.borderColor='#00cc88'" onblur="this.style.borderColor='#333'" />
            <span style="color:#00cc88;font-size:13px;font-weight:700;">%</span>
          </div>
        </div>

        <!-- Trailing Stop Loss -->
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Trailing SL (%)</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input type="number" id="tslPercent" placeholder="TSL %" value="0.5" step="0.1" min="0" style="flex:1;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff8800;font-size:13px;font-weight:600;outline:none;" onfocus="this.style.borderColor='#ff8800'" onblur="this.style.borderColor='#333'" />
            <span style="color:#ff8800;font-size:13px;font-weight:700;">%</span>
          </div>
        </div>

        <!-- TSL Trigger -->
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">TSL Activation (%)</label>
          <div style="display:flex;align-items:center;gap:6px;">
            <input type="number" id="tslTrigger" placeholder="Activate at %" value="1.5" step="0.1" min="0" style="flex:1;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ffcc00;font-size:13px;font-weight:600;outline:none;" onfocus="this.style.borderColor='#ffcc00'" onblur="this.style.borderColor='#333'" />
            <span style="color:#ffcc00;font-size:13px;font-weight:700;">%</span>
          </div>
        </div>

      </div>
    </div>

    <!-- Start / Stop Buttons -->
    <div style="display:flex;gap:12px;flex-wrap:wrap;">
      <button id="btnStartScanner" onclick="startChartinkScanner()" style="flex:1;min-width:180px;background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:10px;padding:12px 24px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:transform 0.15s,box-shadow 0.15s;box-shadow:0 4px 15px rgba(0,204,136,0.3);" onmouseenter="this.style.transform='translateY(-1px)';this.style.boxShadow='0 6px 20px rgba(0,204,136,0.4)'" onmouseleave="this.style.transform='translateY(0)';this.style.boxShadow='0 4px 15px rgba(0,204,136,0.3)'">
        <i class="fas fa-play"></i> Start Scanner
      </button>
      <button id="btnStopScanner" onclick="stopChartinkScanner()" style="flex:1;min-width:180px;background:linear-gradient(135deg,#ff4444 0%,#cc2222 100%);color:#fff;border:none;border-radius:10px;padding:12px 24px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;opacity:0.5;pointer-events:none;transition:transform 0.15s,box-shadow 0.15s;box-shadow:0 4px 15px rgba(255,68,68,0.2);" onmouseenter="this.style.transform='translateY(-1px)'" onmouseleave="this.style.transform='translateY(0)'">
        <i class="fas fa-stop"></i> Stop Scanner
      </button>
      <button style="background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:12px 20px;color:#aaa;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;" title="Save current configuration as preset">
        <i class="fas fa-save"></i> Save Preset
      </button>
    </div>
  </div>

  <!-- Active Scanners List -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
      <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
        <i class="fas fa-satellite-dish" style="color:#00ccff;margin-right:8px;"></i>Active Scanners
      </h3>
      <span style="font-size:12px;color:#888;">Real-time monitoring</span>
    </div>

    <div id="activeScannersContainer" style="display:flex;flex-direction:column;gap:10px;">

      <!-- Active Scanner Item 1 -->
      <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="width:10px;height:10px;border-radius:50%;background:#00cc88;box-shadow:0 0 8px rgba(0,204,136,0.6);animation:scannerPulse 1.5s infinite;"></div>
          <div>
            <div style="font-size:13px;font-weight:600;color:#fff;">Volume Breakout Scanner</div>
            <div style="font-size:11px;color:#888;margin-top:2px;">
              <i class="fas fa-clock" style="margin-right:4px;"></i>Interval: 5 min &nbsp;|&nbsp;
              <i class="fas fa-exchange-alt" style="margin-right:4px;"></i>Trades: 3/10 &nbsp;|&nbsp;
              <i class="fas fa-calendar-alt" style="margin-right:4px;"></i>Started: 09:15 AM
            </div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:600;padding:4px 12px;border-radius:6px;border:1px solid rgba(0,204,136,0.3);">
            <i class="fas fa-circle" style="font-size:6px;margin-right:4px;vertical-align:middle;"></i>RUNNING
          </span>
          <span style="font-size:12px;color:#aaa;">Last scan: 12:45:32</span>
          <button style="background:transparent;border:1px solid #ff4444;border-radius:6px;padding:5px 12px;color:#ff4444;font-size:11px;cursor:pointer;" title="Stop this scanner">
            <i class="fas fa-stop"></i>
          </button>
        </div>
      </div>

      <!-- Active Scanner Item 2 -->
      <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="width:10px;height:10px;border-radius:50%;background:#00cc88;box-shadow:0 0 8px rgba(0,204,136,0.6);animation:scannerPulse 1.5s infinite;"></div>
          <div>
            <div style="font-size:13px;font-weight:600;color:#fff;">RSI Oversold Reversal</div>
            <div style="font-size:11px;color:#888;margin-top:2px;">
              <i class="fas fa-clock" style="margin-right:4px;"></i>Interval: 1 min &nbsp;|&nbsp;
              <i class="fas fa-exchange-alt" style="margin-right:4px;"></i>Trades: 1/5 &nbsp;|&nbsp;
              <i class="fas fa-calendar-alt" style="margin-right:4px;"></i>Started: 09:20 AM
            </div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:600;padding:4px 12px;border-radius:6px;border:1px solid rgba(0,204,136,0.3);">
            <i class="fas fa-circle" style="font-size:6px;margin-right:4px;vertical-align:middle;"></i>RUNNING
          </span>
          <span style="font-size:12px;color:#aaa;">Last scan: 12:45:01</span>
          <button style="background:transparent;border:1px solid #ff4444;border-radius:6px;padding:5px 12px;color:#ff4444;font-size:11px;cursor:pointer;" title="Stop this scanner">
            <i class="fas fa-stop"></i>
          </button>
        </div>
      </div>

      <!-- Active Scanner Item 3 - No New Trade state -->
      <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:14px 18px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;opacity:0.7;">
        <div style="display:flex;align-items:center;gap:12px;">
          <div style="width:10px;height:10px;border-radius:50%;background:#ff8800;box-shadow:0 0 8px rgba(255,136,0,0.4);"></div>
          <div>
            <div style="font-size:13px;font-weight:600;color:#fff;">Gap Up Opening Scanner</div>
            <div style="font-size:11px;color:#888;margin-top:2px;">
              <i class="fas fa-clock" style="margin-right:4px;"></i>Interval: 15 min &nbsp;|&nbsp;
              <i class="fas fa-exchange-alt" style="margin-right:4px;"></i>Trades: 5/10 &nbsp;|&nbsp;
              <i class="fas fa-calendar-alt" style="margin-right:4px;"></i>Started: 09:15 AM
            </div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="background:rgba(255,136,0,0.15);color:#ff8800;font-size:11px;font-weight:600;padding:4px 12px;border-radius:6px;border:1px solid rgba(255,136,0,0.3);">
            <i class="fas fa-pause" style="font-size:8px;margin-right:4px;vertical-align:middle;"></i>NO NEW TRADES
          </span>
          <span style="font-size:12px;color:#aaa;">After 14:30</span>
          <button style="background:transparent;border:1px solid #ff4444;border-radius:6px;padding:5px 12px;color:#ff4444;font-size:11px;cursor:pointer;" title="Stop this scanner">
            <i class="fas fa-stop"></i>
          </button>
        </div>
      </div>

    </div>

    <!-- Empty State (hidden by default, shown when no scanners active) -->
    <div id="noActiveScannersMsg" style="display:none;text-align:center;padding:30px 20px;">
      <i class="fas fa-satellite-dish" style="font-size:36px;color:#333;margin-bottom:12px;display:block;"></i>
      <p style="color:#555;font-size:13px;margin:0;">No active scanners. Configure and start a scanner above.</p>
    </div>
  </div>


  <!-- ===================== SECTION 2: CUSTOM SCANNER TEMPLATES ===================== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
      <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
        <i class="fas fa-magic" style="color:#00ccff;margin-right:8px;"></i>Custom Scanner Templates
      </h3>
      <span style="font-size:12px;color:#888;">Click a template to configure and run</span>
    </div>

    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;">

      <!-- Template 1: Volume Breakout -->
      <div onclick="loadScanTemplate('volumeBreakout')" style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;" onmouseenter="this.style.borderColor='#00ccff';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 25px rgba(0,204,255,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
        <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,255,0.08) 0%,transparent 70%);"></div>
        <div style="width:42px;height:42px;background:rgba(0,204,255,0.1);border:1px solid rgba(0,204,255,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
          <i class="fas fa-volume-up" style="color:#00ccff;font-size:18px;"></i>
        </div>
        <h4 style="margin:0 0 6px 0;font-size:14px;font-weight:600;color:#fff;">Volume Breakout</h4>
        <p style="margin:0;font-size:11px;color:#777;line-height:1.5;">Stocks with volume surge &gt; 3x average with price breaking resistance levels</p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
          <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:2px 8px;border-radius:4px;">Intraday</span>
          <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:2px 8px;border-radius:4px;">High Win%</span>
        </div>
      </div>

      <!-- Template 2: 52 Week High -->
      <div onclick="loadScanTemplate('52weekHigh')" style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;" onmouseenter="this.style.borderColor='#00cc88';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 25px rgba(0,204,136,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
        <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,136,0.08) 0%,transparent 70%);"></div>
        <div style="width:42px;height:42px;background:rgba(0,204,136,0.1);border:1px solid rgba(0,204,136,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
          <i class="fas fa-arrow-up" style="color:#00cc88;font-size:18px;"></i>
        </div>
        <h4 style="margin:0 0 6px 0;font-size:14px;font-weight:600;color:#fff;">52 Week High</h4>
        <p style="margin:0;font-size:11px;color:#777;line-height:1.5;">Stocks making new 52-week highs with strong momentum and above-average volume</p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
          <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:2px 8px;border-radius:4px;">Momentum</span>
          <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:2px 8px;border-radius:4px;">Breakout</span>
        </div>
      </div>

      <!-- Template 3: Gap Up > 2% -->
      <div onclick="loadScanTemplate('gapUp')" style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;" onmouseenter="this.style.borderColor='#ffcc00';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 25px rgba(255,204,0,0.12)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
        <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(255,204,0,0.08) 0%,transparent 70%);"></div>
        <div style="width:42px;height:42px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
          <i class="fas fa-bolt" style="color:#ffcc00;font-size:18px;"></i>
        </div>
        <h4 style="margin:0 0 6px 0;font-size:14px;font-weight:600;color:#fff;">Gap Up &gt; 2%</h4>
        <p style="margin:0;font-size:11px;color:#777;line-height:1.5;">Stocks opening &gt; 2% above previous close, indicating strong bullish sentiment</p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
          <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:2px 8px;border-radius:4px;">Opening</span>
          <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:2px 8px;border-radius:4px;">9:15 AM</span>
        </div>
      </div>

      <!-- Template 4: RSI Oversold -->
      <div onclick="loadScanTemplate('rsiOversold')" style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;" onmouseenter="this.style.borderColor='#aa66ff';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 25px rgba(170,102,255,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
        <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(170,102,255,0.08) 0%,transparent 70%);"></div>
        <div style="width:42px;height:42px;background:rgba(170,102,255,0.1);border:1px solid rgba(170,102,255,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
          <i class="fas fa-chart-line" style="color:#aa66ff;font-size:18px;"></i>
        </div>
        <h4 style="margin:0 0 6px 0;font-size:14px;font-weight:600;color:#fff;">RSI Oversold</h4>
        <p style="margin:0;font-size:11px;color:#777;line-height:1.5;">Stocks with RSI below 30, potential reversal candidates with volume confirmation</p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
          <span style="font-size:10px;color:#aa66ff;background:rgba(170,102,255,0.1);padding:2px 8px;border-radius:4px;">Reversal</span>
          <span style="font-size:10px;color:#ff4444;background:rgba(255,68,68,0.1);padding:2px 8px;border-radius:4px;">RSI &lt; 30</span>
        </div>
      </div>

      <!-- Template 5: Moving Average Crossover -->
      <div onclick="loadScanTemplate('maCrossover')" style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:20px;cursor:pointer;transition:all 0.25s;position:relative;overflow:hidden;" onmouseenter="this.style.borderColor='#ff6699';this.style.transform='translateY(-3px)';this.style.boxShadow='0 8px 25px rgba(255,102,153,0.12)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
        <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(255,102,153,0.08) 0%,transparent 70%);"></div>
        <div style="width:42px;height:42px;background:rgba(255,102,153,0.1);border:1px solid rgba(255,102,153,0.2);border-radius:10px;display:flex;align-items:center;justify-content:center;margin-bottom:14px;">
          <i class="fas fa-wave-square" style="color:#ff6699;font-size:18px;"></i>
        </div>
        <h4 style="margin:0 0 6px 0;font-size:14px;font-weight:600;color:#fff;">Moving Average Crossover</h4>
        <p style="margin:0;font-size:11px;color:#777;line-height:1.5;">EMA 9/21 crossover with VWAP support, ideal for trend-following strategies</p>
        <div style="margin-top:12px;display:flex;align-items:center;gap:6px;">
          <span style="font-size:10px;color:#ff6699;background:rgba(255,102,153,0.1);padding:2px 8px;border-radius:4px;">Trend</span>
          <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:2px 8px;border-radius:4px;">EMA Cross</span>
        </div>
      </div>

    </div>
  </div>


  <!-- ===================== SECTION 3: SCAN RESULTS TABLE ===================== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px;">
      <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
        <i class="fas fa-table" style="color:#00ccff;margin-right:8px;"></i>Scan Results
      </h3>
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
        <!-- Auto Refresh Indicator -->
        <span style="display:inline-flex;align-items:center;gap:6px;font-size:11px;color:#00cc88;background:rgba(0,204,136,0.1);border:1px solid rgba(0,204,136,0.2);border-radius:6px;padding:5px 12px;">
          <span style="width:6px;height:6px;border-radius:50%;background:#00cc88;display:inline-block;animation:scannerPulse 1.5s infinite;"></span>
          Auto-Refresh ON
        </span>
        <!-- Result Count -->
        <span style="font-size:12px;color:#888;">
          <i class="fas fa-list" style="margin-right:4px;"></i>
          <span id="scanResultCount">8</span> results
        </span>
        <!-- Export Button -->
        <button onclick="exportScanResults()" style="background:#111;border:1px solid #333;border-radius:8px;padding:7px 14px;color:#00ccff;font-size:12px;cursor:pointer;display:flex;align-items:center;gap:6px;transition:border-color 0.2s;" onmouseenter="this.style.borderColor='#00ccff'" onmouseleave="this.style.borderColor='#333'">
          <i class="fas fa-file-export"></i> Export CSV
        </button>
      </div>
    </div>

    <!-- Table Container -->
    <div style="overflow-x:auto;border-radius:8px;border:1px solid #2a2a2a;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;">
        <thead>
          <tr style="background:#111;">
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-clock" style="margin-right:4px;color:#555;"></i>Time
            </th>
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-tag" style="margin-right:4px;color:#555;"></i>Symbol
            </th>
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-university" style="margin-right:4px;color:#555;"></i>Exchange
            </th>
            <th style="padding:12px 14px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-signal" style="margin-right:4px;color:#555;"></i>Signal
            </th>
            <th style="padding:12px 14px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-rupee-sign" style="margin-right:4px;color:#555;"></i>Price
            </th>
            <th style="padding:12px 14px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-chart-bar" style="margin-right:4px;color:#555;"></i>Volume
            </th>
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;white-space:nowrap;">
              <i class="fas fa-crosshairs" style="margin-right:4px;color:#555;"></i>Scanner
            </th>
          </tr>
        </thead>
        <tbody id="scanResultsBody">

          <!-- Row 1 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:45:32</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">TATAMOTORS</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">985.50</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">2,45,890</td>
            <td style="padding:10px 14px;color:#00ccff;white-space:nowrap;font-size:12px;">Volume Breakout</td>
          </tr>

          <!-- Row 2 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:44:10</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">RELIANCE</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">2,456.75</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">5,12,340</td>
            <td style="padding:10px 14px;color:#00cc88;white-space:nowrap;font-size:12px;">52 Week High</td>
          </tr>

          <!-- Row 3 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:40:05</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">HDFCBANK</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(255,68,68,0.15);color:#ff4444;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(255,68,68,0.3);letter-spacing:0.5px;">SELL</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">1,632.20</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">3,89,120</td>
            <td style="padding:10px 14px;color:#aa66ff;white-space:nowrap;font-size:12px;">RSI Oversold</td>
          </tr>

          <!-- Row 4 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:35:22</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">INFY</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">1,478.90</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">1,78,450</td>
            <td style="padding:10px 14px;color:#ff6699;white-space:nowrap;font-size:12px;">MA Crossover</td>
          </tr>

          <!-- Row 5 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:30:45</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">SBIN</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">612.35</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">8,92,100</td>
            <td style="padding:10px 14px;color:#ffcc00;white-space:nowrap;font-size:12px;">Gap Up &gt; 2%</td>
          </tr>

          <!-- Row 6 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:25:18</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">ICICIBANK</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">BSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(255,68,68,0.15);color:#ff4444;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(255,68,68,0.3);letter-spacing:0.5px;">SELL</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">1,045.60</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">4,56,780</td>
            <td style="padding:10px 14px;color:#00ccff;white-space:nowrap;font-size:12px;">Volume Breakout</td>
          </tr>

          <!-- Row 7 -->
          <tr style="border-bottom:1px solid #1e1e1e;transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:20:33</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">TCS</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">3,821.45</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">1,23,560</td>
            <td style="padding:10px 14px;color:#00cc88;white-space:nowrap;font-size:12px;">52 Week High</td>
          </tr>

          <!-- Row 8 -->
          <tr style="transition:background 0.15s;" onmouseenter="this.style.background='#151515'" onmouseleave="this.style.background='transparent'">
            <td style="padding:10px 14px;color:#ccc;white-space:nowrap;font-family:'Courier New',monospace;font-size:12px;">12:15:50</td>
            <td style="padding:10px 14px;color:#fff;font-weight:600;white-space:nowrap;">BAJFINANCE</td>
            <td style="padding:10px 14px;color:#aaa;white-space:nowrap;">NSE</td>
            <td style="padding:10px 14px;text-align:center;">
              <span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:11px;font-weight:700;padding:3px 14px;border-radius:4px;border:1px solid rgba(0,204,136,0.3);letter-spacing:0.5px;">BUY</span>
            </td>
            <td style="padding:10px 14px;color:#fff;text-align:right;font-family:'Courier New',monospace;">6,543.80</td>
            <td style="padding:10px 14px;color:#aaa;text-align:right;font-family:'Courier New',monospace;">2,34,670</td>
            <td style="padding:10px 14px;color:#ff6699;white-space:nowrap;font-size:12px;">MA Crossover</td>
          </tr>

        </tbody>
      </table>
    </div>

    <!-- Table Footer -->
    <div style="display:flex;align-items:center;justify-content:space-between;margin-top:14px;flex-wrap:wrap;gap:10px;">
      <div style="font-size:11px;color:#555;">
        <i class="fas fa-info-circle" style="margin-right:4px;"></i>Results auto-refresh every scan interval. Latest signals appear on top.
      </div>
      <div style="display:flex;align-items:center;gap:8px;">
        <button style="background:#111;border:1px solid #2a2a2a;border-radius:6px;padding:6px 12px;color:#888;font-size:12px;cursor:pointer;" title="Clear all results">
          <i class="fas fa-trash-alt" style="margin-right:4px;"></i>Clear
        </button>
        <button onclick="exportScanResults()" style="background:#111;border:1px solid #2a2a2a;border-radius:6px;padding:6px 12px;color:#888;font-size:12px;cursor:pointer;" title="Export as CSV">
          <i class="fas fa-download" style="margin-right:4px;"></i>Download
        </button>
      </div>
    </div>
  </div>

  <!-- Pulse Animation Keyframes -->
  <style>
    @keyframes scannerPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
  </style>

</div>

        <div class="content-page hidden" id="strategyCreationPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

  <!-- Page Header -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
    <div>
      <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
        <i class="fas fa-chess-board" style="color:#00ccff;margin-right:10px;"></i>Strategy Creation
      </h2>
      <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Build, test, and deploy option & indicator strategies</p>
    </div>
    <div style="display:flex;gap:8px;">
      <select id="sb_savedStrategies" style="background:#111;border:1px solid #333;border-radius:8px;padding:8px 12px;color:#fff;font-size:12px;outline:none;min-width:180px;">
        <option value="">-- Load Saved Strategy --</option>
      </select>
      <button onclick="loadSavedStrategy()" style="background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:8px 12px;color:#aaa;font-size:12px;cursor:pointer;"><i class="fas fa-folder-open"></i></button>
    </div>
  </div>

  <!-- ===== QUICK STRATEGY BUTTONS ===== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:16px;margin-bottom:20px;">
    <h4 style="margin:0 0 12px 0;font-size:13px;color:#aa66ff;font-weight:600;">
      <i class="fas fa-magic" style="margin-right:6px;"></i>Quick Strategies (One-Click)
    </h4>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button onclick="applyQuickStrategy('iron_fly')" style="background:rgba(170,102,255,0.1);color:#aa66ff;border:1px solid rgba(170,102,255,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(170,102,255,0.2)'" onmouseleave="this.style.background='rgba(170,102,255,0.1)'">
        <i class="fas fa-shield-alt" style="margin-right:4px;"></i>Iron Fly
      </button>
      <button onclick="applyQuickStrategy('iron_condor')" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'">
        <i class="fas fa-layer-group" style="margin-right:4px;"></i>Iron Condor
      </button>
      <button onclick="applyQuickStrategy('straddle')" style="background:rgba(255,136,0,0.1);color:#ff8800;border:1px solid rgba(255,136,0,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,136,0,0.2)'" onmouseleave="this.style.background='rgba(255,136,0,0.1)'">
        <i class="fas fa-arrows-alt-h" style="margin-right:4px;"></i>Straddle
      </button>
      <button onclick="applyQuickStrategy('strangle')" style="background:rgba(0,204,136,0.1);color:#00cc88;border:1px solid rgba(0,204,136,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,136,0.2)'" onmouseleave="this.style.background='rgba(0,204,136,0.1)'">
        <i class="fas fa-expand-alt" style="margin-right:4px;"></i>Strangle
      </button>
      <button onclick="applyQuickStrategy('bull_call')" style="background:rgba(0,200,83,0.1);color:#00c853;border:1px solid rgba(0,200,83,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,200,83,0.2)'" onmouseleave="this.style.background='rgba(0,200,83,0.1)'">
        <i class="fas fa-arrow-up" style="margin-right:4px;"></i>Bull Call
      </button>
      <button onclick="applyQuickStrategy('bear_put')" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'">
        <i class="fas fa-arrow-down" style="margin-right:4px;"></i>Bear Put
      </button>
    </div>
  </div>

  <!-- ===== SYMBOL & CONFIG ROW ===== -->
  <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:14px;margin-bottom:20px;">
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Strategy Name</label>
      <input type="text" id="sb_name" placeholder="My Custom Strategy" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Symbol</label>
      <select id="sb_instrument" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;">
        <option value="NIFTY">NIFTY 50</option>
        <option value="BANKNIFTY">BANK NIFTY</option>
        <option value="FINNIFTY">FIN NIFTY</option>
        <option value="MIDCPNIFTY">MIDCAP NIFTY</option>
        <option value="SENSEX">SENSEX</option>
      </select>
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Spot Price</label>
      <div style="display:flex;gap:6px;">
        <input type="number" id="sb_spotPrice" placeholder="0.00" style="flex:1;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" />
        <button onclick="fetchSpotPrice()" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:8px;padding:8px 12px;font-size:11px;cursor:pointer;white-space:nowrap;"><i class="fas fa-sync-alt"></i></button>
      </div>
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;font-weight:500;">Expiry</label>
      <select id="sb_expiry" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;">
        <option value="current_week">Current Week</option>
        <option value="next_week">Next Week</option>
        <option value="current_month">Current Month</option>
        <option value="next_month">Next Month</option>
      </select>
    </div>
  </div>

  <!-- ===== OPTION LEGS TABLE ===== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
      <h3 style="margin:0;font-size:15px;font-weight:600;color:#fff;">
        <i class="fas fa-list" style="color:#aa66ff;margin-right:8px;"></i>Strategy Legs <span id="legCountBadge" style="background:#333;color:#888;font-size:10px;padding:2px 8px;border-radius:10px;margin-left:6px;">0 / 4</span>
      </h3>
      <div style="display:flex;gap:6px;">
        <button onclick="refreshLegLTP()" style="background:#111;border:1px solid #333;border-radius:6px;padding:6px 12px;color:#888;font-size:11px;cursor:pointer;"><i class="fas fa-sync-alt" style="margin-right:3px;"></i>Refresh LTP</button>
        <button onclick="clearAllLegs()" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer;"><i class="fas fa-trash" style="margin-right:3px;"></i>Clear All</button>
      </div>
    </div>

    <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;min-width:700px;">
        <thead>
          <tr style="background:#111;">
            <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Action</th>
            <th style="padding:10px 12px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Type</th>
            <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Strike</th>
            <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Lots</th>
            <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Premium</th>
            <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">LTP</th>
            <th style="padding:10px 12px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Remove</th>
          </tr>
        </thead>
        <tbody id="sb_legsBody">
          <!-- Legs populated dynamically -->
        </tbody>
      </table>
    </div>

    <!-- Add Leg Controls -->
    <div style="display:flex;gap:8px;align-items:center;margin-top:14px;flex-wrap:wrap;padding:12px;background:#111;border-radius:8px;border:1px solid #2a2a2a;">
      <select id="sb_legAction" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
        <option value="BUY" style="color:#00c853;">BUY</option>
        <option value="SELL" style="color:#ff4444;">SELL</option>
      </select>
      <select id="sb_legType" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
        <option value="CE">CE (Call)</option>
        <option value="PE">PE (Put)</option>
        <option value="FUT">FUT (Future)</option>
      </select>
      <select id="sb_legStrikeMode" onchange="toggleManualStrike()" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
        <option value="ATM">ATM</option>
        <option value="OTM+1">OTM +1</option>
        <option value="OTM+2">OTM +2</option>
        <option value="OTM+3">OTM +3</option>
        <option value="ITM-1">ITM -1</option>
        <option value="ITM-2">ITM -2</option>
        <option value="manual">Manual</option>
      </select>
      <input type="number" id="sb_legStrike" placeholder="Strike " step="50" style="display:none;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;width:100px;" />
      <input type="number" id="sb_legLots" value="1" min="1" max="100" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;width:60px;" placeholder="Lots" />
      <input type="number" id="sb_legPremium" placeholder="Premium " step="0.05" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;width:100px;" />
      <button onclick="addOptionLeg()" style="background:linear-gradient(135deg,#00cc88,#009966);color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:4px;">
        <i class="fas fa-plus"></i> Add Leg
      </button>
    </div>
  </div>

  <!-- ===== P&L SUMMARY + EXIT CONDITIONS ===== -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">

    <!-- P&L Summary -->
    <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;">
      <h4 style="margin:0 0 14px 0;font-size:13px;color:#00ccff;font-weight:600;">
        <i class="fas fa-calculator" style="margin-right:6px;"></i>Strategy Summary
      </h4>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Max Profit</div>
          <div id="sb_maxProfit" style="font-size:18px;font-weight:700;color:#00c853;">&#8377;0.00</div>
        </div>
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Max Loss</div>
          <div id="sb_maxLoss" style="font-size:18px;font-weight:700;color:#ff4444;">&#8377;0.00</div>
        </div>
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Breakeven</div>
          <div id="sb_breakeven" style="font-size:18px;font-weight:700;color:#fff;">--</div>
        </div>
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Net Premium</div>
          <div id="sb_netPremium" style="font-size:18px;font-weight:700;color:#00ccff;">&#8377;0.00</div>
        </div>
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Risk : Reward</div>
          <div id="sb_riskReward" style="font-size:18px;font-weight:700;color:#ff8800;">--</div>
        </div>
        <div style="background:#111;border-radius:8px;padding:12px;text-align:center;">
          <div style="font-size:10px;color:#555;text-transform:uppercase;margin-bottom:4px;">Total Lots</div>
          <div id="sb_totalLots" style="font-size:18px;font-weight:700;color:#aa66ff;">0</div>
        </div>
      </div>
    </div>

    <!-- Exit Conditions -->
    <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;">
      <h4 style="margin:0 0 14px 0;font-size:13px;color:#ff4444;font-weight:600;">
        <i class="fas fa-sign-out-alt" style="margin-right:6px;"></i>Exit Configuration
      </h4>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Exit Type</label>
          <select id="sb_exitType" style="width:100%;background:#111;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
            <option value="manual">Manual</option>
            <option value="sl_price">SL Price (per leg)</option>
            <option value="sl_percent">SL % (per leg)</option>
            <option value="tsl_percent">Trailing SL %</option>
            <option value="tsl_points">Trailing SL Points</option>
            <option value="target_price">Target Price</option>
            <option value="target_percent">Target %</option>
            <option value="pnl_based">P&L Based (combined)</option>
          </select>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
          <div>
            <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Stop Loss</label>
            <input type="number" id="sb_sl" value="1.5" step="0.1" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff4444;font-size:13px;font-weight:600;outline:none;" />
          </div>
          <div>
            <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Target</label>
            <input type="number" id="sb_target" value="3.0" step="0.1" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#00cc88;font-size:13px;font-weight:600;outline:none;" />
          </div>
          <div>
            <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Trailing SL</label>
            <input type="number" id="sb_tsl" value="0.5" step="0.1" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff8800;font-size:13px;font-weight:600;outline:none;" />
          </div>
          <div>
            <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Max Trades/Day</label>
            <input type="number" id="sb_maxTrades" value="5" min="1" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#00ccff;font-size:13px;font-weight:600;outline:none;" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== INDICATOR-BASED ENTRY CONDITIONS ===== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
    <h4 style="margin:0 0 14px 0;font-size:13px;color:#00cc88;font-weight:600;">
      <i class="fas fa-chart-area" style="margin-right:6px;"></i>Entry Conditions (Indicator Based) <span style="font-weight:400;color:#555;font-size:11px;">- Optional, for auto-entry signals</span>
    </h4>
    <div id="sb_entryConditions" style="display:flex;flex-direction:column;gap:10px;">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
        <select style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
          <option>RSI (14)</option><option>EMA (9)</option><option>EMA (21)</option><option>MACD</option><option>Supertrend</option><option>VWAP</option><option>Bollinger Bands</option><option>Volume</option><option>CPR Level</option><option>Pivot Points</option>
        </select>
        <select style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;">
          <option>crosses above</option><option>crosses below</option><option>is above</option><option>is below</option><option>equals</option>
        </select>
        <input type="text" placeholder="Value or Indicator" style="background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#fff;font-size:12px;outline:none;width:150px;" />
        <button style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 10px;font-size:11px;cursor:pointer;"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <button onclick="addEntryCondition()" style="margin-top:10px;background:rgba(0,204,136,0.1);color:#00cc88;border:1px solid rgba(0,204,136,0.3);border-radius:6px;padding:6px 14px;font-size:11px;cursor:pointer;">
      <i class="fas fa-plus" style="margin-right:4px;"></i>Add Condition
    </button>
  </div>

  <!-- ===== ACTION BUTTONS ===== -->
  <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
    <button onclick="saveStrategyToMarketplace()" style="flex:1;min-width:180px;background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:10px;padding:14px 24px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 15px rgba(0,204,136,0.3);">
      <i class="fas fa-save"></i> Save to Marketplace
    </button>
    <button onclick="deployCustomStrategy()" style="flex:1;min-width:180px;background:linear-gradient(135deg,#00ccff 0%,#0088cc 100%);color:#fff;border:none;border-radius:10px;padding:14px 24px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 15px rgba(0,204,255,0.3);">
      <i class="fas fa-rocket"></i> Save & Deploy Now
    </button>
    <button onclick="executeStrategy()" style="flex:1;min-width:180px;background:linear-gradient(135deg,#ff8800 0%,#cc6600 100%);color:#fff;border:none;border-radius:10px;padding:14px 24px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 15px rgba(255,136,0,0.3);">
      <i class="fas fa-play"></i> Execute Now
    </button>
    <button onclick="backtestStrategy()" style="background:#1a1a1a;border:1px solid #333;border-radius:10px;padding:14px 20px;color:#aaa;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;">
      <i class="fas fa-history"></i> Backtest
    </button>
    <button onclick="deleteCurrentStrategy()" style="background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.3);border-radius:10px;padding:14px 20px;color:#ff4444;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px;">
      <i class="fas fa-trash"></i> Delete
    </button>
  </div>

        </div>

        <div class="content-page hidden" id="reportPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- ============================================================== -->

<!-- Page Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-chart-bar" style="color:#00ccff;margin-right:10px;"></i>Reports & Analytics
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Trade journal, performance metrics, and detailed trade history.</p>
  </div>
  <div style="display:flex;align-items:center;gap:8px;">
    <span style="display:inline-flex;align-items:center;gap:6px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:6px 14px;font-size:12px;color:#888;">
      <i class="fas fa-calendar" style="color:#00ccff;"></i> <span id="rpt_dateRangeLabel">Today</span>
    </span>
  </div>
</div>

<!-- Date Filter Row -->
<div style="display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;align-items:center;">
  <button onclick="rptFilterDate('today', this)" class="rpt_filter_btn" style="background:#00ccff;color:#000;border:none;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;">Today</button>
  <button onclick="rptFilterDate('week', this)" class="rpt_filter_btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;">This Week</button>
  <button onclick="rptFilterDate('month', this)" class="rpt_filter_btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;">This Month</button>
  <button onclick="rptFilterDate('30days', this)" class="rpt_filter_btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;">Last 30 Days</button>
  <button onclick="rptFilterDate('custom', this)" class="rpt_filter_btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;">Custom</button>
  <div id="rpt_customRange" style="display:none;align-items:center;gap:6px;">
    <input type="date" id="rpt_startDate" style="padding:7px 10px;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:6px;font-size:12px;">
    <span style="color:#555;">to</span>
    <input type="date" id="rpt_endDate" style="padding:7px 10px;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:6px;font-size:12px;">
    <button onclick="rptApplyCustomDate()" style="background:#00ccff;color:#000;border:none;border-radius:6px;padding:7px 14px;font-size:12px;font-weight:600;cursor:pointer;">Apply</button>
  </div>
  <div style="margin-left:auto;display:flex;gap:8px;">
    <button onclick="rptRefreshData()" style="background:#1a1a1a;color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.1)'" onmouseleave="this.style.background='#1a1a1a'">
      <i class="fas fa-sync-alt"></i> Refresh
    </button>
    <button onclick="rptExportCSV()" style="background:#1a1a1a;color:#00cc88;border:1px solid rgba(0,204,136,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,136,0.1)'" onmouseleave="this.style.background='#1a1a1a'">
      <i class="fas fa-file-csv"></i> Export CSV
    </button>
  </div>
</div>

<!-- Performance Summary Cards -->
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px;margin-bottom:28px;">
  <!-- Total P&L -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,200,83,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Total P&L</div>
    <div id="rpt_totalPL" style="font-size:24px;font-weight:700;color:#00c853;">+&#8377;24,560</div>
    <div style="font-size:10px;color:#00cc88;margin-top:4px;"><i class="fas fa-arrow-up"></i> +12.3% from capital</div>
  </div>
  <!-- Total Trades -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Total Trades</div>
    <div id="rpt_totalTrades" style="font-size:24px;font-weight:700;color:#00ccff;">42</div>
    <div style="font-size:10px;color:#888;margin-top:4px;"><i class="fas fa-exchange-alt" style="color:#00ccff;"></i> 28 Buy / 14 Sell</div>
  </div>
  <!-- Win Rate -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,136,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Win Rate</div>
    <div id="rpt_winRate" style="font-size:24px;font-weight:700;color:#00cc88;">68.5%</div>
    <div style="font-size:10px;color:#00cc88;margin-top:4px;"><i class="fas fa-trophy"></i> Above average</div>
  </div>
  <!-- Profit Factor -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(170,102,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Profit Factor</div>
    <div id="rpt_profitFactor" style="font-size:24px;font-weight:700;color:#aa66ff;">2.14</div>
    <div style="font-size:10px;color:#aa66ff;margin-top:4px;"><i class="fas fa-chart-line"></i> Strong ratio</div>
  </div>
  <!-- Avg Win/Loss -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(255,136,0,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Avg Win / Loss</div>
    <div id="rpt_avgWinLoss" style="font-size:24px;font-weight:700;color:#ff8800;">1.85</div>
    <div style="font-size:10px;color:#888;margin-top:4px;"><span style="color:#00c853;">&#8377;1,240</span> / <span style="color:#ff4444;">&#8377;670</span></div>
  </div>
  <!-- Max Drawdown -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(255,68,68,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;">Max Drawdown</div>
    <div id="rpt_maxDrawdown" style="font-size:24px;font-weight:700;color:#ff4444;">-&#8377;8,320</div>
    <div style="font-size:10px;color:#ff4444;margin-top:4px;"><i class="fas fa-arrow-down"></i> -3.4% from peak</div>
  </div>
</div>

<!-- Detailed Statistics Panel -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:28px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-chart-pie" style="color:#aa66ff;margin-right:8px;"></i>Detailed Statistics
  </h3>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-check-circle" style="color:#00c853;margin-right:8px;"></i>Winning Trades</span>
      <span style="font-size:14px;font-weight:700;color:#00c853;">29</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-times-circle" style="color:#ff4444;margin-right:8px;"></i>Losing Trades</span>
      <span style="font-size:14px;font-weight:700;color:#ff4444;">13</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-arrow-up" style="color:#00c853;margin-right:8px;"></i>Largest Win</span>
      <span style="font-size:14px;font-weight:700;color:#00c853;">+&#8377;5,680</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-arrow-down" style="color:#ff4444;margin-right:8px;"></i>Largest Loss</span>
      <span style="font-size:14px;font-weight:700;color:#ff4444;">-&#8377;3,240</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-balance-scale" style="color:#ff8800;margin-right:8px;"></i>Avg Trade P&L</span>
      <span style="font-size:14px;font-weight:700;color:#00cc88;">+&#8377;585</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-clock" style="color:#00ccff;margin-right:8px;"></i>Avg Hold Time</span>
      <span style="font-size:14px;font-weight:700;color:#00ccff;">2h 15m</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-cubes" style="color:#aa66ff;margin-right:8px;"></i>Total Volume</span>
      <span style="font-size:14px;font-weight:700;color:#aa66ff;">3,450 Qty</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-receipt" style="color:#ff8800;margin-right:8px;"></i>Est. Brokerage</span>
      <span style="font-size:14px;font-weight:700;color:#ff8800;">&#8377;840</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-star" style="color:#00c853;margin-right:8px;"></i>Best Symbol</span>
      <span style="font-size:14px;font-weight:700;color:#00c853;">RELIANCE</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-exclamation-triangle" style="color:#ff4444;margin-right:8px;"></i>Worst Symbol</span>
      <span style="font-size:14px;font-weight:700;color:#ff4444;">TATAMOTORS</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-fire" style="color:#ff8800;margin-right:8px;"></i>Most Traded</span>
      <span style="font-size:14px;font-weight:700;color:#ff8800;">NIFTY 50</span>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#0d0d0d;border-radius:8px;border:1px solid #222;">
      <span style="font-size:13px;color:#888;"><i class="fas fa-bolt" style="color:#00cc88;margin-right:8px;"></i>Max Consecutive Wins</span>
      <span style="font-size:14px;font-weight:700;color:#00cc88;">7</span>
    </div>
  </div>
</div>

<!-- Trade History Table -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
    <h3 style="margin:0;font-size:16px;font-weight:700;color:#fff;">
      <i class="fas fa-history" style="color:#00ccff;margin-right:8px;"></i>Trade History
    </h3>
    <div style="display:flex;gap:8px;align-items:center;">
      <select id="rpt_symbolFilter" onchange="rptFilterBySymbol()" style="padding:7px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:6px;font-size:12px;cursor:pointer;">
        <option value="all">All Symbols</option>
        <option value="RELIANCE">RELIANCE</option>
        <option value="NIFTY 50">NIFTY 50</option>
        <option value="BANKNIFTY">BANKNIFTY</option>
        <option value="TATAMOTORS">TATAMOTORS</option>
        <option value="INFY">INFY</option>
        <option value="HDFCBANK">HDFCBANK</option>
      </select>
      <div style="position:relative;">
        <input type="text" id="rpt_searchInput" oninput="rptSearchTrades()" placeholder="Search trades..." style="padding:7px 12px 7px 32px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:6px;font-size:12px;width:180px;">
        <i class="fas fa-search" style="position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#555;font-size:11px;"></i>
      </div>
    </div>
  </div>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table id="rpt_tradeTable" style="width:100%;border-collapse:collapse;font-size:12px;min-width:900px;">
      <thead>
        <tr style="background:#0d0d0d;">
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Date</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Time</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Symbol</th>
          <th style="padding:12px 10px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Side</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Qty</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Entry</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Exit</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">P&L &#8377;</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">P&L %</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Strategy</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Notes</th>
        </tr>
      </thead>
      <tbody id="rpt_tradeBody">
        <tr class="rpt_trade_row" data-symbol="RELIANCE" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">18 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">09:32:15</td>
          <td style="padding:10px;color:#fff;font-weight:600;">RELIANCE</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">50</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;2,456.30</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;2,478.50</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;1,110</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+0.90%</td>
          <td style="padding:10px;color:#aa66ff;font-size:11px;">CPR Strategy</td>
          <td style="padding:10px;color:#666;font-size:11px;">Breakout above R1</td>
        </tr>
        <tr class="rpt_trade_row" data-symbol="NIFTY 50" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">18 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">10:15:42</td>
          <td style="padding:10px;color:#fff;font-weight:600;">NIFTY 50</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(255,68,68,0.15);color:#ff4444;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">SELL</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">75</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;22,340.00</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;22,280.00</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;4,500</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+0.27%</td>
          <td style="padding:10px;color:#ff8800;font-size:11px;">Scalping</td>
          <td style="padding:10px;color:#666;font-size:11px;">Rejected at VWAP</td>
        </tr>
        <tr class="rpt_trade_row" data-symbol="BANKNIFTY" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">17 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">11:05:30</td>
          <td style="padding:10px;color:#fff;font-weight:600;">BANKNIFTY</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">25</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;47,850.00</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;47,720.00</td>
          <td style="padding:10px;text-align:right;color:#ff4444;font-weight:600;">-&#8377;3,250</td>
          <td style="padding:10px;text-align:right;color:#ff4444;">-0.27%</td>
          <td style="padding:10px;color:#00ccff;font-size:11px;">TradingView</td>
          <td style="padding:10px;color:#666;font-size:11px;">SL hit at support</td>
        </tr>
        <tr class="rpt_trade_row" data-symbol="TATAMOTORS" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">17 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">13:22:18</td>
          <td style="padding:10px;color:#fff;font-weight:600;">TATAMOTORS</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">100</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;765.20</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;752.80</td>
          <td style="padding:10px;text-align:right;color:#ff4444;font-weight:600;">-&#8377;1,240</td>
          <td style="padding:10px;text-align:right;color:#ff4444;">-1.62%</td>
          <td style="padding:10px;color:#aa66ff;font-size:11px;">CPR Strategy</td>
          <td style="padding:10px;color:#666;font-size:11px;">Failed breakout</td>
        </tr>
        <tr class="rpt_trade_row" data-symbol="INFY" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">16 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">09:48:55</td>
          <td style="padding:10px;color:#fff;font-weight:600;">INFY</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(255,68,68,0.15);color:#ff4444;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">SELL</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">200</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,845.60</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,832.10</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;2,700</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+0.73%</td>
          <td style="padding:10px;color:#ff8800;font-size:11px;">Scalping</td>
          <td style="padding:10px;color:#666;font-size:11px;">Weak earnings gap down</td>
        </tr>
        <tr class="rpt_trade_row" data-symbol="HDFCBANK" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">16 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">14:10:05</td>
          <td style="padding:10px;color:#fff;font-weight:600;">HDFCBANK</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">75</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,678.40</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,695.80</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;1,305</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+1.04%</td>
          <td style="padding:10px;color:#00ccff;font-size:11px;">TradingView</td>
          <td style="padding:10px;color:#666;font-size:11px;">Momentum continuation</td>
        </tr>
      </tbody>
    </table>
  </div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px;">
    <span style="font-size:11px;color:#555;">Showing <span id="rpt_showCount">6</span> of 6 trades</span>
    <span style="font-size:11px;color:#555;">Last updated: <span id="rpt_lastUpdated">Just now</span></span>
  </div>
</div>

<!-- Reports JavaScript -->
<script>
function rptFilterDate(range, btn) {
  document.querySelectorAll('.rpt_filter_btn').forEach(function(b) {
    b.style.background = '#1a1a1a';
    b.style.color = '#888';
    b.style.border = '1px solid #333';
  });
  btn.style.background = '#00ccff';
  btn.style.color = '#000';
  btn.style.border = 'none';

  var customEl = document.getElementById('rpt_customRange');
  var labelEl = document.getElementById('rpt_dateRangeLabel');
  if (range === 'custom') {
    customEl.style.display = 'flex';
    labelEl.textContent = 'Custom Range';
  } else {
    customEl.style.display = 'none';
    var labels = { today: 'Today', week: 'This Week', month: 'This Month', '30days': 'Last 30 Days' };
    labelEl.textContent = labels[range] || range;
  }
}

function rptApplyCustomDate() {
  var s = document.getElementById('rpt_startDate').value;
  var e = document.getElementById('rpt_endDate').value;
  if (s && e) {
    document.getElementById('rpt_dateRangeLabel').textContent = s + ' to ' + e;
  }
}

function rptRefreshData() {
  document.getElementById('rpt_lastUpdated').textContent = 'Just now';
  var btn = event.currentTarget;
  var icon = btn.querySelector('i');
  icon.style.animation = 'spin 0.6s linear';
  setTimeout(function() { icon.style.animation = ''; }, 600);
}

function rptExportCSV() {
  var rows = [['Date','Time','Symbol','Side','Qty','Entry','Exit','P&L','P&L%','Strategy','Notes']];
  document.querySelectorAll('#rpt_tradeBody tr.rpt_trade_row').forEach(function(tr) {
    if (tr.style.display !== 'none') {
      var cells = tr.querySelectorAll('td');
      var row = [];
      cells.forEach(function(c) { row.push(c.textContent.trim()); });
      rows.push(row);
    }
  });
  var csv = rows.map(function(r) { return r.join(','); }).join('\n');
  var blob = new Blob([csv], { type: 'text/csv' });
  var url = URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.download = 'mukesh_algo_trades_' + new Date().toISOString().slice(0,10) + '.csv';
  a.click();
  URL.revokeObjectURL(url);
}

function rptFilterBySymbol() {
  var val = document.getElementById('rpt_symbolFilter').value;
  var count = 0;
  document.querySelectorAll('#rpt_tradeBody tr.rpt_trade_row').forEach(function(tr) {
    if (val === 'all' || tr.getAttribute('data-symbol') === val) {
      tr.style.display = '';
      count++;
    } else {
      tr.style.display = 'none';
    }
  });
  document.getElementById('rpt_showCount').textContent = count;
}

function rptSearchTrades() {
  var q = document.getElementById('rpt_searchInput').value.toLowerCase();
  var count = 0;
  document.querySelectorAll('#rpt_tradeBody tr.rpt_trade_row').forEach(function(tr) {
    if (tr.textContent.toLowerCase().indexOf(q) > -1) {
      tr.style.display = '';
      count++;
    } else {
      tr.style.display = 'none';
    }
  });
  document.getElementById('rpt_showCount').textContent = count;
}
</script>


<!-- ============================================================== -->
        </div>

        <!-- ===== ENHANCED BROKER PAGE ===== -->
        <div class="content-page hidden" id="brokerPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

            <h2><i class="fas fa-university"></i> Broker Management</h2>

            <!-- Connection Status Banner -->
            <div id="brokerStatusBanner" style="background: #1a1a2e; padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; border: 1px solid #2a2a3e;">
                <div id="brokerStatusDot" style="width: 12px; height: 12px; border-radius: 50%; background: #ff4444;"></div>
                <div>
                    <div id="brokerStatusText" style="color: #fff; font-weight: 600;">Not Connected</div>
                    <div id="brokerStatusDetail" style="color: #888; font-size: 12px;">Configure and connect a broker below</div>
                </div>
            </div>

            <!-- Broker Connection -->
            <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: var(--accent-color); margin-bottom: 20px;">
                    <i class="fas fa-plug"></i> Connect Broker
                </h3>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div style="grid-column: 1 / -1;">
                        <label style="display: block; margin-bottom: 8px; color: #aaa;">Select Broker</label>
                        <select id="brokerSelect" onchange="onBrokerChange()" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px; font-size: 14px;">
                            <option value="alice_blue" selected>Alice Blue (NSE/BSE/NFO)</option>
                            <option value="upstox">Upstox (NSE/BSE/NFO)</option>
                            <option value="exness">Exness - MT5 (Forex/Crypto/Commodities)</option>
                        </select>
                    </div>

                    <!-- Alice Blue Fields -->
                    <div id="fieldsAliceBlue">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">User ID</label>
                                <input type="text" id="clientId" placeholder="e.g. 515175" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">Secret Key (long key)</label>
                                <input type="password" id="apiKey" placeholder="Paste your Secret Key" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                            <div style="grid-column: 1 / -1;">
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">App Code (optional - not needed for direct login)</label>
                                <input type="text" id="apiSecret" placeholder="e.g. cabzLFoeRT" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                        </div>
                    </div>

                    <!-- Upstox Fields -->
                    <div id="fieldsUpstox" style="display:none; grid-column: 1 / -1;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">API Key</label>
                                <input type="text" id="upstoxApiKey" placeholder="Your Upstox API Key" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">API Secret</label>
                                <input type="password" id="upstoxApiSecret" placeholder="Your Upstox API Secret" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                        </div>
                        <p style="color:#666; font-size: 11px; margin-top: 8px;">Get API Key & Secret from <a href="https://account.upstox.com/developer/apps" target="_blank" style="color:#00ccff;">Upstox Developer Console</a></p>
                    </div>

                    <!-- Exness/MT5 Fields -->
                    <div id="fieldsExness" style="display:none; grid-column: 1 / -1;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">MT5 Account Number</label>
                                <input type="text" id="exnessLogin" placeholder="e.g. 12345678" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">MT5 Password</label>
                                <input type="password" id="exnessPassword" placeholder="Your MT5 password" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                            <div style="grid-column: 1 / -1;">
                                <label style="display: block; margin-bottom: 8px; color: #aaa;">Server Name</label>
                                <input type="text" id="exnessServer" placeholder="e.g. Exness-MT5Real, Exness-MT5Real2" style="width:100%; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                            </div>
                        </div>
                        <p style="color:#ff8800; font-size: 11px; margin-top: 8px;"><i class="fas fa-exclamation-triangle"></i> MetaTrader 5 terminal must be installed and running on your computer. <a href="https://download.mql5.com/cdn/web/exness.technologies.ltd/mt5/exness5setup.exe" target="_blank" style="color:#00ccff;">Download MT5</a></p>
                    </div>
                </div>

                <!-- Step 1: Get Login URL (OAuth brokers) / Connect (MT5) -->
                <div style="margin-top: 20px;">
                    <button onclick="brokerGetLoginUrl()" id="btnGetLoginUrl" style="width:100%; padding:12px; background: linear-gradient(135deg, #0077ff, #0055cc); border:none; color:#fff; border-radius:5px; cursor:pointer; font-weight:bold; font-size: 14px;">
                        <i class="fas fa-sign-in-alt"></i> Step 1: Get Login URL
                    </button>
                </div>

                <!-- Login URL Display (for OAuth brokers) -->
                <div id="loginUrlSection" style="display:none; margin-top: 15px; background: #222; padding: 15px; border-radius: 8px; border: 1px solid #333;">
                    <label style="display: block; margin-bottom: 8px; color: #aaa;">Login URL (click to open in browser):</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="loginUrlDisplay" readonly style="flex:1; padding:10px; background:#1a1a1a; color:#00ccff; border:1px solid #333; border-radius:5px; font-size: 11px;">
                        <button onclick="window.open(document.getElementById('loginUrlDisplay').value, '_blank')" style="padding:10px 15px; background:#00aa66; border:none; color:#fff; border-radius:5px; cursor:pointer; font-weight:bold; white-space:nowrap;">
                            <i class="fas fa-external-link-alt"></i> Open
                        </button>
                    </div>
                    <p style="color:#888; font-size: 11px; margin-top: 8px;">Login  Authorize  Copy authCode from the URL after redirect</p>
                </div>

                <!-- Step 2: Authenticate with Auth Code (OAuth brokers) -->
                <div id="authCodeSection" style="display:none; margin-top: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #aaa;">Authorization Code (from URL after login):</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="authCodeInput" placeholder="Paste authCode here" style="flex:1; padding:10px; background:#333; color:#fff; border:none; border-radius:5px;">
                        <button onclick="brokerAuthenticate()" id="btnAuthenticate" style="padding:10px 20px; background:#00aa66; border:none; color:#fff; border-radius:5px; cursor:pointer; font-weight:bold; white-space:nowrap;">
                            <i class="fas fa-check-circle"></i> Step 2: Authenticate
                        </button>
                    </div>
                </div>

                <!-- Auth Result -->
                <div id="authResult" style="display:none; margin-top: 15px; padding: 12px; border-radius: 8px;"></div>
            </div>

            <!-- Connected Brokers (Live) -->
            <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="color: var(--accent-color); margin-bottom: 15px;">
                    <i class="fas fa-link"></i> Connected Brokers <span id="connectedCount" style="background:#0077ff; color:#fff; font-size:11px; padding:2px 8px; border-radius:10px; margin-left:8px;">0</span>
                </h3>
                <div id="connectedBrokersList" style="max-height: 400px; overflow-y: auto;">
                    <p style="color:#666; text-align:center; padding: 20px;">No brokers connected yet. Connect above to start trading.</p>
                </div>
                <p style="color:#666; font-size:11px; margin-top:10px;"><i class="fas fa-info-circle"></i> Multiple brokers can be connected simultaneously. The <span style="color:#00ff88;">ACTIVE</span> broker is used for trading. Click "Use for Trading" to switch.</p>
            </div>
        </div>

        <div class="content-page hidden" id="profilePage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- ============================================================== -->

<!-- Profile Header -->
<div style="display:flex;align-items:center;gap:24px;margin-bottom:28px;flex-wrap:wrap;">
  <div style="width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,#00ccff,#aa66ff);display:flex;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:#fff;text-shadow:0 2px 8px rgba(0,0,0,0.4);border:3px solid rgba(0,204,255,0.4);box-shadow:0 0 24px rgba(0,204,255,0.2);">MK</div>
  <div>
    <h2 style="margin:0;font-size:24px;font-weight:700;color:#fff;">Mukeshbhai</h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;"><i class="fas fa-calendar-alt" style="margin-right:6px;color:#555;"></i>Member since January 2025</p>
    <div style="margin-top:10px;display:flex;align-items:center;gap:10px;">
      <span style="display:inline-flex;align-items:center;gap:6px;background:rgba(0,200,83,0.12);border:1px solid rgba(0,200,83,0.3);color:#00c853;padding:5px 14px;border-radius:20px;font-size:12px;font-weight:600;">
        <span style="width:8px;height:8px;border-radius:50%;background:#00c853;display:inline-block;box-shadow:0 0 6px #00c853;"></span> Active
      </span>
      <span style="display:inline-flex;align-items:center;gap:6px;background:rgba(170,102,255,0.1);border:1px solid rgba(170,102,255,0.3);color:#aa66ff;padding:5px 14px;border-radius:20px;font-size:12px;font-weight:600;">
        <i class="fas fa-crown"></i> Pro Plan
      </span>
    </div>
  </div>
</div>

<!-- Account Overview Cards -->
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-bottom:28px;">
  <!-- Available Margin -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-wallet" style="margin-right:6px;color:#00ccff;"></i>Available Margin</div>
    <div style="font-size:22px;font-weight:700;color:#00ccff;">&#8377;2,45,000</div>
    <div style="margin-top:8px;background:#222;border-radius:4px;height:4px;overflow:hidden;">
      <div style="width:68%;height:100%;background:linear-gradient(90deg,#00ccff,#0099ff);border-radius:4px;"></div>
    </div>
    <div style="font-size:10px;color:#555;margin-top:4px;">68% of total balance</div>
  </div>
  <!-- Used Margin -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(255,136,0,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-lock" style="margin-right:6px;color:#ff8800;"></i>Used Margin</div>
    <div style="font-size:22px;font-weight:700;color:#ff8800;">&#8377;1,15,000</div>
    <div style="margin-top:8px;background:#222;border-radius:4px;height:4px;overflow:hidden;">
      <div style="width:32%;height:100%;background:linear-gradient(90deg,#ff8800,#ff6600);border-radius:4px;"></div>
    </div>
    <div style="font-size:10px;color:#555;margin-top:4px;">32% of total balance</div>
  </div>
  <!-- Total Balance -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(170,102,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-university" style="margin-right:6px;color:#aa66ff;"></i>Total Balance</div>
    <div style="font-size:22px;font-weight:700;color:#aa66ff;">&#8377;3,60,000</div>
    <div style="font-size:10px;color:#00cc88;margin-top:6px;"><i class="fas fa-arrow-up"></i> +8.2% from initial deposit</div>
  </div>
  <!-- Today's P&L -->
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,200,83,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-chart-line" style="margin-right:6px;color:#00c853;"></i>Today's P&L</div>
    <div style="font-size:22px;font-weight:700;color:#00c853;">+&#8377;12,450</div>
    <div style="font-size:10px;color:#00cc88;margin-top:6px;"><i class="fas fa-arrow-up"></i> +3.5% today</div>
  </div>
</div>

<!-- Trading Statistics Section -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:28px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-chart-bar" style="color:#00ccff;margin-right:8px;"></i>Trading Statistics (This Month)
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;">
    <div style="display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div>
        <div style="font-size:11px;color:#666;margin-bottom:4px;">Total Trades</div>
        <div style="font-size:20px;font-weight:700;color:#00ccff;">156</div>
      </div>
      <div style="width:42px;height:42px;background:rgba(0,204,255,0.1);border-radius:10px;display:flex;align-items:center;justify-content:center;">
        <i class="fas fa-exchange-alt" style="color:#00ccff;font-size:16px;"></i>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div>
        <div style="font-size:11px;color:#666;margin-bottom:4px;">Win Rate</div>
        <div style="font-size:20px;font-weight:700;color:#00cc88;">68%</div>
      </div>
      <div style="width:42px;height:42px;background:rgba(0,204,136,0.1);border-radius:10px;display:flex;align-items:center;justify-content:center;">
        <i class="fas fa-trophy" style="color:#00cc88;font-size:16px;"></i>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div>
        <div style="font-size:11px;color:#666;margin-bottom:4px;">Avg Daily P&L</div>
        <div style="font-size:20px;font-weight:700;color:#00c853;">+&#8377;4,150</div>
      </div>
      <div style="width:42px;height:42px;background:rgba(0,200,83,0.1);border-radius:10px;display:flex;align-items:center;justify-content:center;">
        <i class="fas fa-rupee-sign" style="color:#00c853;font-size:16px;"></i>
      </div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;padding:14px 18px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div>
        <div style="font-size:11px;color:#666;margin-bottom:4px;">Active Strategies</div>
        <div style="font-size:20px;font-weight:700;color:#aa66ff;">3</div>
      </div>
      <div style="width:42px;height:42px;background:rgba(170,102,255,0.1);border-radius:10px;display:flex;align-items:center;justify-content:center;">
        <i class="fas fa-chess-board" style="color:#aa66ff;font-size:16px;"></i>
      </div>
    </div>
  </div>
</div>

<!-- Connected Brokers Summary -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:28px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-plug" style="color:#00cc88;margin-right:8px;"></i>Connected Brokers
  </h3>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table style="width:100%;border-collapse:collapse;font-size:13px;">
      <thead>
        <tr style="background:#0d0d0d;">
          <th style="padding:12px 16px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Broker</th>
          <th style="padding:12px 16px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Type</th>
          <th style="padding:12px 16px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Status</th>
          <th style="padding:12px 16px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Last Connected</th>
          <th style="padding:12px 16px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Active</th>
        </tr>
      </thead>
      <tbody>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:12px 16px;color:#fff;font-weight:600;"><i class="fas fa-building" style="color:#00ccff;margin-right:8px;"></i>Alice Blue</td>
          <td style="padding:12px 16px;color:#888;">NSE / BSE / NFO</td>
          <td style="padding:12px 16px;text-align:center;"><span style="display:inline-flex;align-items:center;gap:6px;"><span style="width:8px;height:8px;border-radius:50%;background:#00c853;display:inline-block;box-shadow:0 0 6px #00c853;"></span><span style="color:#00c853;font-size:12px;">Connected</span></span></td>
          <td style="padding:12px 16px;color:#aaa;">18 Feb 2026, 09:15</td>
          <td style="padding:12px 16px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">PRIMARY</span></td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:12px 16px;color:#fff;font-weight:600;"><i class="fas fa-building" style="color:#ff8800;margin-right:8px;"></i>Upstox</td>
          <td style="padding:12px 16px;color:#888;">NSE / BSE / NFO</td>
          <td style="padding:12px 16px;text-align:center;"><span style="display:inline-flex;align-items:center;gap:6px;"><span style="width:8px;height:8px;border-radius:50%;background:#00c853;display:inline-block;box-shadow:0 0 6px #00c853;"></span><span style="color:#00c853;font-size:12px;">Connected</span></span></td>
          <td style="padding:12px 16px;color:#aaa;">17 Feb 2026, 10:30</td>
          <td style="padding:12px 16px;text-align:center;"><span style="background:rgba(255,255,255,0.05);color:#555;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BACKUP</span></td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:12px 16px;color:#fff;font-weight:600;"><i class="fas fa-globe" style="color:#aa66ff;margin-right:8px;"></i>Exness (MT5)</td>
          <td style="padding:12px 16px;color:#888;">Forex / Crypto</td>
          <td style="padding:12px 16px;text-align:center;"><span style="display:inline-flex;align-items:center;gap:6px;"><span style="width:8px;height:8px;border-radius:50%;background:#ff4444;display:inline-block;box-shadow:0 0 6px #ff4444;"></span><span style="color:#ff4444;font-size:12px;">Disconnected</span></span></td>
          <td style="padding:12px 16px;color:#aaa;">15 Feb 2026, 14:00</td>
          <td style="padding:12px 16px;text-align:center;"><span style="background:rgba(255,68,68,0.1);color:#ff4444;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">OFFLINE</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Notification Preferences -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:28px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-bell" style="color:#ff8800;margin-right:8px;"></i>Notification Preferences
  </h3>
  <div style="display:grid;gap:0;">
    <!-- Trade Alerts -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #222;">
      <div>
        <div style="font-size:14px;color:#fff;font-weight:500;"><i class="fas fa-bolt" style="color:#00ccff;margin-right:10px;width:18px;text-align:center;"></i>Trade Alerts</div>
        <div style="font-size:11px;color:#666;margin-top:3px;padding-left:28px;">Get notified when trades are executed</div>
      </div>
      <label style="position:relative;display:inline-block;width:48px;height:26px;cursor:pointer;">
        <input type="checkbox" id="prf_tradeAlerts" checked style="opacity:0;width:0;height:0;" onchange="prfToggleNotif(this)">
        <span style="position:absolute;top:0;left:0;right:0;bottom:0;background:#00cc88;border-radius:13px;transition:0.3s;"></span>
        <span style="position:absolute;height:20px;width:20px;left:24px;bottom:3px;background:#fff;border-radius:50%;transition:0.3s;"></span>
      </label>
    </div>
    <!-- P&L Updates -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #222;">
      <div>
        <div style="font-size:14px;color:#fff;font-weight:500;"><i class="fas fa-rupee-sign" style="color:#00c853;margin-right:10px;width:18px;text-align:center;"></i>P&L Updates</div>
        <div style="font-size:11px;color:#666;margin-top:3px;padding-left:28px;">Periodic profit/loss summary notifications</div>
      </div>
      <label style="position:relative;display:inline-block;width:48px;height:26px;cursor:pointer;">
        <input type="checkbox" id="prf_plUpdates" checked style="opacity:0;width:0;height:0;" onchange="prfToggleNotif(this)">
        <span style="position:absolute;top:0;left:0;right:0;bottom:0;background:#00cc88;border-radius:13px;transition:0.3s;"></span>
        <span style="position:absolute;height:20px;width:20px;left:24px;bottom:3px;background:#fff;border-radius:50%;transition:0.3s;"></span>
      </label>
    </div>
    <!-- Strategy Signals -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 0;border-bottom:1px solid #222;">
      <div>
        <div style="font-size:14px;color:#fff;font-weight:500;"><i class="fas fa-signal" style="color:#aa66ff;margin-right:10px;width:18px;text-align:center;"></i>Strategy Signals</div>
        <div style="font-size:11px;color:#666;margin-top:3px;padding-left:28px;">Alerts when strategy conditions are triggered</div>
      </div>
      <label style="position:relative;display:inline-block;width:48px;height:26px;cursor:pointer;">
        <input type="checkbox" id="prf_stratSignals" checked style="opacity:0;width:0;height:0;" onchange="prfToggleNotif(this)">
        <span style="position:absolute;top:0;left:0;right:0;bottom:0;background:#00cc88;border-radius:13px;transition:0.3s;"></span>
        <span style="position:absolute;height:20px;width:20px;left:24px;bottom:3px;background:#fff;border-radius:50%;transition:0.3s;"></span>
      </label>
    </div>
    <!-- Market News -->
    <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 0;">
      <div>
        <div style="font-size:14px;color:#fff;font-weight:500;"><i class="fas fa-newspaper" style="color:#ff8800;margin-right:10px;width:18px;text-align:center;"></i>Market News</div>
        <div style="font-size:11px;color:#666;margin-top:3px;padding-left:28px;">Breaking market news and important updates</div>
      </div>
      <label style="position:relative;display:inline-block;width:48px;height:26px;cursor:pointer;">
        <input type="checkbox" id="prf_marketNews" style="opacity:0;width:0;height:0;" onchange="prfToggleNotif(this)">
        <span style="position:absolute;top:0;left:0;right:0;bottom:0;background:#333;border-radius:13px;transition:0.3s;"></span>
        <span style="position:absolute;height:20px;width:20px;left:4px;bottom:3px;background:#888;border-radius:50%;transition:0.3s;"></span>
      </label>
    </div>
  </div>
</div>

<!-- Danger Zone -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid rgba(255,68,68,0.3);border-radius:14px;padding:24px;">
  <h3 style="margin:0 0 6px 0;font-size:16px;font-weight:700;color:#ff4444;">
    <i class="fas fa-exclamation-triangle" style="margin-right:8px;"></i>Danger Zone
  </h3>
  <p style="font-size:12px;color:#666;margin:0 0 20px 0;">These actions are irreversible. Please proceed with caution.</p>
  <div style="display:flex;gap:12px;flex-wrap:wrap;">
    <button onclick="if(confirm('Are you sure you want to reset all data? This cannot be undone.')){alert('Data has been reset.');}" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'">
      <i class="fas fa-trash-alt"></i> Reset All Data
    </button>
    <button onclick="if(confirm('Are you sure you want to logout?')){alert('Logged out successfully.');}" style="background:rgba(255,136,0,0.1);color:#ff8800;border:1px solid rgba(255,136,0,0.3);border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,136,0,0.2)'" onmouseleave="this.style.background='rgba(255,136,0,0.1)'">
      <i class="fas fa-sign-out-alt"></i> Logout
    </button>
  </div>
</div>

<!-- Profile JavaScript -->
<script>
function prfToggleNotif(checkbox) {
  var label = checkbox.parentElement;
  var slider = label.querySelectorAll('span');
  if (checkbox.checked) {
    slider[0].style.background = '#00cc88';
    slider[1].style.left = '24px';
    slider[1].style.background = '#fff';
  } else {
    slider[0].style.background = '#333';
    slider[1].style.left = '4px';
    slider[1].style.background = '#888';
  }
}
</script>


<!-- ============================================================== -->
        </div>

        <div class="content-page hidden" id="marketplacePage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>


  <!-- Page Header -->
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;">
    <div>
      <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
        <i class="fas fa-store" style="color:#00ccff;margin-right:10px;"></i>Strategy Marketplace
      </h2>
      <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Deploy pre-built strategies or create your own. One-click deploy to any connected broker.</p>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <span id="deployedStratCount" style="display:inline-flex;align-items:center;gap:6px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:6px 14px;font-size:12px;color:#888;">
        <span style="width:8px;height:8px;border-radius:50%;background:#00cc88;display:inline-block;"></span>
        <span id="activeStratNum">0</span> Active Strategies
      </span>
    </div>
  </div>

  <!-- Category Filter Tabs -->
  <div style="display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;">
    <button onclick="filterStrategies('all', this)" class="strat-filter-btn" style="background:#00ccff;color:#000;border:none;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;">All Strategies</button>
    <button onclick="filterStrategies('intraday', this)" class="strat-filter-btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;">Intraday</button>
    <button onclick="filterStrategies('positional', this)" class="strat-filter-btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;">Positional</button>
    <button onclick="filterStrategies('options', this)" class="strat-filter-btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;">Options</button>
    <button onclick="filterStrategies('custom', this)" class="strat-filter-btn" style="background:#1a1a1a;color:#888;border:1px solid #333;border-radius:8px;padding:8px 18px;font-size:12px;font-weight:600;cursor:pointer;">My Strategies</button>
  </div>

  <!-- Strategy Cards Grid -->
  <div id="strategyCardsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px;margin-bottom:32px;">

    <!-- CPR Strategy Card -->
    <div class="strat-card" data-category="intraday" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#00ccff';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(0,204,255,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(0,204,255,0.1) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(0,204,255,0.1);border:1px solid rgba(0,204,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-bullseye" style="color:#00ccff;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(0,204,255,0.2);font-weight:600;">INTRADAY</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">CPR Strategy</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Central Pivot Range based option selling. Auto-calculates daily CPR levels and sells OTM options at key support/resistance zones.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:3px 8px;border-radius:4px;">Nifty/BankNifty</span>
        <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:3px 8px;border-radius:4px;">Option Selling</span>
        <span style="font-size:10px;color:#aa66ff;background:rgba(170,102,255,0.1);padding:3px 8px;border-radius:4px;">Auto SL/Target</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">68%</span></div>
          <div><span style="font-size:10px;color:#555;">Avg Return</span><br><span style="font-size:14px;font-weight:700;color:#00ccff;">2.4%</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('cpr')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('cpr')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('cpr')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- TradingView Strategy Card -->
    <div class="strat-card" data-category="intraday" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#ff6699';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(255,102,153,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(255,102,153,0.1) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(255,102,153,0.1);border:1px solid rgba(255,102,153,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-code" style="color:#ff6699;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#ff6699;background:rgba(255,102,153,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(255,102,153,0.2);font-weight:600;">PINE SCRIPT</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">TradingView Strategy</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Import any TradingView Pine Script strategy. Auto-converts Pine indicators to live signals and executes trades through connected brokers.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#ff6699;background:rgba(255,102,153,0.1);padding:3px 8px;border-radius:4px;">Pine Script v5</span>
        <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:3px 8px;border-radius:4px;">Auto-Execute</span>
        <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:3px 8px;border-radius:4px;">Any Timeframe</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Supported</span><br><span style="font-size:14px;font-weight:700;color:#ff6699;">Pine v5</span></div>
          <div><span style="font-size:10px;color:#555;">Indicators</span><br><span style="font-size:14px;font-weight:700;color:#00ccff;">50+</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('tradingview')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('tradingview')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('tradingview')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- Option Hedge Strategy Card -->
    <div class="strat-card" data-category="options" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#aa66ff';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(170,102,255,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(170,102,255,0.1) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(170,102,255,0.1);border:1px solid rgba(170,102,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-shield-alt" style="color:#aa66ff;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#aa66ff;background:rgba(170,102,255,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(170,102,255,0.2);font-weight:600;">OPTIONS</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">Option Hedge Strategy</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Automated option hedging with Iron Condor, Straddle, Strangle strategies. Auto-adjusts positions based on market movement and Greeks.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#aa66ff;background:rgba(170,102,255,0.1);padding:3px 8px;border-radius:4px;">Iron Condor</span>
        <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:3px 8px;border-radius:4px;">Straddle</span>
        <span style="font-size:10px;color:#ff8800;background:rgba(255,136,0,0.1);padding:3px 8px;border-radius:4px;">Auto-Hedge</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Risk</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">Low</span></div>
          <div><span style="font-size:10px;color:#555;">Strategies</span><br><span style="font-size:14px;font-weight:700;color:#aa66ff;">6+</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('option_hedge')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('option_hedge')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('option_hedge')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- RSI Reversal Strategy -->
    <div class="strat-card" data-category="intraday" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#ff4444';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(255,68,68,0.12)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(255,68,68,0.08) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(255,68,68,0.1);border:1px solid rgba(255,68,68,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-chart-line" style="color:#ff4444;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#ff4444;background:rgba(255,68,68,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(255,68,68,0.2);font-weight:600;">INTRADAY</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">RSI Reversal</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Buys oversold stocks (RSI &lt; 30) and sells overbought (RSI &gt; 70) with volume confirmation and VWAP filter.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#ff4444;background:rgba(255,68,68,0.1);padding:3px 8px;border-radius:4px;">RSI Based</span>
        <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:3px 8px;border-radius:4px;">VWAP Filter</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">62%</span></div>
          <div><span style="font-size:10px;color:#555;">Drawdown</span><br><span style="font-size:14px;font-weight:700;color:#ff4444;">-3.2%</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('rsi_reversal')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('rsi_reversal')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('rsi_reversal')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- Supertrend Strategy -->
    <div class="strat-card" data-category="positional" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#00cc88';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(0,204,136,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(0,204,136,0.08) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(0,204,136,0.1);border:1px solid rgba(0,204,136,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-arrow-trend-up" style="color:#00cc88;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(0,204,136,0.2);font-weight:600;">POSITIONAL</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">Supertrend</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">ATR-based Supertrend indicator for trend following. Captures big moves with trailing stop loss mechanism.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:3px 8px;border-radius:4px;">Trend Following</span>
        <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:3px 8px;border-radius:4px;">ATR Based</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">58%</span></div>
          <div><span style="font-size:10px;color:#555;">Avg Profit</span><br><span style="font-size:14px;font-weight:700;color:#00ccff;">4.1%</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('supertrend')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('supertrend')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('supertrend')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- MA Crossover Strategy -->
    <div class="strat-card" data-category="positional" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#ffcc00';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(255,204,0,0.12)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(255,204,0,0.08) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(255,204,0,0.1);border:1px solid rgba(255,204,0,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-wave-square" style="color:#ffcc00;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(255,204,0,0.2);font-weight:600;">POSITIONAL</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">MA Crossover</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">EMA 9/21 crossover with VWAP support. Classic trend-following strategy with customizable moving average periods.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#ffcc00;background:rgba(255,204,0,0.1);padding:3px 8px;border-radius:4px;">EMA Cross</span>
        <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:3px 8px;border-radius:4px;">Configurable</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">55%</span></div>
          <div><span style="font-size:10px;color:#555;">Avg Profit</span><br><span style="font-size:14px;font-weight:700;color:#00ccff;">3.5%</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('ma_crossover')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('ma_crossover')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('ma_crossover')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- Straddle/Strangle Strategy -->
    <div class="strat-card" data-category="options" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#ff8800';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(255,136,0,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(255,136,0,0.08) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(255,136,0,0.1);border:1px solid rgba(255,136,0,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-balance-scale" style="color:#ff8800;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#ff8800;background:rgba(255,136,0,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(255,136,0,0.2);font-weight:600;">OPTIONS</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">Straddle / Strangle</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Short straddle/strangle at market open. Collects premium with defined risk. Auto square-off at target or time-based exit.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#ff8800;background:rgba(255,136,0,0.1);padding:3px 8px;border-radius:4px;">Premium Selling</span>
        <span style="font-size:10px;color:#00cc88;background:rgba(0,204,136,0.1);padding:3px 8px;border-radius:4px;">Theta Decay</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">72%</span></div>
          <div><span style="font-size:10px;color:#555;">Risk</span><br><span style="font-size:14px;font-weight:700;color:#ff8800;">Medium</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('straddle')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('straddle')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('straddle')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- VWAP Scalping -->
    <div class="strat-card" data-category="intraday" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;" onmouseenter="this.style.borderColor='#00ff88';this.style.transform='translateY(-4px)';this.style.boxShadow='0 12px 30px rgba(0,255,136,0.12)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="position:absolute;top:0;right:0;width:80px;height:80px;background:radial-gradient(circle at top right,rgba(0,255,136,0.08) 0%,transparent 70%);"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
        <div style="width:48px;height:48px;background:rgba(0,255,136,0.1);border:1px solid rgba(0,255,136,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-tachometer-alt" style="color:#00ff88;font-size:20px;"></i>
        </div>
        <span style="font-size:10px;color:#00ff88;background:rgba(0,255,136,0.1);padding:4px 10px;border-radius:6px;border:1px solid rgba(0,255,136,0.2);font-weight:600;">INTRADAY</span>
      </div>
      <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">VWAP Scalping</h3>
      <p style="margin:0 0 16px 0;font-size:12px;color:#777;line-height:1.6;">Quick scalps around VWAP levels. Buys at VWAP support and sells at VWAP resistance with tight stop losses.</p>
      <div style="display:flex;gap:6px;margin-bottom:18px;flex-wrap:wrap;">
        <span style="font-size:10px;color:#00ff88;background:rgba(0,255,136,0.1);padding:3px 8px;border-radius:4px;">Scalping</span>
        <span style="font-size:10px;color:#00ccff;background:rgba(0,204,255,0.1);padding:3px 8px;border-radius:4px;">VWAP</span>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;padding-top:16px;border-top:1px solid #222;">
        <div style="display:flex;gap:16px;">
          <div><span style="font-size:10px;color:#555;">Win Rate</span><br><span style="font-size:14px;font-weight:700;color:#00cc88;">65%</span></div>
          <div><span style="font-size:10px;color:#555;">Trades/Day</span><br><span style="font-size:14px;font-weight:700;color:#00ccff;">8-15</span></div>
        </div>
        <div style="display:flex;gap:6px;align-items:center;">
          <button onclick="editStrategy('vwap_scalp')" title="Edit" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.2)'" onmouseleave="this.style.background='rgba(0,204,255,0.1)'"><i class="fas fa-edit"></i></button>
          <button onclick="deleteStrategy('vwap_scalp')" title="Delete" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:8px 10px;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'"><i class="fas fa-trash"></i></button>
          <button onclick="deployStrategy('vwap_scalp')" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:12px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;box-shadow:0 4px 12px rgba(0,204,136,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
            <i class="fas fa-rocket"></i> Deploy
          </button>
        </div>
      </div>
    </div>

    <!-- Strategy Builder Card (Create Custom) -->
    <div class="strat-card" data-category="custom" style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:2px dashed #333;border-radius:14px;padding:24px;position:relative;overflow:hidden;transition:all 0.3s;cursor:pointer;" onclick="openStrategyBuilder()" onmouseenter="this.style.borderColor='#00ccff';this.style.transform='translateY(-4px)'" onmouseleave="this.style.borderColor='#333';this.style.transform='translateY(0)'">
      <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:200px;">
        <div style="width:64px;height:64px;background:rgba(0,204,255,0.1);border:2px dashed rgba(0,204,255,0.3);border-radius:16px;display:flex;align-items:center;justify-content:center;margin-bottom:16px;">
          <i class="fas fa-plus" style="color:#00ccff;font-size:28px;"></i>
        </div>
        <h3 style="margin:0 0 8px 0;font-size:17px;font-weight:700;color:#fff;">Create Custom Strategy</h3>
        <p style="margin:0;font-size:12px;color:#777;line-height:1.6;">Build your own strategy using the visual Strategy Builder. Combine indicators, set rules, and deploy instantly.</p>
      </div>
    </div>

  </div>

  <!-- ===================== DEPLOYED STRATEGIES TABLE ===================== -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap;gap:10px;">
      <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
        <i class="fas fa-play-circle" style="color:#00cc88;margin-right:8px;"></i>Deployed Strategies
      </h3>
      <button onclick="refreshDeployedStrategies()" style="background:#111;border:1px solid #333;border-radius:8px;padding:7px 14px;color:#888;font-size:12px;cursor:pointer;">
        <i class="fas fa-sync-alt" style="margin-right:4px;"></i>Refresh
      </button>
    </div>

    <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
      <table style="width:100%;border-collapse:collapse;font-size:13px;min-width:800px;">
        <thead>
          <tr style="background:#111;">
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">Strategy</th>
            <th style="padding:12px 14px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">Status</th>
            <th style="padding:12px 14px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">Broker</th>
            <th style="padding:12px 14px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">Trades</th>
            <th style="padding:12px 14px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">P&amp;L</th>
            <th style="padding:12px 14px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:1px solid #2a2a2a;">Actions</th>
          </tr>
        </thead>
        <tbody id="deployedStrategiesBody">
          <!-- Deployed strategies populated dynamically -->
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div id="noDeployedStrategies" style="text-align:center;padding:40px 20px;">
      <i class="fas fa-rocket" style="font-size:36px;color:#333;margin-bottom:12px;display:block;"></i>
      <p style="color:#555;font-size:13px;margin:0;">No strategies deployed yet. Click "Deploy" on any strategy card above to get started.</p>
    </div>
  </div>

        </div>

        <div class="content-page hidden" id="paperTradingPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- ============================================================== -->

<!-- Page Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-file-invoice-dollar" style="color:#00ccff;margin-right:10px;"></i>Paper Trading Simulator
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Practice trading with virtual money. No real funds at risk.</p>
  </div>
</div>

<!-- Mode Toggle Banner -->
<div id="pt_modeBanner" style="background:linear-gradient(135deg,rgba(0,204,255,0.08) 0%,rgba(170,102,255,0.08) 100%);border:1px solid rgba(0,204,255,0.3);border-radius:14px;padding:20px 24px;margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;">
  <div style="display:flex;align-items:center;gap:16px;">
    <div style="width:50px;height:50px;background:rgba(0,204,255,0.15);border:1px solid rgba(0,204,255,0.3);border-radius:12px;display:flex;align-items:center;justify-content:center;">
      <i id="pt_modeIcon" class="fas fa-flask" style="color:#00ccff;font-size:22px;"></i>
    </div>
    <div>
      <div style="font-size:16px;font-weight:700;color:#fff;">Current Mode: <span id="pt_modeText" style="color:#00ccff;">Paper Trading</span></div>
      <div id="pt_modeDesc" style="font-size:12px;color:#888;margin-top:3px;"><i class="fas fa-shield-alt" style="color:#00cc88;margin-right:4px;"></i>Virtual money mode - No real trades will be placed</div>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:12px;">
    <span style="font-size:12px;color:#00ccff;font-weight:600;">PAPER</span>
    <label style="position:relative;display:inline-block;width:56px;height:30px;cursor:pointer;">
      <input type="checkbox" id="pt_modeToggle" style="opacity:0;width:0;height:0;" onchange="ptToggleMode(this)">
      <span style="position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#00ccff,#0099cc);border-radius:15px;transition:0.4s;box-shadow:inset 0 2px 4px rgba(0,0,0,0.3);"></span>
      <span style="position:absolute;height:24px;width:24px;left:3px;bottom:3px;background:#fff;border-radius:50%;transition:0.4s;box-shadow:0 2px 4px rgba(0,0,0,0.3);"></span>
    </label>
    <span style="font-size:12px;color:#666;font-weight:600;">LIVE</span>
  </div>
</div>

<!-- Simulator Capital Section -->
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-bottom:24px;">
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,204,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-coins" style="margin-right:6px;color:#00ccff;"></i>Current Capital</div>
    <div id="pt_currentCapital" style="font-size:22px;font-weight:700;color:#00ccff;">&#8377;10,00,000</div>
  </div>
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(170,102,255,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-flag-checkered" style="margin-right:6px;color:#aa66ff;"></i>Starting Capital</div>
    <div style="font-size:22px;font-weight:700;color:#aa66ff;">&#8377;10,00,000</div>
  </div>
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;position:relative;overflow:hidden;">
    <div style="position:absolute;top:0;right:0;width:60px;height:60px;background:radial-gradient(circle at top right,rgba(0,200,83,0.15) 0%,transparent 70%);"></div>
    <div style="font-size:11px;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-chart-line" style="margin-right:6px;color:#00c853;"></i>P&L Today</div>
    <div id="pt_plToday" style="font-size:22px;font-weight:700;color:#888;">&#8377;0</div>
  </div>
  <div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:20px;">
    <div style="font-size:11px;color:#888;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;"><i class="fas fa-sliders-h" style="margin-right:6px;color:#ff8800;"></i>Set Capital</div>
    <div style="display:flex;gap:8px;">
      <input type="number" id="pt_capitalInput" placeholder="Enter amount" value="1000000" style="flex:1;padding:8px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:6px;font-size:13px;">
      <button onclick="ptResetSimulator()" style="background:linear-gradient(135deg,#ff8800,#cc6600);color:#fff;border:none;border-radius:6px;padding:8px 14px;font-size:11px;font-weight:600;cursor:pointer;white-space:nowrap;display:flex;align-items:center;gap:4px;transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.05)'" onmouseleave="this.style.transform='scale(1)'">
        <i class="fas fa-redo"></i> Reset
      </button>
    </div>
  </div>
</div>

<!-- Quick Trade Section -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-bolt" style="color:#ff8800;margin-right:8px;"></i>Quick Paper Trade
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;align-items:end;">
    <!-- Symbol -->
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Symbol</label>
      <select id="pt_symbolSelect" style="width:100%;padding:10px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:8px;font-size:13px;cursor:pointer;">
        <option value="NIFTY 50">NIFTY 50</option>
        <option value="BANKNIFTY">BANKNIFTY</option>
        <option value="RELIANCE">RELIANCE</option>
        <option value="HDFCBANK">HDFCBANK</option>
        <option value="INFY">INFY</option>
        <option value="TATAMOTORS">TATAMOTORS</option>
        <option value="TCS">TCS</option>
        <option value="ICICIBANK">ICICIBANK</option>
      </select>
    </div>
    <!-- Buy/Sell Toggle -->
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Side</label>
      <div style="display:flex;border-radius:8px;overflow:hidden;border:1px solid #333;">
        <button id="pt_buyBtn" onclick="ptSetSide('BUY')" style="flex:1;padding:10px;background:#00c853;color:#fff;border:none;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;">BUY</button>
        <button id="pt_sellBtn" onclick="ptSetSide('SELL')" style="flex:1;padding:10px;background:#1a1a1a;color:#666;border:none;font-size:13px;font-weight:700;cursor:pointer;transition:all 0.2s;">SELL</button>
      </div>
    </div>
    <!-- Quantity -->
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Quantity</label>
      <input type="number" id="pt_qtyInput" value="50" min="1" style="width:100%;padding:10px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:8px;font-size:13px;">
    </div>
    <!-- Price Type -->
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.5px;">Price</label>
      <div style="display:flex;gap:6px;">
        <select id="pt_priceType" onchange="document.getElementById('pt_limitPrice').style.display=this.value==='limit'?'block':'none'" style="flex:1;padding:10px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:8px;font-size:13px;cursor:pointer;">
          <option value="market">Market</option>
          <option value="limit">Limit</option>
        </select>
      </div>
      <input type="number" id="pt_limitPrice" placeholder="Limit price" style="display:none;width:100%;padding:8px 12px;background:#0d0d0d;color:#fff;border:1px solid #333;border-radius:8px;font-size:12px;margin-top:6px;">
    </div>
    <!-- Place Order Button -->
    <div>
      <label style="display:block;font-size:11px;color:transparent;margin-bottom:6px;">&nbsp;</label>
      <button onclick="ptPlaceOrder()" style="width:100%;padding:10px 20px;background:linear-gradient(135deg,#00ccff 0%,#0099cc 100%);color:#fff;border:none;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 12px rgba(0,204,255,0.3);transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
        <i class="fas fa-paper-plane"></i> Place Paper Order
      </button>
    </div>
  </div>
</div>

<!-- Paper Positions Table -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:24px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
    <h3 style="margin:0;font-size:16px;font-weight:700;color:#fff;">
      <i class="fas fa-layer-group" style="color:#aa66ff;margin-right:8px;"></i>Open Paper Positions
      <span style="background:rgba(170,102,255,0.15);color:#aa66ff;font-size:11px;padding:3px 10px;border-radius:10px;margin-left:8px;font-weight:600;">3</span>
    </h3>
  </div>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table style="width:100%;border-collapse:collapse;font-size:12px;min-width:750px;">
      <thead>
        <tr style="background:#0d0d0d;">
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Symbol</th>
          <th style="padding:12px 10px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Side</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Qty</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Avg Price</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Current</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">P&L</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">P&L %</th>
          <th style="padding:12px 10px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Actions</th>
        </tr>
      </thead>
      <tbody id="pt_positionsBody">
        <tr id="pt_pos_0" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#fff;font-weight:600;">RELIANCE</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">50</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;2,456.30</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;2,472.50</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;810</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+0.66%</td>
          <td style="padding:10px;text-align:center;">
            <button onclick="ptClosePosition(0, 'RELIANCE')" style="background:rgba(255,68,68,0.15);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.3)'" onmouseleave="this.style.background='rgba(255,68,68,0.15)'">
              <i class="fas fa-times"></i> Close
            </button>
          </td>
        </tr>
        <tr id="pt_pos_1" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#fff;font-weight:600;">NIFTY 50</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(255,68,68,0.15);color:#ff4444;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">SELL</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">75</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;22,340.00</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;22,310.00</td>
          <td style="padding:10px;text-align:right;color:#00c853;font-weight:600;">+&#8377;2,250</td>
          <td style="padding:10px;text-align:right;color:#00c853;">+0.13%</td>
          <td style="padding:10px;text-align:center;">
            <button onclick="ptClosePosition(1, 'NIFTY 50')" style="background:rgba(255,68,68,0.15);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.3)'" onmouseleave="this.style.background='rgba(255,68,68,0.15)'">
              <i class="fas fa-times"></i> Close
            </button>
          </td>
        </tr>
        <tr id="pt_pos_2" style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#fff;font-weight:600;">INFY</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">100</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,832.10</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,825.40</td>
          <td style="padding:10px;text-align:right;color:#ff4444;font-weight:600;">-&#8377;670</td>
          <td style="padding:10px;text-align:right;color:#ff4444;">-0.37%</td>
          <td style="padding:10px;text-align:center;">
            <button onclick="ptClosePosition(2, 'INFY')" style="background:rgba(255,68,68,0.15);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 14px;font-size:11px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.3)'" onmouseleave="this.style.background='rgba(255,68,68,0.15)'">
              <i class="fas fa-times"></i> Close
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Paper Trade History Table -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 16px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-history" style="color:#00ccff;margin-right:8px;"></i>Paper Trade History
  </h3>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table style="width:100%;border-collapse:collapse;font-size:12px;min-width:650px;">
      <thead>
        <tr style="background:#0d0d0d;">
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Date</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Time</th>
          <th style="padding:12px 10px;text-align:left;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Symbol</th>
          <th style="padding:12px 10px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Side</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Qty</th>
          <th style="padding:12px 10px;text-align:right;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Price</th>
          <th style="padding:12px 10px;text-align:center;color:#00ccff;font-weight:600;font-size:11px;text-transform:uppercase;letter-spacing:0.5px;border-bottom:2px solid #222;">Status</th>
        </tr>
      </thead>
      <tbody id="pt_historyBody">
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">18 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">09:32:15</td>
          <td style="padding:10px;color:#fff;font-weight:600;">RELIANCE</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">50</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;2,456.30</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,204,136,0.12);color:#00cc88;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">EXECUTED</span></td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">18 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">10:15:42</td>
          <td style="padding:10px;color:#fff;font-weight:600;">NIFTY 50</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(255,68,68,0.15);color:#ff4444;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">SELL</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">75</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;22,340.00</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,204,136,0.12);color:#00cc88;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">EXECUTED</span></td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">18 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">11:05:30</td>
          <td style="padding:10px;color:#fff;font-weight:600;">INFY</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">100</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,832.10</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,204,136,0.12);color:#00cc88;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">EXECUTED</span></td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background='rgba(0,204,255,0.05)'" onmouseleave="this.style.background='transparent'">
          <td style="padding:10px;color:#ccc;">17 Feb 2026</td>
          <td style="padding:10px;color:#aaa;">14:22:08</td>
          <td style="padding:10px;color:#fff;font-weight:600;">HDFCBANK</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(0,200,83,0.15);color:#00c853;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">BUY</span></td>
          <td style="padding:10px;text-align:right;color:#ccc;">75</td>
          <td style="padding:10px;text-align:right;color:#ccc;">&#8377;1,678.40</td>
          <td style="padding:10px;text-align:center;"><span style="background:rgba(255,136,0,0.12);color:#ff8800;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">CLOSED</span></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Simulator Statistics -->
<div style="background:linear-gradient(145deg,#1a1a1a 0%,#111 100%);border:1px solid #2a2a2a;border-radius:14px;padding:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:700;color:#fff;">
    <i class="fas fa-chart-pie" style="color:#aa66ff;margin-right:8px;"></i>Simulator Statistics
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:14px;">
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Total Paper Trades</div>
      <div id="pt_statTotal" style="font-size:24px;font-weight:700;color:#00ccff;">12</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Winning</div>
      <div id="pt_statWins" style="font-size:24px;font-weight:700;color:#00c853;">8</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Losing</div>
      <div id="pt_statLosses" style="font-size:24px;font-weight:700;color:#ff4444;">4</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Win Rate</div>
      <div id="pt_statWinRate" style="font-size:24px;font-weight:700;color:#00cc88;">66.7%</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Total P&L</div>
      <div id="pt_statPL" style="font-size:24px;font-weight:700;color:#00c853;">+&#8377;15,430</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Largest Win</div>
      <div id="pt_statBestWin" style="font-size:24px;font-weight:700;color:#00c853;">+&#8377;4,500</div>
    </div>
    <div style="text-align:center;padding:18px 14px;background:#0d0d0d;border-radius:10px;border:1px solid #222;">
      <div style="font-size:11px;color:#666;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px;">Largest Loss</div>
      <div id="pt_statWorstLoss" style="font-size:24px;font-weight:700;color:#ff4444;">-&#8377;2,100</div>
    </div>
  </div>
</div>

<!-- Paper Trading JavaScript -->
<script>
var ptCurrentSide = 'BUY';

function ptToggleMode(checkbox) {
  var banner = document.getElementById('pt_modeBanner');
  var modeText = document.getElementById('pt_modeText');
  var modeDesc = document.getElementById('pt_modeDesc');
  var modeIcon = document.getElementById('pt_modeIcon');
  var slider = checkbox.parentElement.querySelectorAll('span');

  if (checkbox.checked) {
    // Switching to LIVE
    if (!confirm('WARNING: Switching to LIVE mode will place REAL trades with REAL money. Are you sure?')) {
      checkbox.checked = false;
      return;
    }
    banner.style.background = 'linear-gradient(135deg,rgba(255,68,68,0.08) 0%,rgba(255,136,0,0.08) 100%)';
    banner.style.borderColor = 'rgba(255,68,68,0.3)';
    modeText.textContent = 'LIVE Trading';
    modeText.style.color = '#ff4444';
    modeDesc.innerHTML = '<i class="fas fa-exclamation-triangle" style="color:#ff4444;margin-right:4px;"></i>LIVE mode - Real trades will be placed with real money!';
    modeIcon.className = 'fas fa-broadcast-tower';
    modeIcon.style.color = '#ff4444';
    slider[0].style.background = 'linear-gradient(135deg,#ff4444,#cc3333)';
    slider[1].style.left = '29px';
  } else {
    // Switching to Paper
    banner.style.background = 'linear-gradient(135deg,rgba(0,204,255,0.08) 0%,rgba(170,102,255,0.08) 100%)';
    banner.style.borderColor = 'rgba(0,204,255,0.3)';
    modeText.textContent = 'Paper Trading';
    modeText.style.color = '#00ccff';
    modeDesc.innerHTML = '<i class="fas fa-shield-alt" style="color:#00cc88;margin-right:4px;"></i>Virtual money mode - No real trades will be placed';
    modeIcon.className = 'fas fa-flask';
    modeIcon.style.color = '#00ccff';
    slider[0].style.background = 'linear-gradient(135deg,#00ccff,#0099cc)';
    slider[1].style.left = '3px';
  }
}

function ptSetSide(side) {
  ptCurrentSide = side;
  var buyBtn = document.getElementById('pt_buyBtn');
  var sellBtn = document.getElementById('pt_sellBtn');
  if (side === 'BUY') {
    buyBtn.style.background = '#00c853';
    buyBtn.style.color = '#fff';
    sellBtn.style.background = '#1a1a1a';
    sellBtn.style.color = '#666';
  } else {
    sellBtn.style.background = '#ff4444';
    sellBtn.style.color = '#fff';
    buyBtn.style.background = '#1a1a1a';
    buyBtn.style.color = '#666';
  }
}

function ptPlaceOrder() {
  var symbol = document.getElementById('pt_symbolSelect').value;
  var qty = document.getElementById('pt_qtyInput').value;
  var priceType = document.getElementById('pt_priceType').value;
  var limitPrice = document.getElementById('pt_limitPrice').value;

  if (!qty || parseInt(qty) <= 0) {
    alert('Please enter a valid quantity.');
    return;
  }

  var price = priceType === 'market' ? 'Market' : ('' + parseFloat(limitPrice).toLocaleString('en-IN'));
  var now = new Date();
  var dateStr = now.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
  var timeStr = now.toLocaleTimeString('en-IN', { hour12: false });

  var sideColor = ptCurrentSide === 'BUY' ? '#00c853' : '#ff4444';
  var sideBg = ptCurrentSide === 'BUY' ? 'rgba(0,200,83,0.15)' : 'rgba(255,68,68,0.15)';

  var newRow = '<tr style="border-bottom:1px solid #1a1a1a;transition:background 0.2s;animation:fadeIn 0.3s;" onmouseenter="this.style.background=\'rgba(0,204,255,0.05)\'" onmouseleave="this.style.background=\'transparent\'">' +
    '<td style="padding:10px;color:#ccc;">' + dateStr + '</td>' +
    '<td style="padding:10px;color:#aaa;">' + timeStr + '</td>' +
    '<td style="padding:10px;color:#fff;font-weight:600;">' + symbol + '</td>' +
    '<td style="padding:10px;text-align:center;"><span style="background:' + sideBg + ';color:' + sideColor + ';padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">' + ptCurrentSide + '</span></td>' +
    '<td style="padding:10px;text-align:right;color:#ccc;">' + qty + '</td>' +
    '<td style="padding:10px;text-align:right;color:#ccc;">' + price + '</td>' +
    '<td style="padding:10px;text-align:center;"><span style="background:rgba(0,204,136,0.12);color:#00cc88;padding:3px 10px;border-radius:4px;font-size:11px;font-weight:600;">EXECUTED</span></td>' +
    '</tr>';

  var tbody = document.getElementById('pt_historyBody');
  tbody.insertAdjacentHTML('afterbegin', newRow);

  // Update stat count
  var totalEl = document.getElementById('pt_statTotal');
  totalEl.textContent = parseInt(totalEl.textContent) + 1;

  alert('Paper order placed: ' + ptCurrentSide + ' ' + qty + ' ' + symbol + ' @ ' + price);
}

function ptClosePosition(idx, symbol) {
  if (confirm('Close paper position for ' + symbol + '?')) {
    var row = document.getElementById('pt_pos_' + idx);
    if (row) {
      row.style.opacity = '0.3';
      row.style.pointerEvents = 'none';
      setTimeout(function() { row.style.display = 'none'; }, 300);
    }
  }
}

function ptResetSimulator() {
  if (confirm('Reset paper trading simulator? All paper positions and history will be cleared.')) {
    var capital = document.getElementById('pt_capitalInput').value || 1000000;
    var formatted = '' + parseInt(capital).toLocaleString('en-IN');
    document.getElementById('pt_currentCapital').innerHTML = formatted;
    document.getElementById('pt_plToday').innerHTML = '0';
    document.getElementById('pt_plToday').style.color = '#888';
    document.getElementById('pt_positionsBody').innerHTML = '<tr><td colspan="8" style="padding:30px;text-align:center;color:#555;font-style:italic;">No open paper positions</td></tr>';
    document.getElementById('pt_historyBody').innerHTML = '<tr><td colspan="7" style="padding:30px;text-align:center;color:#555;font-style:italic;">No paper trade history</td></tr>';
    document.getElementById('pt_statTotal').textContent = '0';
    document.getElementById('pt_statWins').textContent = '0';
    document.getElementById('pt_statLosses').textContent = '0';
    document.getElementById('pt_statWinRate').textContent = '0%';
    document.getElementById('pt_statPL').textContent = '0';
    document.getElementById('pt_statPL').style.color = '#888';
    document.getElementById('pt_statBestWin').textContent = '0';
    document.getElementById('pt_statBestWin').style.color = '#888';
    document.getElementById('pt_statWorstLoss').textContent = '0';
    document.getElementById('pt_statWorstLoss').style.color = '#888';
    alert('Paper trading simulator has been reset with capital: ' + formatted);
  }
}
</script>
        </div>

        <div class="content-page hidden" id="myPlanPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- MY PLAN PAGE CONTENT -->

<!-- Page Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-crown" style="color:#ff8800;margin-right:10px;"></i>My Plan & Subscription
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Manage your subscription, risk settings, and monitor usage</p>
  </div>
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="display:inline-flex;align-items:center;gap:6px;background:rgba(0,200,83,0.1);border:1px solid rgba(0,200,83,0.3);border-radius:8px;padding:6px 14px;font-size:12px;color:#00c853;font-weight:600;">
      <span style="width:8px;height:8px;border-radius:50%;background:#00c853;display:inline-block;animation:pulse 2s infinite;"></span>
      Active Subscription
    </span>
  </div>
</div>

<!-- Current Plan Card -->
<div style="background:linear-gradient(145deg,#1a1a2e 0%,#111 100%);border:1px solid rgba(0,204,255,0.3);border-radius:14px;padding:28px;margin-bottom:24px;position:relative;overflow:hidden;">
  <div style="position:absolute;top:0;right:0;width:120px;height:120px;background:radial-gradient(circle at top right,rgba(0,204,255,0.1) 0%,transparent 70%);"></div>
  <div style="display:flex;align-items:flex-start;justify-content:space-between;flex-wrap:wrap;gap:20px;">
    <div style="flex:1;min-width:250px;">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
        <div style="width:52px;height:52px;background:rgba(0,204,255,0.1);border:1px solid rgba(0,204,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;">
          <i class="fas fa-rocket" style="color:#00ccff;font-size:22px;"></i>
        </div>
        <div>
          <h3 style="margin:0;font-size:20px;font-weight:700;color:#fff;">Pro Trader</h3>
          <span style="font-size:11px;color:#00c853;background:rgba(0,200,83,0.1);padding:3px 10px;border-radius:4px;border:1px solid rgba(0,200,83,0.2);font-weight:600;">
            <i class="fas fa-check-circle" style="margin-right:4px;"></i>ACTIVE
          </span>
        </div>
      </div>
      <div style="display:flex;gap:24px;flex-wrap:wrap;">
        <div>
          <span style="font-size:11px;color:#666;display:block;">Monthly Price</span>
          <span style="font-size:22px;font-weight:700;color:#00ccff;">&#8377;999</span><span style="color:#666;font-size:12px;">/mo</span>
        </div>
        <div>
          <span style="font-size:11px;color:#666;display:block;">Next Renewal</span>
          <span style="font-size:14px;font-weight:600;color:#fff;">March 18, 2026</span>
        </div>
        <div>
          <span style="font-size:11px;color:#666;display:block;">Member Since</span>
          <span style="font-size:14px;font-weight:600;color:#fff;">Jan 05, 2026</span>
        </div>
      </div>
    </div>
    <div style="min-width:200px;">
      <h4 style="margin:0 0 10px 0;font-size:12px;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:1px;">Plan Features</h4>
      <div style="display:flex;flex-direction:column;gap:6px;">
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>3 Broker Connections</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Unlimited Strategies</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Chartink Scanner</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Live Trading</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Telegram Alerts</span>
      </div>
    </div>
  </div>
</div>

<!-- Plan Comparison Grid -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:600;color:#fff;">
    <i class="fas fa-th-large" style="color:#aa66ff;margin-right:8px;"></i>Compare Plans
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;">

    <!-- Free Plan -->
    <div style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:24px;position:relative;transition:all 0.3s;" onmouseenter="this.style.borderColor='#555';this.style.transform='translateY(-4px)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)'">
      <div style="text-align:center;margin-bottom:20px;">
        <div style="width:48px;height:48px;background:rgba(136,136,136,0.1);border:1px solid rgba(136,136,136,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px auto;">
          <i class="fas fa-leaf" style="color:#888;font-size:20px;"></i>
        </div>
        <h4 style="margin:0 0 4px 0;font-size:18px;font-weight:700;color:#fff;">Free</h4>
        <div style="font-size:28px;font-weight:700;color:#888;">&#8377;0<span style="font-size:13px;font-weight:400;">/mo</span></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:24px;">
        <span style="font-size:12px;color:#aaa;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>1 Broker Connection</span>
        <span style="font-size:12px;color:#aaa;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>2 Strategies</span>
        <span style="font-size:12px;color:#aaa;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Basic Scanner</span>
        <span style="font-size:12px;color:#aaa;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Paper Trading Only</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>Live Trading</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>Telegram Alerts</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>Priority Support</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>API Access</span>
      </div>
      <button style="width:100%;padding:12px;background:#222;border:1px solid #333;color:#888;border-radius:8px;font-size:13px;font-weight:600;cursor:not-allowed;">
        <i class="fas fa-arrow-down" style="margin-right:6px;"></i>Downgrade
      </button>
    </div>

    <!-- Pro Trader Plan (Current) -->
    <div style="background:linear-gradient(145deg,#1a1a2e 0%,#111 100%);border:2px solid #00ccff;border-radius:12px;padding:24px;position:relative;transition:all 0.3s;box-shadow:0 8px 24px rgba(0,204,255,0.15);">
      <div style="position:absolute;top:-1px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#00ccff,#0099cc);color:#000;font-size:10px;font-weight:700;padding:4px 16px;border-radius:0 0 8px 8px;letter-spacing:1px;">CURRENT PLAN</div>
      <div style="text-align:center;margin-bottom:20px;margin-top:10px;">
        <div style="width:48px;height:48px;background:rgba(0,204,255,0.1);border:1px solid rgba(0,204,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px auto;">
          <i class="fas fa-rocket" style="color:#00ccff;font-size:20px;"></i>
        </div>
        <h4 style="margin:0 0 4px 0;font-size:18px;font-weight:700;color:#fff;">Pro Trader</h4>
        <div style="font-size:28px;font-weight:700;color:#00ccff;">&#8377;999<span style="font-size:13px;font-weight:400;color:#888;">/mo</span></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:24px;">
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>3 Broker Connections</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Unlimited Strategies</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Chartink Scanner</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Live Trading</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Telegram Alerts</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>Priority Support</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>API Access</span>
        <span style="font-size:12px;color:#555;"><i class="fas fa-times" style="color:#ff4444;margin-right:8px;width:14px;"></i>Dedicated Server</span>
      </div>
      <button style="width:100%;padding:12px;background:rgba(0,204,255,0.15);border:1px solid rgba(0,204,255,0.4);color:#00ccff;border-radius:8px;font-size:13px;font-weight:600;cursor:default;">
        <i class="fas fa-check-circle" style="margin-right:6px;"></i>Current Plan
      </button>
    </div>

    <!-- Enterprise Plan -->
    <div style="background:linear-gradient(145deg,#111 0%,#0d0d0d 100%);border:1px solid #2a2a2a;border-radius:12px;padding:24px;position:relative;transition:all 0.3s;" onmouseenter="this.style.borderColor='#aa66ff';this.style.transform='translateY(-4px)';this.style.boxShadow='0 8px 24px rgba(170,102,255,0.15)'" onmouseleave="this.style.borderColor='#2a2a2a';this.style.transform='translateY(0)';this.style.boxShadow='none'">
      <div style="text-align:center;margin-bottom:20px;">
        <div style="width:48px;height:48px;background:rgba(170,102,255,0.1);border:1px solid rgba(170,102,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;margin:0 auto 12px auto;">
          <i class="fas fa-building" style="color:#aa66ff;font-size:20px;"></i>
        </div>
        <h4 style="margin:0 0 4px 0;font-size:18px;font-weight:700;color:#fff;">Enterprise</h4>
        <div style="font-size:28px;font-weight:700;color:#aa66ff;">&#8377;2,999<span style="font-size:13px;font-weight:400;color:#888;">/mo</span></div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:24px;">
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Unlimited Brokers</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Custom Strategies</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Chartink Scanner</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Live Trading</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Telegram Alerts</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Priority Support</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>API Access</span>
        <span style="font-size:12px;color:#ccc;"><i class="fas fa-check" style="color:#00c853;margin-right:8px;width:14px;"></i>Dedicated Server</span>
      </div>
      <button onclick="alert('Contact sales@mukeshalgo.com for Enterprise plans')" style="width:100%;padding:12px;background:linear-gradient(135deg,#aa66ff,#8844dd);border:none;color:#fff;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all 0.2s;box-shadow:0 4px 12px rgba(170,102,255,0.3);" onmouseenter="this.style.transform='scale(1.02)'" onmouseleave="this.style.transform='scale(1)'">
        <i class="fas fa-headset" style="margin-right:6px;"></i>Contact Sales
      </button>
    </div>
  </div>
</div>

<!-- Risk Management Settings -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:600;color:#fff;">
    <i class="fas fa-shield-alt" style="color:#ff8800;margin-right:8px;"></i>Risk Management Settings
  </h3>

  <!-- Daily P&L Limits -->
  <div style="margin-bottom:24px;">
    <h4 style="margin:0 0 14px 0;font-size:13px;color:#00ccff;font-weight:600;">
      <i class="fas fa-chart-line" style="margin-right:6px;"></i>Daily P&L Limits
    </h4>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;">
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-up" style="color:#00c853;margin-right:4px;"></i>Daily Profit Target (&#8377;)
        </label>
        <input type="number" id="mp_dailyProfitTarget" value="5000" placeholder="e.g. 5000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-down" style="color:#ff4444;margin-right:4px;"></i>Daily Loss Limit (&#8377;)
        </label>
        <input type="number" id="mp_dailyLossLimit" value="3000" placeholder="e.g. 3000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
    </div>
  </div>

  <!-- Time-based Square-off -->
  <div style="margin-bottom:24px;">
    <h4 style="margin:0 0 14px 0;font-size:13px;color:#ff8800;font-weight:600;">
      <i class="fas fa-clock" style="margin-right:6px;"></i>Time-based Square-off
    </h4>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:14px;">
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">Square-off Time</label>
        <input type="time" id="mp_squareoffTime" value="15:15" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;" />
      </div>
    </div>
  </div>

  <!-- Per-Position Limits -->
  <div style="margin-bottom:20px;">
    <h4 style="margin:0 0 14px 0;font-size:13px;color:#aa66ff;font-weight:600;">
      <i class="fas fa-crosshairs" style="margin-right:6px;"></i>Per-Position Limits
    </h4>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:14px;">
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-up" style="color:#00c853;margin-right:4px;"></i>Profit Target (%)
        </label>
        <input type="number" id="mp_posProfit" value="5" min="0" max="100" step="0.5" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-down" style="color:#ff4444;margin-right:4px;"></i>Stop Loss (%)
        </label>
        <input type="number" id="mp_posLoss" value="2" min="0" max="100" step="0.5" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-shoe-prints" style="color:#ff8800;margin-right:4px;"></i>Trailing Profit (%)
        </label>
        <input type="number" id="mp_posTrailing" value="1" min="0" max="50" step="0.5" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
    </div>
  </div>

  <button onclick="mp_saveRiskSettings()" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;box-shadow:0 4px 12px rgba(0,204,136,0.3);" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
    <i class="fas fa-save"></i> Save Risk Settings
  </button>
  <span id="mp_riskSaveStatus" style="margin-left:12px;font-size:12px;color:#00c853;display:none;"><i class="fas fa-check-circle"></i> Saved!</span>
</div>

<!-- Usage Statistics -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:600;color:#fff;">
    <i class="fas fa-chart-pie" style="color:#00ccff;margin-right:8px;"></i>Usage Statistics
    <span style="font-size:11px;color:#666;font-weight:400;margin-left:8px;">This Month</span>
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px;">

    <!-- API Calls -->
    <div style="background:#111;border:1px solid #222;border-radius:10px;padding:18px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <span style="font-size:12px;color:#888;font-weight:500;"><i class="fas fa-plug" style="color:#00ccff;margin-right:6px;"></i>API Calls</span>
        <span style="font-size:13px;font-weight:700;color:#fff;">12,450 <span style="color:#666;font-weight:400;">/ 50,000</span></span>
      </div>
      <div style="width:100%;height:8px;background:#222;border-radius:4px;overflow:hidden;">
        <div style="width:24.9%;height:100%;background:linear-gradient(90deg,#00ccff,#0099cc);border-radius:4px;transition:width 0.5s;"></div>
      </div>
      <span style="font-size:10px;color:#555;margin-top:6px;display:block;">24.9% used</span>
    </div>

    <!-- Strategies Deployed -->
    <div style="background:#111;border:1px solid #222;border-radius:10px;padding:18px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <span style="font-size:12px;color:#888;font-weight:500;"><i class="fas fa-chess-board" style="color:#aa66ff;margin-right:6px;"></i>Strategies Deployed</span>
        <span style="font-size:13px;font-weight:700;color:#fff;">7 <span style="color:#666;font-weight:400;">/ Unlimited</span></span>
      </div>
      <div style="width:100%;height:8px;background:#222;border-radius:4px;overflow:hidden;">
        <div style="width:100%;height:100%;background:linear-gradient(90deg,#aa66ff,#8844dd);border-radius:4px;"></div>
      </div>
      <span style="font-size:10px;color:#00c853;margin-top:6px;display:block;"><i class="fas fa-infinity" style="margin-right:3px;"></i>Unlimited on Pro Plan</span>
    </div>

    <!-- Scanners Run -->
    <div style="background:#111;border:1px solid #222;border-radius:10px;padding:18px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <span style="font-size:12px;color:#888;font-weight:500;"><i class="fas fa-crosshairs" style="color:#ff8800;margin-right:6px;"></i>Scanners Run</span>
        <span style="font-size:13px;font-weight:700;color:#fff;">342 <span style="color:#666;font-weight:400;">/ 1,000</span></span>
      </div>
      <div style="width:100%;height:8px;background:#222;border-radius:4px;overflow:hidden;">
        <div style="width:34.2%;height:100%;background:linear-gradient(90deg,#ff8800,#cc6600);border-radius:4px;transition:width 0.5s;"></div>
      </div>
      <span style="font-size:10px;color:#555;margin-top:6px;display:block;">34.2% used</span>
    </div>

    <!-- Storage Used -->
    <div style="background:#111;border:1px solid #222;border-radius:10px;padding:18px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
        <span style="font-size:12px;color:#888;font-weight:500;"><i class="fas fa-database" style="color:#00c853;margin-right:6px;"></i>Storage Used</span>
        <span style="font-size:13px;font-weight:700;color:#fff;">1.2 GB <span style="color:#666;font-weight:400;">/ 5 GB</span></span>
      </div>
      <div style="width:100%;height:8px;background:#222;border-radius:4px;overflow:hidden;">
        <div style="width:24%;height:100%;background:linear-gradient(90deg,#00c853,#009940);border-radius:4px;transition:width 0.5s;"></div>
      </div>
      <span style="font-size:10px;color:#555;margin-top:6px;display:block;">24% used</span>
    </div>

  </div>
</div>

<script>
function mp_saveRiskSettings() {
  var btn = event.target.closest('button');
  var origText = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  btn.style.opacity = '0.7';
  btn.disabled = true;
  setTimeout(function() {
    btn.innerHTML = origText;
    btn.style.opacity = '1';
    btn.disabled = false;
    var status = document.getElementById('mp_riskSaveStatus');
    status.style.display = 'inline';
    setTimeout(function() { status.style.display = 'none'; }, 2500);
  }, 800);
}
</script>
<!-- END MY PLAN PAGE CONTENT -->
        </div>

        <div class="content-page hidden" id="backtestPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- BACKTEST PAGE CONTENT -->

<!-- Page Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-history" style="color:#aa66ff;margin-right:10px;"></i>Strategy Backtester
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Test strategies against historical data before deploying live</p>
  </div>
  <div style="display:flex;align-items:center;gap:10px;">
    <span id="bt_statusBadge" style="display:inline-flex;align-items:center;gap:6px;background:#1a1a1a;border:1px solid #2a2a2a;border-radius:8px;padding:6px 14px;font-size:12px;color:#888;">
      <span style="width:8px;height:8px;border-radius:50%;background:#555;display:inline-block;" id="bt_statusDot"></span>
      Ready
    </span>
  </div>
</div>

<div style="display:grid;grid-template-columns:380px 1fr;gap:24px;align-items:start;">

  <!-- LEFT: Configuration Panel -->
  <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;">
    <h3 style="margin:0 0 20px 0;font-size:15px;font-weight:600;color:#fff;">
      <i class="fas fa-sliders-h" style="color:#00ccff;margin-right:8px;"></i>Configuration
    </h3>

    <!-- Strategy -->
    <div style="margin-bottom:16px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-chess-board" style="color:#aa66ff;margin-right:4px;"></i>Strategy
      </label>
      <select id="bt_strategy" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
        <option value="ma_crossover">Moving Average Crossover</option>
        <option value="rsi_reversal">RSI Reversal</option>
        <option value="supertrend">Supertrend</option>
        <option value="macd">MACD</option>
        <option value="custom">Custom</option>
      </select>
    </div>

    <!-- Symbol -->
    <div style="margin-bottom:16px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-search-dollar" style="color:#00ccff;margin-right:4px;"></i>Symbol
      </label>
      <input type="text" id="bt_symbol" value="NIFTY" placeholder="Enter symbol" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      <div style="display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;">
        <button onclick="document.getElementById('bt_symbol').value='NIFTY'" style="background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;color:#888;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">NIFTY</button>
        <button onclick="document.getElementById('bt_symbol').value='BANKNIFTY'" style="background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;color:#888;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">BANKNIFTY</button>
        <button onclick="document.getElementById('bt_symbol').value='RELIANCE'" style="background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;color:#888;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">RELIANCE</button>
        <button onclick="document.getElementById('bt_symbol').value='TCS'" style="background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;color:#888;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">TCS</button>
        <button onclick="document.getElementById('bt_symbol').value='HDFCBANK'" style="background:#111;border:1px solid #333;border-radius:6px;padding:4px 10px;color:#888;font-size:11px;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">HDFCBANK</button>
      </div>
    </div>

    <!-- Historical Days Slider -->
    <div style="margin-bottom:16px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-calendar-alt" style="color:#ff8800;margin-right:4px;"></i>Historical Days: <span id="bt_daysValue" style="color:#00ccff;font-weight:700;">180</span>
      </label>
      <input type="range" id="bt_days" min="30" max="1000" value="180" oninput="document.getElementById('bt_daysValue').textContent=this.value" style="width:100%;accent-color:#00ccff;cursor:pointer;" />
      <div style="display:flex;justify-content:space-between;font-size:10px;color:#555;">
        <span>30 days</span><span>1000 days</span>
      </div>
    </div>

    <!-- Interval -->
    <div style="margin-bottom:16px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-clock" style="color:#00cc88;margin-right:4px;"></i>Interval
      </label>
      <select id="bt_interval" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
        <option value="1d">1 Day</option>
        <option value="1h">1 Hour</option>
        <option value="15m" selected>15 Minutes</option>
        <option value="5m">5 Minutes</option>
      </select>
    </div>

    <!-- Initial Capital -->
    <div style="margin-bottom:16px;">
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-rupee-sign" style="color:#00ccff;margin-right:4px;"></i>Initial Capital
      </label>
      <input type="number" id="bt_capital" value="100000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
    </div>

    <!-- Risk Settings -->
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;margin-bottom:16px;">
      <h4 style="margin:0 0 12px 0;font-size:12px;color:#ff8800;font-weight:600;">
        <i class="fas fa-shield-alt" style="margin-right:4px;"></i>Risk Settings
      </h4>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Stop Loss %</label>
          <input type="number" id="bt_sl" value="2" min="0" max="50" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff4444;font-size:12px;outline:none;" />
        </div>
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Target %</label>
          <input type="number" id="bt_target" value="4" min="0" max="100" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#00c853;font-size:12px;outline:none;" />
        </div>
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Trailing SL %</label>
          <input type="number" id="bt_trailSl" value="1" min="0" max="50" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff8800;font-size:12px;outline:none;" />
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <button onclick="bt_startBacktest()" id="bt_startBtn" style="width:100%;padding:12px;background:linear-gradient(135deg,#00cc88 0%,#009966 100%);border:none;color:#fff;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;transition:all 0.2s;box-shadow:0 4px 12px rgba(0,204,136,0.3);margin-bottom:10px;" onmouseenter="this.style.transform='scale(1.02)'" onmouseleave="this.style.transform='scale(1)'">
      <i class="fas fa-play"></i> Start Backtest
    </button>
    <button onclick="bt_exportCSV()" id="bt_exportBtn" style="width:100%;padding:10px;background:#111;border:1px solid #333;color:#888;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#888'">
      <i class="fas fa-file-csv"></i> Export CSV
    </button>

    <!-- Progress Bar -->
    <div id="bt_progressContainer" style="display:none;margin-top:14px;">
      <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
        <span style="font-size:11px;color:#888;">Processing...</span>
        <span id="bt_progressPct" style="font-size:11px;color:#00ccff;font-weight:600;">0%</span>
      </div>
      <div style="width:100%;height:6px;background:#222;border-radius:3px;overflow:hidden;">
        <div id="bt_progressBar" style="width:0%;height:100%;background:linear-gradient(90deg,#00ccff,#00cc88);border-radius:3px;transition:width 0.15s;"></div>
      </div>
    </div>
  </div>

  <!-- RIGHT: Results Panel -->
  <div>
    <!-- Summary Cards -->
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px;">
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Final Capital</span>
        <span id="bt_finalCapital" style="font-size:20px;font-weight:700;color:#fff;">--</span>
      </div>
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Total P&L</span>
        <span id="bt_totalPnl" style="font-size:20px;font-weight:700;color:#888;">--</span>
        <span id="bt_totalPnlPct" style="font-size:11px;color:#666;display:block;margin-top:2px;">--</span>
      </div>
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Total Trades</span>
        <span id="bt_totalTrades" style="font-size:20px;font-weight:700;color:#fff;">--</span>
      </div>
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Win Rate</span>
        <span id="bt_winRate" style="font-size:20px;font-weight:700;color:#888;">--</span>
      </div>
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Profit Factor</span>
        <span id="bt_profitFactor" style="font-size:20px;font-weight:700;color:#888;">--</span>
      </div>
      <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:10px;padding:16px;text-align:center;">
        <span style="font-size:11px;color:#888;display:block;margin-bottom:4px;">Max Drawdown</span>
        <span id="bt_maxDrawdown" style="font-size:20px;font-weight:700;color:#888;">--</span>
      </div>
    </div>

    <!-- Equity Curve -->
    <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
      <h4 style="margin:0 0 14px 0;font-size:14px;font-weight:600;color:#fff;">
        <i class="fas fa-chart-area" style="color:#00cc88;margin-right:6px;"></i>Equity Curve
      </h4>
      <div id="bt_equityCurve" style="width:100%;height:200px;background:#111;border:1px solid #222;border-radius:8px;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center;">
        <span id="bt_equityPlaceholder" style="color:#555;font-size:13px;"><i class="fas fa-chart-line" style="margin-right:6px;"></i>Run backtest to see equity curve</span>
        <svg id="bt_equitySvg" style="display:none;position:absolute;top:0;left:0;width:100%;height:100%;" viewBox="0 0 600 200" preserveAspectRatio="none">
          <!-- Grid lines -->
          <line x1="0" y1="50" x2="600" y2="50" stroke="#1a1a1a" stroke-width="1"/>
          <line x1="0" y1="100" x2="600" y2="100" stroke="#1a1a1a" stroke-width="1"/>
          <line x1="0" y1="150" x2="600" y2="150" stroke="#1a1a1a" stroke-width="1"/>
          <!-- Equity line - populated by JS -->
          <polyline id="bt_equityLine" fill="none" stroke="#00cc88" stroke-width="2" points=""/>
          <polyline id="bt_equityFill" fill="url(#bt_grad)" stroke="none" points=""/>
          <defs>
            <linearGradient id="bt_grad" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#00cc88" stop-opacity="0.3"/>
              <stop offset="100%" stop-color="#00cc88" stop-opacity="0.02"/>
            </linearGradient>
          </defs>
        </svg>
      </div>
    </div>

    <!-- Trade Log Table -->
    <div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
        <h4 style="margin:0;font-size:14px;font-weight:600;color:#fff;">
          <i class="fas fa-list-ol" style="color:#00ccff;margin-right:6px;"></i>Trade Log
        </h4>
        <span id="bt_tradeCount" style="font-size:11px;color:#666;background:#111;padding:3px 10px;border-radius:6px;border:1px solid #222;">0 trades</span>
      </div>
      <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
        <table id="bt_tradeTable" style="width:100%;border-collapse:collapse;font-size:12px;min-width:900px;">
          <thead>
            <tr style="background:#111;">
              <th style="padding:10px 8px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">#</th>
              <th style="padding:10px 8px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Type</th>
              <th style="padding:10px 8px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Entry Time</th>
              <th style="padding:10px 8px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Entry Price</th>
              <th style="padding:10px 8px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Exit Time</th>
              <th style="padding:10px 8px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Exit Price</th>
              <th style="padding:10px 8px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Qty</th>
              <th style="padding:10px 8px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">P&L</th>
              <th style="padding:10px 8px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">P&L %</th>
              <th style="padding:10px 8px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Exit Reason</th>
            </tr>
          </thead>
          <tbody id="bt_tradeBody">
            <tr><td colspan="10" style="padding:30px;text-align:center;color:#555;font-size:13px;">
              <i class="fas fa-inbox" style="font-size:24px;display:block;margin-bottom:8px;color:#333;"></i>
              Run a backtest to see trade results
            </td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
function bt_startBacktest() {
  var btn = document.getElementById('bt_startBtn');
  var prog = document.getElementById('bt_progressContainer');
  var bar = document.getElementById('bt_progressBar');
  var pct = document.getElementById('bt_progressPct');
  var dot = document.getElementById('bt_statusDot');

  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
  btn.style.opacity = '0.7';
  btn.disabled = true;
  prog.style.display = 'block';
  dot.style.background = '#ff8800';

  var progress = 0;
  var timer = setInterval(function() {
    progress += Math.random() * 8 + 2;
    if (progress >= 100) {
      progress = 100;
      clearInterval(timer);
      setTimeout(function() { bt_showResults(); }, 300);
    }
    bar.style.width = progress + '%';
    pct.textContent = Math.round(progress) + '%';
  }, 120);
}

function bt_showResults() {
  var btn = document.getElementById('bt_startBtn');
  btn.innerHTML = '<i class="fas fa-play"></i> Start Backtest';
  btn.style.opacity = '1';
  btn.disabled = false;
  document.getElementById('bt_statusDot').style.background = '#00c853';
  document.getElementById('bt_statusBadge').querySelector('span:last-child') || 0;

  var capital = parseFloat(document.getElementById('bt_capital').value) || 100000;
  var finalCap = capital + 18750;

  document.getElementById('bt_finalCapital').textContent = '\u20B9' + finalCap.toLocaleString('en-IN');
  document.getElementById('bt_totalPnl').textContent = '+\u20B918,750';
  document.getElementById('bt_totalPnl').style.color = '#00c853';
  document.getElementById('bt_totalPnlPct').textContent = '+18.75%';
  document.getElementById('bt_totalPnlPct').style.color = '#00c853';
  document.getElementById('bt_totalTrades').textContent = '42';
  document.getElementById('bt_winRate').textContent = '64.3%';
  document.getElementById('bt_winRate').style.color = '#00c853';
  document.getElementById('bt_profitFactor').textContent = '1.82';
  document.getElementById('bt_profitFactor').style.color = '#00ccff';
  document.getElementById('bt_maxDrawdown').textContent = '-8.4%';
  document.getElementById('bt_maxDrawdown').style.color = '#ff4444';

  // Draw equity curve
  document.getElementById('bt_equityPlaceholder').style.display = 'none';
  var svg = document.getElementById('bt_equitySvg');
  svg.style.display = 'block';
  var pts = [];
  var v = 160;
  for (var i = 0; i <= 30; i++) {
    v = v + (Math.random() * 16 - 6);
    if (v > 195) v = 190;
    if (v < 40) v = 50;
    pts.push(Math.round(i * 20) + ',' + Math.round(200 - v));
  }
  document.getElementById('bt_equityLine').setAttribute('points', pts.join(' '));
  var fillPts = '0,200 ' + pts.join(' ') + ' 600,200';
  document.getElementById('bt_equityFill').setAttribute('points', fillPts);

  // Populate trade log
  var trades = [
    { type: 'LONG', entryTime: '2025-09-12 09:30', entryPrice: 19245.50, exitTime: '2025-09-12 14:15', exitPrice: 19412.75, qty: 50, pnl: 8362.50, pnlPct: 0.87, reason: 'Target' },
    { type: 'SHORT', entryTime: '2025-09-15 10:00', entryPrice: 19380.00, exitTime: '2025-09-15 13:45', exitPrice: 19295.25, qty: 50, pnl: 4237.50, pnlPct: 0.44, reason: 'Target' },
    { type: 'LONG', entryTime: '2025-09-18 09:20', entryPrice: 19510.00, exitTime: '2025-09-18 11:30', exitPrice: 19472.50, qty: 50, pnl: -1875.00, pnlPct: -0.19, reason: 'Stop Loss' },
    { type: 'LONG', entryTime: '2025-09-22 09:45', entryPrice: 19320.75, exitTime: '2025-09-22 15:00', exitPrice: 19518.00, qty: 50, pnl: 9862.50, pnlPct: 1.02, reason: 'Trailing SL' },
    { type: 'SHORT', entryTime: '2025-09-25 10:15', entryPrice: 19600.00, exitTime: '2025-09-25 14:30', exitPrice: 19555.50, qty: 50, pnl: 2225.00, pnlPct: 0.23, reason: 'EOD Exit' }
  ];

  var tbody = document.getElementById('bt_tradeBody');
  tbody.innerHTML = '';
  trades.forEach(function(t, i) {
    var isProfit = t.pnl >= 0;
    var typeColor = t.type === 'LONG' ? '#00c853' : '#ff4444';
    var typeBg = t.type === 'LONG' ? 'rgba(0,200,83,0.1)' : 'rgba(255,68,68,0.1)';
    var pnlColor = isProfit ? '#00c853' : '#ff4444';
    var reasonColor = t.reason === 'Target' ? '#00c853' : t.reason === 'Stop Loss' ? '#ff4444' : t.reason === 'Trailing SL' ? '#ff8800' : '#00ccff';
    var row = '<tr style="border-bottom:1px solid #1a1a1a;" onmouseenter="this.style.background=\'#111\'" onmouseleave="this.style.background=\'transparent\'">' +
      '<td style="padding:10px 8px;text-align:center;color:#666;">' + (i+1) + '</td>' +
      '<td style="padding:10px 8px;text-align:center;"><span style="background:' + typeBg + ';color:' + typeColor + ';padding:3px 10px;border-radius:4px;font-size:11px;font-weight:700;border:1px solid ' + typeColor + '30;">' + t.type + '</span></td>' +
      '<td style="padding:10px 8px;color:#ccc;">' + t.entryTime + '</td>' +
      '<td style="padding:10px 8px;text-align:right;color:#fff;font-weight:600;">' + t.entryPrice.toFixed(2) + '</td>' +
      '<td style="padding:10px 8px;color:#ccc;">' + t.exitTime + '</td>' +
      '<td style="padding:10px 8px;text-align:right;color:#fff;font-weight:600;">' + t.exitPrice.toFixed(2) + '</td>' +
      '<td style="padding:10px 8px;text-align:right;color:#aaa;">' + t.qty + '</td>' +
      '<td style="padding:10px 8px;text-align:right;color:' + pnlColor + ';font-weight:700;">' + (isProfit ? '+' : '') + '\u20B9' + t.pnl.toLocaleString('en-IN') + '</td>' +
      '<td style="padding:10px 8px;text-align:right;color:' + pnlColor + ';">' + (isProfit ? '+' : '') + t.pnlPct.toFixed(2) + '%</td>' +
      '<td style="padding:10px 8px;text-align:center;"><span style="color:' + reasonColor + ';font-size:11px;background:' + reasonColor + '15;padding:3px 8px;border-radius:4px;">' + t.reason + '</span></td>' +
      '</tr>';
    tbody.innerHTML += row;
  });
  document.getElementById('bt_tradeCount').textContent = trades.length + ' trades';
}

function bt_exportCSV() {
  var table = document.getElementById('bt_tradeTable');
  var rows = table.querySelectorAll('tr');
  if (rows.length <= 1) { alert('No backtest data to export. Run a backtest first.'); return; }
  var csv = [];
  rows.forEach(function(row) {
    var cols = row.querySelectorAll('th, td');
    var rowData = [];
    cols.forEach(function(col) { rowData.push('"' + col.textContent.trim().replace(/"/g, '""') + '"'); });
    csv.push(rowData.join(','));
  });
  var blob = new Blob([csv.join('\n')], { type: 'text/csv' });
  var a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'backtest_' + document.getElementById('bt_symbol').value + '_' + new Date().toISOString().slice(0,10) + '.csv';
  a.click();
  URL.revokeObjectURL(a.href);
}
</script>
<!-- END BACKTEST PAGE CONTENT -->
        </div>

        <div class="content-page hidden" id="settingsPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>

<!-- SETTINGS PAGE CONTENT -->

<!-- Page Header -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:28px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-cog" style="color:#00ccff;margin-right:10px;"></i>Settings
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Configure trading parameters, alerts, and app preferences</p>
  </div>
</div>

<!-- Section 1: Trading Settings -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:600;color:#fff;">
    <i class="fas fa-chart-bar" style="color:#00ccff;margin-right:8px;"></i>Trading Settings
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;margin-bottom:20px;">
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-sort-numeric-up" style="color:#00ccff;margin-right:4px;"></i>Default Quantity
      </label>
      <input type="number" id="st_defaultQty" value="1" min="1" max="1000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      <span style="font-size:10px;color:#555;margin-top:4px;display:block;">Range: 1 - 1,000</span>
    </div>
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-layer-group" style="color:#aa66ff;margin-right:4px;"></i>Max Positions
      </label>
      <input type="number" id="st_maxPositions" value="10" min="1" max="100" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      <span style="font-size:10px;color:#555;margin-top:4px;display:block;">Range: 1 - 100</span>
    </div>
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-percentage" style="color:#ff8800;margin-right:4px;"></i>Risk per Trade (%)
      </label>
      <input type="number" id="st_riskPerTrade" value="2" min="0.1" max="10" step="0.1" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      <span style="font-size:10px;color:#555;margin-top:4px;display:block;">Range: 0.1% - 10%</span>
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:12px;">
    <button onclick="st_saveTradingSettings()" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;box-shadow:0 4px 12px rgba(0,204,136,0.3);" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
      <i class="fas fa-save"></i> Save Trading Settings
    </button>
    <span id="st_tradingSaveStatus" style="font-size:12px;color:#00c853;display:none;"><i class="fas fa-check-circle"></i> Saved!</span>
  </div>
</div>

<!-- Section 2: Telegram Alerts -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
      <i class="fab fa-telegram" style="color:#00ccff;margin-right:8px;"></i>Telegram Alerts
    </h3>
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
      <span style="font-size:12px;color:#888;">Enable</span>
      <div style="position:relative;width:44px;height:24px;">
        <input type="checkbox" id="st_telegramEnabled" checked onchange="st_toggleTelegram(this)" style="opacity:0;width:0;height:0;position:absolute;" />
        <div id="st_telegramToggle" onclick="var cb=document.getElementById('st_telegramEnabled');cb.checked=!cb.checked;st_toggleTelegram(cb);" style="width:44px;height:24px;background:#00cc88;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative;">
          <div id="st_telegramKnob" style="width:20px;height:20px;background:#fff;border-radius:50%;position:absolute;top:2px;left:22px;transition:all 0.3s;box-shadow:0 1px 3px rgba(0,0,0,0.3);"></div>
        </div>
      </div>
    </label>
  </div>

  <div id="st_telegramFields" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:16px;">
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-key" style="color:#ff8800;margin-right:4px;"></i>Bot Token
      </label>
      <input type="password" id="st_botToken" placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
    </div>
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-hashtag" style="color:#aa66ff;margin-right:4px;"></i>Chat ID
      </label>
      <input type="text" id="st_chatId" placeholder="e.g. -1001234567890" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
    </div>
  </div>

  <div style="background:#111;border:1px solid #222;border-radius:8px;padding:12px;margin-bottom:16px;">
    <p style="margin:0;font-size:11px;color:#666;line-height:1.6;">
      <i class="fas fa-info-circle" style="color:#00ccff;margin-right:4px;"></i>
      <strong style="color:#888;">Setup:</strong> Message <span style="color:#00ccff;">@BotFather</span> on Telegram, use <span style="color:#00ccff;">/newbot</span> to create a bot and get the token. Add the bot to your group/channel, then get the Chat ID from <span style="color:#00ccff;">@userinfobot</span> or the Telegram API.
    </p>
  </div>

  <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
    <button onclick="st_saveTelegram()" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 20px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
      <i class="fas fa-save"></i> Save Telegram
    </button>
    <button onclick="st_testTelegram()" style="background:#111;border:1px solid #333;color:#00ccff;border-radius:8px;padding:10px 20px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff'" onmouseleave="this.style.borderColor='#333'">
      <i class="fas fa-paper-plane"></i> Test Connection
    </button>
    <span id="st_telegramStatus" style="font-size:12px;display:none;"></span>
  </div>
</div>

<!-- Section 3: Telegram Bot Controller -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
      <i class="fas fa-gamepad" style="color:#aa66ff;margin-right:8px;"></i>Telegram Bot Controller
      <span style="font-size:11px;color:#666;font-weight:400;margin-left:6px;">(Remote Control)</span>
    </h3>
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
      <span style="font-size:12px;color:#888;">Enable</span>
      <div style="position:relative;width:44px;height:24px;">
        <input type="checkbox" id="st_botControlEnabled" onchange="st_toggleBotControl(this)" style="opacity:0;width:0;height:0;position:absolute;" />
        <div id="st_botControlToggle" onclick="var cb=document.getElementById('st_botControlEnabled');cb.checked=!cb.checked;st_toggleBotControl(cb);" style="width:44px;height:24px;background:#444;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative;">
          <div id="st_botControlKnob" style="width:20px;height:20px;background:#fff;border-radius:50%;position:absolute;top:2px;left:2px;transition:all 0.3s;box-shadow:0 1px 3px rgba(0,0,0,0.3);"></div>
        </div>
      </div>
    </label>
  </div>

  <div style="display:flex;align-items:center;gap:16px;margin-bottom:20px;">
    <div style="display:flex;align-items:center;gap:8px;">
      <span style="font-size:12px;color:#888;">Status:</span>
      <span id="st_botStatus" style="display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#ff4444;font-weight:600;">
        <span style="width:8px;height:8px;border-radius:50%;background:#ff4444;display:inline-block;" id="st_botDot"></span>
        Stopped
      </span>
    </div>
    <div style="display:flex;gap:8px;">
      <button onclick="st_startBot()" id="st_startBotBtn" style="background:rgba(0,200,83,0.1);color:#00c853;border:1px solid rgba(0,200,83,0.3);border-radius:6px;padding:6px 14px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(0,200,83,0.2)'" onmouseleave="this.style.background='rgba(0,200,83,0.1)'">
        <i class="fas fa-play" style="margin-right:4px;"></i>Start
      </button>
      <button onclick="st_stopBot()" id="st_stopBotBtn" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:6px;padding:6px 14px;font-size:12px;font-weight:600;cursor:pointer;transition:all 0.2s;" onmouseenter="this.style.background='rgba(255,68,68,0.2)'" onmouseleave="this.style.background='rgba(255,68,68,0.1)'">
        <i class="fas fa-stop" style="margin-right:4px;"></i>Stop
      </button>
    </div>
  </div>

  <div style="background:#111;border:1px solid #222;border-radius:8px;padding:16px;">
    <h4 style="margin:0 0 10px 0;font-size:12px;color:#888;font-weight:600;text-transform:uppercase;letter-spacing:1px;">
      <i class="fas fa-terminal" style="color:#00ccff;margin-right:6px;"></i>Available Commands
    </h4>
    <pre style="margin:0;font-family:'Courier New',monospace;font-size:12px;color:#ccc;line-height:2;background:#0d0d0d;padding:14px;border-radius:6px;border:1px solid #1a1a1a;overflow-x:auto;"><span style="color:#00ccff;">/status</span>     - View current bot & trading status
<span style="color:#00ccff;">/positions</span>  - List all open positions
<span style="color:#00ccff;">/orders</span>     - Show pending orders
<span style="color:#00ccff;">/pnl</span>        - Today's profit & loss summary
<span style="color:#00ccff;">/pause</span>      - Pause all trading activity
<span style="color:#00ccff;">/resume</span>     - Resume trading activity
<span style="color:#00ccff;">/squareoff</span>  - Square off all open positions
<span style="color:#00ccff;">/help</span>       - Show all available commands</pre>
  </div>
</div>

<!-- Section 4: Auto Square-off -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
    <h3 style="margin:0;font-size:16px;font-weight:600;color:#fff;">
      <i class="fas fa-power-off" style="color:#ff4444;margin-right:8px;"></i>Auto Square-off
    </h3>
    <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
      <span style="font-size:12px;color:#888;">Enable</span>
      <div style="position:relative;width:44px;height:24px;">
        <input type="checkbox" id="st_autoSqEnabled" checked onchange="st_toggleAutoSq(this)" style="opacity:0;width:0;height:0;position:absolute;" />
        <div id="st_autoSqToggle" onclick="var cb=document.getElementById('st_autoSqEnabled');cb.checked=!cb.checked;st_toggleAutoSq(cb);" style="width:44px;height:24px;background:#00cc88;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative;">
          <div id="st_autoSqKnob" style="width:20px;height:20px;background:#fff;border-radius:50%;position:absolute;top:2px;left:22px;transition:all 0.3s;box-shadow:0 1px 3px rgba(0,0,0,0.3);"></div>
        </div>
      </div>
    </label>
  </div>

  <div id="st_autoSqFields">
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-bottom:20px;">
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-up" style="color:#00c853;margin-right:4px;"></i>Daily Profit Target (&#8377;)
        </label>
        <input type="number" id="st_dailyProfit" value="5000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-arrow-down" style="color:#ff4444;margin-right:4px;"></i>Daily Loss Limit (&#8377;)
        </label>
        <input type="number" id="st_dailyLoss" value="3000" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;transition:border-color 0.2s;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
      </div>
      <div>
        <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
          <i class="fas fa-clock" style="color:#ff8800;margin-right:4px;"></i>Square-off Time
        </label>
        <input type="time" id="st_sqTime" value="15:15" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;" />
      </div>
    </div>

    <!-- Per-Position Limits -->
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:16px;margin-bottom:20px;">
      <h4 style="margin:0 0 14px 0;font-size:12px;color:#aa66ff;font-weight:600;text-transform:uppercase;letter-spacing:1px;">
        <i class="fas fa-crosshairs" style="margin-right:6px;"></i>Per-Position Limits
      </h4>
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;">
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Profit Target (%)</label>
          <input type="number" id="st_posProfit" value="5" min="0" max="100" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#00c853;font-size:12px;outline:none;" />
        </div>
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Stop Loss (%)</label>
          <input type="number" id="st_posLoss" value="2" min="0" max="100" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff4444;font-size:12px;outline:none;" />
        </div>
        <div>
          <label style="display:block;font-size:11px;color:#888;margin-bottom:4px;">Trailing Profit (%)</label>
          <input type="number" id="st_posTrailing" value="1" min="0" max="50" step="0.5" style="width:100%;box-sizing:border-box;background:#0d0d0d;border:1px solid #333;border-radius:6px;padding:8px 10px;color:#ff8800;font-size:12px;outline:none;" />
        </div>
      </div>
    </div>
  </div>

  <div style="display:flex;align-items:center;gap:12px;">
    <button onclick="st_saveAutoSq()" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
      <i class="fas fa-save"></i> Save Auto Square-off
    </button>
    <span id="st_autoSqSaveStatus" style="font-size:12px;color:#00c853;display:none;"><i class="fas fa-check-circle"></i> Saved!</span>
  </div>
</div>

<!-- Section 5: App Preferences -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:24px;margin-bottom:24px;">
  <h3 style="margin:0 0 20px 0;font-size:16px;font-weight:600;color:#fff;">
    <i class="fas fa-palette" style="color:#ff8800;margin-right:8px;"></i>App Preferences
  </h3>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:20px;">

    <!-- Theme -->
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-moon" style="color:#aa66ff;margin-right:4px;"></i>Theme
      </label>
      <select id="st_theme" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
        <option value="dark" selected>Dark Mode</option>
        <option value="light" disabled>Light Mode (Coming Soon)</option>
      </select>
    </div>

    <!-- Sound Alerts -->
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-volume-up" style="color:#00ccff;margin-right:4px;"></i>Sound Alerts
      </label>
      <div style="display:flex;align-items:center;gap:12px;padding:8px 0;">
        <div style="position:relative;width:44px;height:24px;">
          <input type="checkbox" id="st_soundEnabled" checked onchange="st_toggleSound(this)" style="opacity:0;width:0;height:0;position:absolute;" />
          <div id="st_soundToggle" onclick="var cb=document.getElementById('st_soundEnabled');cb.checked=!cb.checked;st_toggleSound(cb);" style="width:44px;height:24px;background:#00cc88;border-radius:12px;cursor:pointer;transition:all 0.3s;position:relative;">
            <div id="st_soundKnob" style="width:20px;height:20px;background:#fff;border-radius:50%;position:absolute;top:2px;left:22px;transition:all 0.3s;box-shadow:0 1px 3px rgba(0,0,0,0.3);"></div>
          </div>
        </div>
        <span id="st_soundLabel" style="font-size:12px;color:#00c853;">Enabled</span>
      </div>
    </div>

    <!-- Notification Frequency -->
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-bell" style="color:#ff8800;margin-right:4px;"></i>Notification Frequency
      </label>
      <select id="st_notifFreq" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
        <option value="all">All Notifications</option>
        <option value="important" selected>Important Only</option>
        <option value="trades">Trades Only</option>
        <option value="none">None</option>
      </select>
    </div>

    <!-- Data Refresh Interval -->
    <div>
      <label style="display:block;font-size:12px;color:#aaa;margin-bottom:6px;font-weight:500;">
        <i class="fas fa-sync-alt" style="color:#00c853;margin-right:4px;"></i>Data Refresh Interval
      </label>
      <select id="st_refreshInterval" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;cursor:pointer;appearance:none;-webkit-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg fill=\"%23888\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M7 10l5 5 5-5z\"/></svg>');background-repeat:no-repeat;background-position:right 10px center;background-size:16px;">
        <option value="1">1 Second</option>
        <option value="2" selected>2 Seconds</option>
        <option value="5">5 Seconds</option>
        <option value="10">10 Seconds</option>
      </select>
    </div>
  </div>

  <div style="margin-top:20px;display:flex;align-items:center;gap:12px;">
    <button onclick="st_savePreferences()" style="background:linear-gradient(135deg,#00cc88 0%,#009966 100%);color:#fff;border:none;border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.transform='scale(1.03)'" onmouseleave="this.style.transform='scale(1)'">
      <i class="fas fa-save"></i> Save Preferences
    </button>
    <span id="st_prefSaveStatus" style="font-size:12px;color:#00c853;display:none;"><i class="fas fa-check-circle"></i> Saved!</span>
  </div>
</div>

<script>
// Generic save handler with status feedback
function st_showSaveStatus(statusId) {
  var el = document.getElementById(statusId);
  el.style.display = 'inline';
  setTimeout(function() { el.style.display = 'none'; }, 2500);
}

function st_saveTradingSettings() {
  var btn = event.target.closest('button');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  btn.disabled = true;
  setTimeout(function() {
    btn.innerHTML = '<i class="fas fa-save"></i> Save Trading Settings';
    btn.disabled = false;
    st_showSaveStatus('st_tradingSaveStatus');
  }, 600);
}

function st_saveTelegram() {
  var btn = event.target.closest('button');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  btn.disabled = true;
  setTimeout(function() {
    btn.innerHTML = '<i class="fas fa-save"></i> Save Telegram';
    btn.disabled = false;
    var s = document.getElementById('st_telegramStatus');
    s.style.display = 'inline';
    s.style.color = '#00c853';
    s.innerHTML = '<i class="fas fa-check-circle"></i> Telegram settings saved!';
    setTimeout(function() { s.style.display = 'none'; }, 2500);
  }, 600);
}

function st_testTelegram() {
  var btn = event.target.closest('button');
  var origHTML = btn.innerHTML;
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
  btn.disabled = true;
  var s = document.getElementById('st_telegramStatus');
  setTimeout(function() {
    btn.innerHTML = origHTML;
    btn.disabled = false;
    var token = document.getElementById('st_botToken').value;
    var chatId = document.getElementById('st_chatId').value;
    if (!token || !chatId) {
      s.style.display = 'inline';
      s.style.color = '#ff4444';
      s.innerHTML = '<i class="fas fa-exclamation-circle"></i> Please enter Bot Token and Chat ID first';
    } else {
      s.style.display = 'inline';
      s.style.color = '#00c853';
      s.innerHTML = '<i class="fas fa-check-circle"></i> Test message sent successfully!';
    }
    setTimeout(function() { s.style.display = 'none'; }, 3000);
  }, 1200);
}

// Toggle handlers
function st_toggleTelegram(cb) {
  var toggle = document.getElementById('st_telegramToggle');
  var knob = document.getElementById('st_telegramKnob');
  var fields = document.getElementById('st_telegramFields');
  if (cb.checked) {
    toggle.style.background = '#00cc88';
    knob.style.left = '22px';
    fields.style.opacity = '1';
    fields.style.pointerEvents = 'auto';
  } else {
    toggle.style.background = '#444';
    knob.style.left = '2px';
    fields.style.opacity = '0.4';
    fields.style.pointerEvents = 'none';
  }
}

function st_toggleBotControl(cb) {
  var toggle = document.getElementById('st_botControlToggle');
  var knob = document.getElementById('st_botControlKnob');
  if (cb.checked) {
    toggle.style.background = '#00cc88';
    knob.style.left = '22px';
  } else {
    toggle.style.background = '#444';
    knob.style.left = '2px';
    st_stopBot();
  }
}

function st_toggleAutoSq(cb) {
  var toggle = document.getElementById('st_autoSqToggle');
  var knob = document.getElementById('st_autoSqKnob');
  var fields = document.getElementById('st_autoSqFields');
  if (cb.checked) {
    toggle.style.background = '#00cc88';
    knob.style.left = '22px';
    fields.style.opacity = '1';
    fields.style.pointerEvents = 'auto';
  } else {
    toggle.style.background = '#444';
    knob.style.left = '2px';
    fields.style.opacity = '0.4';
    fields.style.pointerEvents = 'none';
  }
}

function st_toggleSound(cb) {
  var toggle = document.getElementById('st_soundToggle');
  var knob = document.getElementById('st_soundKnob');
  var label = document.getElementById('st_soundLabel');
  if (cb.checked) {
    toggle.style.background = '#00cc88';
    knob.style.left = '22px';
    label.textContent = 'Enabled';
    label.style.color = '#00c853';
  } else {
    toggle.style.background = '#444';
    knob.style.left = '2px';
    label.textContent = 'Disabled';
    label.style.color = '#888';
  }
}

function st_startBot() {
  var dot = document.getElementById('st_botDot');
  var status = document.getElementById('st_botStatus');
  dot.style.background = '#00c853';
  status.style.color = '#00c853';
  status.innerHTML = '<span style="width:8px;height:8px;border-radius:50%;background:#00c853;display:inline-block;animation:pulse 2s infinite;" id="st_botDot"></span> Running';
}

function st_stopBot() {
  var status = document.getElementById('st_botStatus');
  status.style.color = '#ff4444';
  status.innerHTML = '<span style="width:8px;height:8px;border-radius:50%;background:#ff4444;display:inline-block;" id="st_botDot"></span> Stopped';
}

function st_saveAutoSq() {
  var btn = event.target.closest('button');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  btn.disabled = true;
  setTimeout(function() {
    btn.innerHTML = '<i class="fas fa-save"></i> Save Auto Square-off';
    btn.disabled = false;
    st_showSaveStatus('st_autoSqSaveStatus');
  }, 600);
}

function st_savePreferences() {
  var btn = event.target.closest('button');
  btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
  btn.disabled = true;
  setTimeout(function() {
    btn.innerHTML = '<i class="fas fa-save"></i> Save Preferences';
    btn.disabled = false;
    st_showSaveStatus('st_prefSaveStatus');
  }, 600);
}
</script>
<!-- END SETTINGS PAGE CONTENT -->
        </div>

        <div class="content-page hidden" id="alPage">
  <!-- Back to Dashboard -->
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back
  </button>


<!-- AL PAGE CONTENT - AI Trading & Alerts -->
<div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;flex-wrap:wrap;gap:12px;">
  <div>
    <h2 style="margin:0;font-size:22px;font-weight:700;color:#fff;letter-spacing:0.5px;">
      <i class="fas fa-robot" style="color:#aa66ff;margin-right:10px;"></i>AI Trading & Alerts
    </h2>
    <p style="margin:4px 0 0 0;font-size:13px;color:#888;">Price alerts, technical indicator signals, and AI-powered trading insights</p>
  </div>
</div>

<!-- ===== CREATE NEW ALERT ===== -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
  <h4 style="margin:0 0 16px 0;font-size:14px;color:#00ccff;font-weight:600;">
    <i class="fas fa-bell" style="margin-right:6px;"></i>Create New Alert
  </h4>
  <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:12px;margin-bottom:14px;">
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Symbol</label>
      <input type="text" id="al_alertSymbol" placeholder="e.g. NIFTY, RELIANCE" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" onfocus="this.style.borderColor='#00ccff'" onblur="this.style.borderColor='#333'" />
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Alert Type</label>
      <select id="al_alertType" style="width:100%;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:12px;outline:none;">
        <option value="price_above">Price Above</option>
        <option value="price_below">Price Below</option>
        <option value="price_cross_up">Price Cross Up</option>
        <option value="price_cross_down">Price Cross Down</option>
        <option value="rsi_overbought">RSI Overbought (&gt;70)</option>
        <option value="rsi_oversold">RSI Oversold (&lt;30)</option>
        <option value="macd_bullish">MACD Bullish Cross</option>
        <option value="macd_bearish">MACD Bearish Cross</option>
        <option value="supertrend_buy">Supertrend Buy</option>
        <option value="supertrend_sell">Supertrend Sell</option>
        <option value="pct_change_up">% Change Up</option>
        <option value="pct_change_down">% Change Down</option>
      </select>
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Target Value</label>
      <input type="number" id="al_alertTarget" placeholder="e.g. 22500" step="0.05" style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" />
    </div>
    <div>
      <label style="display:block;font-size:11px;color:#888;margin-bottom:5px;">Custom Message</label>
      <input type="text" id="al_alertMsg" placeholder="Optional note..." style="width:100%;box-sizing:border-box;background:#111;border:1px solid #333;border-radius:8px;padding:10px 12px;color:#fff;font-size:13px;outline:none;" />
    </div>
  </div>
  <div style="display:flex;align-items:center;gap:16px;">
    <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:#aaa;cursor:pointer;">
      <input type="checkbox" id="al_repeatAlert" style="accent-color:#00ccff;width:16px;height:16px;" /> Repeat Alert (trigger multiple times)
    </label>
    <button onclick="al_createAlert()" style="margin-left:auto;background:linear-gradient(135deg,#00ccff,#0088cc);color:#fff;border:none;border-radius:8px;padding:10px 24px;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;">
      <i class="fas fa-plus"></i> Create Alert
    </button>
  </div>
</div>

<!-- ===== ACTIVE ALERTS TABLE ===== -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
  <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;">
    <h4 style="margin:0;font-size:14px;color:#fff;font-weight:600;">
      <i class="fas fa-list" style="color:#00cc88;margin-right:6px;"></i>Active Alerts <span id="al_activeCount" style="background:#333;color:#888;font-size:10px;padding:2px 8px;border-radius:10px;margin-left:6px;">4</span>
    </h4>
    <div style="display:flex;gap:6px;">
      <button onclick="al_refreshAlerts()" style="background:#111;border:1px solid #333;border-radius:6px;padding:6px 12px;color:#888;font-size:11px;cursor:pointer;"><i class="fas fa-sync-alt" style="margin-right:3px;"></i>Refresh</button>
      <button onclick="al_clearTriggered()" style="background:rgba(255,136,0,0.1);color:#ff8800;border:1px solid rgba(255,136,0,0.3);border-radius:6px;padding:6px 12px;font-size:11px;cursor:pointer;"><i class="fas fa-broom" style="margin-right:3px;"></i>Clear Triggered</button>
    </div>
  </div>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table style="width:100%;border-collapse:collapse;font-size:13px;">
      <thead>
        <tr style="background:#111;">
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">ID</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Symbol</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Type</th>
          <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Target</th>
          <th style="padding:10px 12px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Status</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Created</th>
          <th style="padding:10px 12px;text-align:center;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Actions</th>
        </tr>
      </thead>
      <tbody id="al_alertsBody">
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#555;">#1</td>
          <td style="padding:10px 12px;color:#fff;font-weight:600;">NIFTY</td>
          <td style="padding:10px 12px;color:#aaa;">Price Above</td>
          <td style="padding:10px 12px;text-align:right;color:#00c853;font-weight:600;">&#8377;22,800</td>
          <td style="padding:10px 12px;text-align:center;"><span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">ACTIVE</span></td>
          <td style="padding:10px 12px;color:#555;font-size:11px;">18 Feb, 09:15</td>
          <td style="padding:10px 12px;text-align:center;">
            <button onclick="al_disableAlert(1)" style="background:rgba(255,152,0,0.1);color:#ff9800;border:1px solid rgba(255,152,0,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;" title="Disable"><i class="fas fa-pause"></i></button>
            <button onclick="al_deleteAlert(1)" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;" title="Delete"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#555;">#2</td>
          <td style="padding:10px 12px;color:#fff;font-weight:600;">BANKNIFTY</td>
          <td style="padding:10px 12px;color:#aaa;">RSI Overbought</td>
          <td style="padding:10px 12px;text-align:right;color:#ff8800;font-weight:600;">70</td>
          <td style="padding:10px 12px;text-align:center;"><span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">ACTIVE</span></td>
          <td style="padding:10px 12px;color:#555;font-size:11px;">18 Feb, 09:30</td>
          <td style="padding:10px 12px;text-align:center;">
            <button onclick="al_disableAlert(2)" style="background:rgba(255,152,0,0.1);color:#ff9800;border:1px solid rgba(255,152,0,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;" title="Disable"><i class="fas fa-pause"></i></button>
            <button onclick="al_deleteAlert(2)" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;" title="Delete"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#555;">#3</td>
          <td style="padding:10px 12px;color:#fff;font-weight:600;">RELIANCE</td>
          <td style="padding:10px 12px;color:#aaa;">Price Below</td>
          <td style="padding:10px 12px;text-align:right;color:#ff4444;font-weight:600;">&#8377;2,900</td>
          <td style="padding:10px 12px;text-align:center;"><span style="background:rgba(255,136,0,0.15);color:#ff8800;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">TRIGGERED</span></td>
          <td style="padding:10px 12px;color:#555;font-size:11px;">17 Feb, 14:22</td>
          <td style="padding:10px 12px;text-align:center;">
            <button onclick="al_deleteAlert(3)" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;" title="Delete"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#555;">#4</td>
          <td style="padding:10px 12px;color:#fff;font-weight:600;">TCS</td>
          <td style="padding:10px 12px;color:#aaa;">MACD Bullish Cross</td>
          <td style="padding:10px 12px;text-align:right;color:#00ccff;font-weight:600;">--</td>
          <td style="padding:10px 12px;text-align:center;"><span style="background:rgba(102,102,102,0.15);color:#888;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">DISABLED</span></td>
          <td style="padding:10px 12px;color:#555;font-size:11px;">16 Feb, 11:00</td>
          <td style="padding:10px 12px;text-align:center;">
            <button onclick="al_enableAlert(4)" style="background:rgba(0,204,136,0.1);color:#00cc88;border:1px solid rgba(0,204,136,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;" title="Enable"><i class="fas fa-play"></i></button>
            <button onclick="al_deleteAlert(4)" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;" title="Delete"><i class="fas fa-trash"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ===== ALERT HISTORY ===== -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
  <h4 style="margin:0 0 14px 0;font-size:14px;color:#ff8800;font-weight:600;">
    <i class="fas fa-history" style="margin-right:6px;"></i>Alert History (Recently Triggered)
  </h4>
  <div style="overflow-x:auto;border-radius:8px;border:1px solid #222;">
    <table style="width:100%;border-collapse:collapse;font-size:13px;">
      <thead>
        <tr style="background:#111;">
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Symbol</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Type</th>
          <th style="padding:10px 12px;text-align:right;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Target</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Triggered At</th>
          <th style="padding:10px 12px;text-align:left;color:#888;font-weight:600;font-size:11px;text-transform:uppercase;border-bottom:1px solid #2a2a2a;">Message</th>
        </tr>
      </thead>
      <tbody id="al_historyBody">
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#fff;font-weight:600;">RELIANCE</td>
          <td style="padding:10px 12px;color:#aaa;">Price Below</td>
          <td style="padding:10px 12px;text-align:right;color:#ff4444;">&#8377;2,900</td>
          <td style="padding:10px 12px;color:#ff8800;font-size:11px;">17 Feb, 14:22:35</td>
          <td style="padding:10px 12px;color:#888;font-size:11px;">RELIANCE dropped below support</td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#fff;font-weight:600;">NIFTY</td>
          <td style="padding:10px 12px;color:#aaa;">Supertrend Buy</td>
          <td style="padding:10px 12px;text-align:right;color:#00c853;">--</td>
          <td style="padding:10px 12px;color:#ff8800;font-size:11px;">17 Feb, 10:45:12</td>
          <td style="padding:10px 12px;color:#888;font-size:11px;">Supertrend flipped bullish on 15m</td>
        </tr>
        <tr style="border-bottom:1px solid #1a1a1a;">
          <td style="padding:10px 12px;color:#fff;font-weight:600;">BANKNIFTY</td>
          <td style="padding:10px 12px;color:#aaa;">Price Cross Down</td>
          <td style="padding:10px 12px;text-align:right;color:#ff4444;">&#8377;47,500</td>
          <td style="padding:10px 12px;color:#ff8800;font-size:11px;">16 Feb, 15:10:08</td>
          <td style="padding:10px 12px;color:#888;font-size:11px;">Broke below key level</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- ===== AI TRADING SIGNALS ===== -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
  <h4 style="margin:0 0 16px 0;font-size:14px;color:#aa66ff;font-weight:600;">
    <i class="fas fa-brain" style="margin-right:6px;"></i>AI Trading Signals
  </h4>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;">
    <!-- Signal 1 -->
    <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:16px;position:relative;overflow:hidden;">
      <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:#ff4444;"></div>
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px;">
        <span style="background:rgba(255,68,68,0.15);color:#ff4444;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">BEARISH</span>
        <span style="font-size:10px;color:#555;">2 min ago</span>
      </div>
      <h5 style="margin:0 0 6px 0;font-size:14px;color:#fff;font-weight:600;">NIFTY Bearish Divergence</h5>
      <p style="margin:0 0 12px 0;font-size:12px;color:#888;line-height:1.5;">RSI showing bearish divergence on 15m timeframe. Price making higher highs while RSI making lower highs.</p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <div style="flex:1;">
          <div style="font-size:10px;color:#555;margin-bottom:3px;">Confidence</div>
          <div style="background:#222;border-radius:4px;height:6px;overflow:hidden;">
            <div style="width:78%;height:100%;background:linear-gradient(90deg,#ff8800,#ff4444);border-radius:4px;"></div>
          </div>
        </div>
        <span style="font-size:14px;font-weight:700;color:#ff8800;">78%</span>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <span style="font-size:11px;color:#aaa;"><i class="fas fa-lightbulb" style="color:#ff8800;margin-right:4px;"></i>Suggested: Sell CE</span>
        <button onclick="al_deploySignal('nifty_bearish_div')" style="background:rgba(170,102,255,0.15);color:#aa66ff;border:1px solid rgba(170,102,255,0.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;font-weight:600;"><i class="fas fa-rocket" style="margin-right:3px;"></i>Deploy</button>
      </div>
    </div>
    <!-- Signal 2 -->
    <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:16px;position:relative;overflow:hidden;">
      <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:#ff8800;"></div>
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px;">
        <span style="background:rgba(255,136,0,0.15);color:#ff8800;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">HEDGE</span>
        <span style="font-size:10px;color:#555;">15 min ago</span>
      </div>
      <h5 style="margin:0 0 6px 0;font-size:14px;color:#fff;font-weight:600;">BANKNIFTY Support Test</h5>
      <p style="margin:0 0 12px 0;font-size:12px;color:#888;line-height:1.5;">Testing key support at 47,500. Volume increasing at support zone. Consider hedging open positions.</p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <div style="flex:1;">
          <div style="font-size:10px;color:#555;margin-bottom:3px;">Confidence</div>
          <div style="background:#222;border-radius:4px;height:6px;overflow:hidden;">
            <div style="width:82%;height:100%;background:linear-gradient(90deg,#00ccff,#00cc88);border-radius:4px;"></div>
          </div>
        </div>
        <span style="font-size:14px;font-weight:700;color:#00ccff;">82%</span>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <span style="font-size:11px;color:#aaa;"><i class="fas fa-lightbulb" style="color:#ff8800;margin-right:4px;"></i>Suggested: Buy PE hedge</span>
        <button onclick="al_deploySignal('bnf_support')" style="background:rgba(170,102,255,0.15);color:#aa66ff;border:1px solid rgba(170,102,255,0.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;font-weight:600;"><i class="fas fa-rocket" style="margin-right:3px;"></i>Deploy</button>
      </div>
    </div>
    <!-- Signal 3 -->
    <div style="background:#111;border:1px solid #2a2a2a;border-radius:10px;padding:16px;position:relative;overflow:hidden;">
      <div style="position:absolute;top:0;left:0;width:4px;height:100%;background:#00c853;"></div>
      <div style="display:flex;justify-content:space-between;align-items:start;margin-bottom:10px;">
        <span style="background:rgba(0,200,83,0.15);color:#00c853;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">BULLISH</span>
        <span style="font-size:10px;color:#555;">32 min ago</span>
      </div>
      <h5 style="margin:0 0 6px 0;font-size:14px;color:#fff;font-weight:600;">RELIANCE Breakout</h5>
      <p style="margin:0 0 12px 0;font-size:12px;color:#888;line-height:1.5;">Breaking above 2990 resistance with high volume. MACD bullish crossover confirmed on daily.</p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
        <div style="flex:1;">
          <div style="font-size:10px;color:#555;margin-bottom:3px;">Confidence</div>
          <div style="background:#222;border-radius:4px;height:6px;overflow:hidden;">
            <div style="width:71%;height:100%;background:linear-gradient(90deg,#00c853,#00cc88);border-radius:4px;"></div>
          </div>
        </div>
        <span style="font-size:14px;font-weight:700;color:#00c853;">71%</span>
      </div>
      <div style="display:flex;align-items:center;justify-content:space-between;">
        <span style="font-size:11px;color:#aaa;"><i class="fas fa-lightbulb" style="color:#00c853;margin-right:4px;"></i>Suggested: Buy</span>
        <button onclick="al_deploySignal('reliance_breakout')" style="background:rgba(170,102,255,0.15);color:#aa66ff;border:1px solid rgba(170,102,255,0.3);border-radius:6px;padding:5px 12px;font-size:11px;cursor:pointer;font-weight:600;"><i class="fas fa-rocket" style="margin-right:3px;"></i>Deploy</button>
      </div>
    </div>
  </div>
</div>

<!-- ===== AI MARKET SCANNER ===== -->
<div style="background:#1a1a1a;border:1px solid #2a2a2a;border-radius:12px;padding:20px;margin-bottom:20px;">
  <h4 style="margin:0 0 16px 0;font-size:14px;color:#00cc88;font-weight:600;">
    <i class="fas fa-search-dollar" style="margin-right:6px;"></i>AI Market Scanner
  </h4>
  <div style="display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap;">
    <button onclick="al_runScan('bullish')" style="background:rgba(0,200,83,0.1);color:#00c853;border:1px solid rgba(0,200,83,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;"><i class="fas fa-arrow-up" style="margin-right:4px;"></i>Bullish Setups</button>
    <button onclick="al_runScan('bearish')" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;"><i class="fas fa-arrow-down" style="margin-right:4px;"></i>Bearish Setups</button>
    <button onclick="al_runScan('momentum')" style="background:rgba(0,204,255,0.1);color:#00ccff;border:1px solid rgba(0,204,255,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;"><i class="fas fa-bolt" style="margin-right:4px;"></i>Momentum Picks</button>
    <button onclick="al_runScan('volume')" style="background:rgba(170,102,255,0.1);color:#aa66ff;border:1px solid rgba(170,102,255,0.3);border-radius:8px;padding:8px 16px;font-size:12px;font-weight:600;cursor:pointer;"><i class="fas fa-chart-bar" style="margin-right:4px;"></i>Volume Spikes</button>
  </div>
  <div id="al_scanResults" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px;">
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="color:#fff;font-weight:600;">TATAMOTORS</span>
        <span style="color:#00c853;font-size:12px;font-weight:600;">+3.2%</span>
      </div>
      <div style="font-size:11px;color:#888;">Bullish engulfing on daily</div>
      <div style="font-size:11px;color:#555;margin-top:4px;">RSI: 58 | Vol: 2.1x avg</div>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="color:#fff;font-weight:600;">BAJFINANCE</span>
        <span style="color:#00c853;font-size:12px;font-weight:600;">+2.8%</span>
      </div>
      <div style="font-size:11px;color:#888;">MACD bullish cross on 1h</div>
      <div style="font-size:11px;color:#555;margin-top:4px;">RSI: 62 | Vol: 1.8x avg</div>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="color:#fff;font-weight:600;">SBIN</span>
        <span style="color:#ff4444;font-size:12px;font-weight:600;">-1.5%</span>
      </div>
      <div style="font-size:11px;color:#888;">Supertrend sell on 15m</div>
      <div style="font-size:11px;color:#555;margin-top:4px;">RSI: 38 | Vol: 1.4x avg</div>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
        <span style="color:#fff;font-weight:600;">HDFCBANK</span>
        <span style="color:#00c853;font-size:12px;font-weight:600;">+1.9%</span>
      </div>
      <div style="font-size:11px;color:#888;">Volume breakout above 20 DMA</div>
      <div style="font-size:11px;color:#555;margin-top:4px;">RSI: 55 | Vol: 3.2x avg</div>
    </div>
  </div>
</div>

<script>
// ===== AL PAGE - ALERTS & AI FUNCTIONS =====
let al_nextId = 5;
let al_alerts = [
  {id:1, symbol:'NIFTY', type:'Price Above', target:22800, status:'ACTIVE', created:'18 Feb, 09:15'},
  {id:2, symbol:'BANKNIFTY', type:'RSI Overbought', target:70, status:'ACTIVE', created:'18 Feb, 09:30'},
  {id:3, symbol:'RELIANCE', type:'Price Below', target:2900, status:'TRIGGERED', created:'17 Feb, 14:22'},
  {id:4, symbol:'TCS', type:'MACD Bullish Cross', target:null, status:'DISABLED', created:'16 Feb, 11:00'}
];

function al_createAlert() {
  var sym = document.getElementById('al_alertSymbol').value.trim().toUpperCase();
  var type = document.getElementById('al_alertType');
  var typeText = type.options[type.selectedIndex].text;
  var target = parseFloat(document.getElementById('al_alertTarget').value) || 0;
  var msg = document.getElementById('al_alertMsg').value.trim();
  var repeat = document.getElementById('al_repeatAlert').checked;
  if (!sym) { alert('Please enter a symbol'); return; }
  var newAlert = {id: al_nextId++, symbol: sym, type: typeText, target: target, status: 'ACTIVE', created: 'Just now'};
  al_alerts.push(newAlert);
  var tbody = document.getElementById('al_alertsBody');
  var tr = document.createElement('tr');
  tr.style.cssText = 'border-bottom:1px solid #1a1a1a;';
  tr.innerHTML = '<td style="padding:10px 12px;color:#555;">#'+newAlert.id+'</td><td style="padding:10px 12px;color:#fff;font-weight:600;">'+sym+'</td><td style="padding:10px 12px;color:#aaa;">'+typeText+'</td><td style="padding:10px 12px;text-align:right;color:#00c853;font-weight:600;">'+(target ? '&#8377;'+target.toLocaleString() : '--')+'</td><td style="padding:10px 12px;text-align:center;"><span style="background:rgba(0,204,136,0.15);color:#00cc88;font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">ACTIVE</span></td><td style="padding:10px 12px;color:#555;font-size:11px;">Just now</td><td style="padding:10px 12px;text-align:center;"><button onclick="al_disableAlert('+newAlert.id+')" style="background:rgba(255,152,0,0.1);color:#ff9800;border:1px solid rgba(255,152,0,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;"><i class="fas fa-pause"></i></button><button onclick="al_deleteAlert('+newAlert.id+')" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;"><i class="fas fa-trash"></i></button></td>';
  tbody.appendChild(tr);
  document.getElementById('al_activeCount').textContent = al_alerts.filter(function(a){return a.status==='ACTIVE';}).length;
  document.getElementById('al_alertSymbol').value = '';
  document.getElementById('al_alertTarget').value = '';
  document.getElementById('al_alertMsg').value = '';
  alert('Alert created for ' + sym + ': ' + typeText + (repeat ? ' (Repeating)' : ''));
}

function al_deleteAlert(id) {
  if (!confirm('Delete alert #' + id + '?')) return;
  al_alerts = al_alerts.filter(function(a){return a.id !== id;});
  var tbody = document.getElementById('al_alertsBody');
  var rows = tbody.querySelectorAll('tr');
  rows.forEach(function(r) { if (r.innerHTML.indexOf('#'+id+'<') > -1) r.remove(); });
  document.getElementById('al_activeCount').textContent = al_alerts.filter(function(a){return a.status==='ACTIVE';}).length;
}

function al_disableAlert(id) {
  var alert_obj = al_alerts.find(function(a){return a.id === id;});
  if (alert_obj) alert_obj.status = 'DISABLED';
  al_refreshAlerts();
}

function al_enableAlert(id) {
  var alert_obj = al_alerts.find(function(a){return a.id === id;});
  if (alert_obj) alert_obj.status = 'ACTIVE';
  al_refreshAlerts();
}

function al_clearTriggered() {
  al_alerts = al_alerts.filter(function(a){return a.status !== 'TRIGGERED';});
  al_refreshAlerts();
}

function al_refreshAlerts() {
  var tbody = document.getElementById('al_alertsBody');
  if (!tbody) return;
  tbody.innerHTML = '';
  al_alerts.forEach(function(a) {
    var statusColor = a.status === 'ACTIVE' ? '#00cc88' : a.status === 'TRIGGERED' ? '#ff8800' : '#888';
    var statusBg = a.status === 'ACTIVE' ? 'rgba(0,204,136,0.15)' : a.status === 'TRIGGERED' ? 'rgba(255,136,0,0.15)' : 'rgba(102,102,102,0.15)';
    var actions = '';
    if (a.status === 'ACTIVE') actions += '<button onclick="al_disableAlert('+a.id+')" style="background:rgba(255,152,0,0.1);color:#ff9800;border:1px solid rgba(255,152,0,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;"><i class="fas fa-pause"></i></button>';
    if (a.status === 'DISABLED') actions += '<button onclick="al_enableAlert('+a.id+')" style="background:rgba(0,204,136,0.1);color:#00cc88;border:1px solid rgba(0,204,136,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;margin-right:4px;"><i class="fas fa-play"></i></button>';
    actions += '<button onclick="al_deleteAlert('+a.id+')" style="background:rgba(255,68,68,0.1);color:#ff4444;border:1px solid rgba(255,68,68,0.3);border-radius:4px;padding:4px 8px;font-size:10px;cursor:pointer;"><i class="fas fa-trash"></i></button>';
    var tr = document.createElement('tr');
    tr.style.cssText = 'border-bottom:1px solid #1a1a1a;';
    tr.innerHTML = '<td style="padding:10px 12px;color:#555;">#'+a.id+'</td><td style="padding:10px 12px;color:#fff;font-weight:600;">'+a.symbol+'</td><td style="padding:10px 12px;color:#aaa;">'+a.type+'</td><td style="padding:10px 12px;text-align:right;color:#00c853;font-weight:600;">'+(a.target ? '&#8377;'+a.target.toLocaleString() : '--')+'</td><td style="padding:10px 12px;text-align:center;"><span style="background:'+statusBg+';color:'+statusColor+';font-size:10px;font-weight:600;padding:3px 10px;border-radius:6px;">'+a.status+'</span></td><td style="padding:10px 12px;color:#555;font-size:11px;">'+a.created+'</td><td style="padding:10px 12px;text-align:center;">'+actions+'</td>';
    tbody.appendChild(tr);
  });
  document.getElementById('al_activeCount').textContent = al_alerts.filter(function(a){return a.status==='ACTIVE';}).length;
}

function al_deploySignal(signalId) {
  if (!confirm('Deploy this AI signal as a trading strategy?')) return;
  alert('Signal deployed! Check Strategy Creation page to customize and execute.');
  showPage('strategyCreationPage');
}

function al_runScan(scanType) {
  var scanNames = {bullish:'Bullish Setups', bearish:'Bearish Setups', momentum:'Momentum Picks', volume:'Volume Spikes'};
  var container = document.getElementById('al_scanResults');
  if (!container) return;
  container.innerHTML = '<div style="text-align:center;padding:30px;color:#555;grid-column:1/-1;"><i class="fas fa-spinner fa-spin" style="font-size:24px;margin-bottom:10px;display:block;color:#00ccff;"></i>Scanning for ' + scanNames[scanType] + '...</div>';
  setTimeout(function() {
    var demoResults = {
      bullish: [{sym:'TATAMOTORS',chg:'+3.2%',desc:'Bullish engulfing on daily',rsi:58,vol:'2.1x'},{sym:'BAJFINANCE',chg:'+2.8%',desc:'MACD bullish cross on 1h',rsi:62,vol:'1.8x'},{sym:'HDFCBANK',chg:'+1.9%',desc:'Volume breakout above 20 DMA',rsi:55,vol:'3.2x'},{sym:'TITAN',chg:'+2.1%',desc:'EMA 9/21 bullish crossover',rsi:61,vol:'1.5x'}],
      bearish: [{sym:'SBIN',chg:'-1.5%',desc:'Supertrend sell on 15m',rsi:38,vol:'1.4x'},{sym:'WIPRO',chg:'-2.1%',desc:'Bearish MACD crossover',rsi:32,vol:'1.7x'},{sym:'ASIANPAINT',chg:'-1.8%',desc:'Breaking below support',rsi:35,vol:'2.0x'}],
      momentum: [{sym:'ADANIENT',chg:'+4.5%',desc:'Strong momentum with RSI > 65',rsi:72,vol:'3.5x'},{sym:'TATASTEEL',chg:'+3.1%',desc:'Sector rotation into metals',rsi:68,vol:'2.8x'},{sym:'ITC',chg:'+1.2%',desc:'Steady uptrend, low volatility',rsi:59,vol:'1.3x'}],
      volume: [{sym:'RELIANCE',chg:'+0.8%',desc:'3x average volume spike',rsi:52,vol:'3.0x'},{sym:'JSWSTEEL',chg:'+2.4%',desc:'Heavy institutional buying',rsi:64,vol:'4.2x'},{sym:'NTPC',chg:'+1.1%',desc:'Block deal detected',rsi:51,vol:'5.1x'}]
    };
    var results = demoResults[scanType] || demoResults.bullish;
    container.innerHTML = '';
    results.forEach(function(r) {
      var chgColor = r.chg.startsWith('+') ? '#00c853' : '#ff4444';
      container.innerHTML += '<div style="background:#111;border:1px solid #222;border-radius:8px;padding:14px;"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;"><span style="color:#fff;font-weight:600;">'+r.sym+'</span><span style="color:'+chgColor+';font-size:12px;font-weight:600;">'+r.chg+'</span></div><div style="font-size:11px;color:#888;">'+r.desc+'</div><div style="font-size:11px;color:#555;margin-top:4px;">RSI: '+r.rsi+' | Vol: '+r.vol+' avg</div></div>';
    });
  }, 1500);
}
</script>

        </div>

    <!-- ===== LOG PAGE ===== -->
    <div class="content-page hidden" id="logPage" style="content-visibility:auto;contain-intrinsic-size:auto 800px;">
  <button onclick="showPage('openPositionsPage')" style="background:none;border:1px solid #333;border-radius:8px;padding:6px 14px;color:#aaa;font-size:12px;cursor:pointer;margin-bottom:16px;display:inline-flex;align-items:center;gap:6px;transition:all 0.2s;" onmouseenter="this.style.borderColor='#00ccff';this.style.color='#00ccff'" onmouseleave="this.style.borderColor='#333';this.style.color='#aaa'">
    <i class="fas fa-arrow-left"></i> Back to Dashboard
  </button>
  <h2 style="margin:0 0 20px 0;color:#00ccff;display:flex;align-items:center;gap:10px;">
    <i class="fas fa-clipboard-list"></i> Activity Log
  </h2>

  <!-- Log Tabs -->
  <div style="display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;">
    <button onclick="switchLogTab('all')" id="logTabAll" class="log-tab-btn" style="padding:8px 18px;background:linear-gradient(135deg,#0077ff,#0055cc);border:none;color:#fff;border-radius:5px;cursor:pointer;font-size:13px;font-weight:600;">All Logs</button>
    <button onclick="switchLogTab('trade')" id="logTabTrade" class="log-tab-btn" style="padding:8px 18px;background:#222;border:1px solid #333;color:#aaa;border-radius:5px;cursor:pointer;font-size:13px;">Trade Log</button>
    <button onclick="switchLogTab('order')" id="logTabOrder" class="log-tab-btn" style="padding:8px 18px;background:#222;border:1px solid #333;color:#aaa;border-radius:5px;cursor:pointer;font-size:13px;">Order Log</button>
    <button onclick="switchLogTab('strategy')" id="logTabStrategy" class="log-tab-btn" style="padding:8px 18px;background:#222;border:1px solid #333;color:#aaa;border-radius:5px;cursor:pointer;font-size:13px;">Strategy Log</button>
    <button onclick="switchLogTab('system')" id="logTabSystem" class="log-tab-btn" style="padding:8px 18px;background:#222;border:1px solid #333;color:#aaa;border-radius:5px;cursor:pointer;font-size:13px;">System Log</button>
    <button onclick="switchLogTab('alert')" id="logTabAlert" class="log-tab-btn" style="padding:8px 18px;background:#222;border:1px solid #333;color:#aaa;border-radius:5px;cursor:pointer;font-size:13px;">Alert Log</button>
  </div>

  <!-- Controls -->
  <div style="display:flex;gap:10px;margin-bottom:15px;align-items:center;flex-wrap:wrap;">
    <input type="text" id="logSearchInput" placeholder="Search logs..." oninput="filterLogs()" style="flex:1;min-width:200px;padding:8px 12px;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:5px;font-size:13px;">
    <select id="logLevelFilter" onchange="filterLogs()" style="padding:8px 12px;background:#1a1a1a;color:#fff;border:1px solid #333;border-radius:5px;font-size:13px;">
      <option value="all">All Levels</option>
      <option value="INFO">INFO</option>
      <option value="SUCCESS">SUCCESS</option>
      <option value="WARNING">WARNING</option>
      <option value="ERROR">ERROR</option>
    </select>
    <button onclick="clearLogs()" style="padding:8px 16px;background:#ff4444;border:none;color:#fff;border-radius:5px;cursor:pointer;font-size:13px;"><i class="fas fa-trash"></i> Clear</button>
    <button onclick="exportLogs()" style="padding:8px 16px;background:#00aa66;border:none;color:#fff;border-radius:5px;cursor:pointer;font-size:13px;"><i class="fas fa-download"></i> Export</button>
  </div>

  <!-- Log Display -->
  <div id="logContainer" style="background:#0a0a0a;border:1px solid #222;border-radius:8px;padding:0;max-height:calc(100vh - 300px);overflow-y:auto;font-family:'Consolas','Courier New',monospace;">
    <table style="width:100%;border-collapse:collapse;font-size:12px;">
      <thead style="position:sticky;top:0;background:#111;z-index:1;">
        <tr>
          <th style="padding:10px 12px;text-align:left;color:#888;border-bottom:1px solid #222;width:160px;">Time</th>
          <th style="padding:10px 12px;text-align:left;color:#888;border-bottom:1px solid #222;width:70px;">Level</th>
          <th style="padding:10px 12px;text-align:left;color:#888;border-bottom:1px solid #222;width:90px;">Category</th>
          <th style="padding:10px 12px;text-align:left;color:#888;border-bottom:1px solid #222;">Message</th>
        </tr>
      </thead>
      <tbody id="logTableBody">
      </tbody>
    </table>
    <div id="logEmptyState" style="text-align:center;padding:60px 20px;color:#555;">
      <i class="fas fa-clipboard-list" style="font-size:48px;margin-bottom:15px;display:block;"></i>
      <p style="font-size:14px;">No log entries yet. Activity will appear here as you use the app.</p>
    </div>
  </div>

  <!-- Log Stats -->
  <div style="display:flex;gap:15px;margin-top:15px;flex-wrap:wrap;">
    <div style="background:#111;border:1px solid #222;border-radius:5px;padding:10px 15px;font-size:12px;color:#888;">
      Total: <span id="logCountTotal" style="color:#fff;font-weight:600;">0</span>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:5px;padding:10px 15px;font-size:12px;color:#888;">
      Info: <span id="logCountInfo" style="color:#00ccff;font-weight:600;">0</span>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:5px;padding:10px 15px;font-size:12px;color:#888;">
      Success: <span id="logCountSuccess" style="color:#00c853;font-weight:600;">0</span>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:5px;padding:10px 15px;font-size:12px;color:#888;">
      Warning: <span id="logCountWarning" style="color:#ff8800;font-weight:600;">0</span>
    </div>
    <div style="background:#111;border:1px solid #222;border-radius:5px;padding:10px 15px;font-size:12px;color:#888;">
      Error: <span id="logCountError" style="color:#ff4444;font-weight:600;">0</span>
    </div>
  </div>
</div>

<script>
// ===== LOG PAGE FUNCTIONALITY =====
let appLogs = [];
let currentLogTab = 'all';

function addLog(level, category, message) {
    const now = new Date();
    const timeStr = now.toLocaleString('en-IN', {day:'2-digit',month:'short',year:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
    const entry = { time: timeStr, timestamp: now.getTime(), level: level.toUpperCase(), category: category.toLowerCase(), message: message };
    appLogs.unshift(entry);
    if (appLogs.length > 1000) appLogs.pop();
    renderLogs();
}

function switchLogTab(tab) {
    currentLogTab = tab;
    document.querySelectorAll('.log-tab-btn').forEach(function(btn) {
        btn.style.background = '#222';
        btn.style.border = '1px solid #333';
        btn.style.color = '#aaa';
    });
    var activeBtn = document.getElementById('logTab' + tab.charAt(0).toUpperCase() + tab.slice(1));
    if (activeBtn) {
        activeBtn.style.background = 'linear-gradient(135deg,#0077ff,#0055cc)';
        activeBtn.style.border = 'none';
        activeBtn.style.color = '#fff';
    }
    renderLogs();
}

function filterLogs() { renderLogs(); }

function renderLogs() {
    var tbody = document.getElementById('logTableBody');
    var empty = document.getElementById('logEmptyState');
    var search = (document.getElementById('logSearchInput').value || '').toLowerCase();
    var levelFilter = document.getElementById('logLevelFilter').value;

    var filtered = appLogs.filter(function(e) {
        if (currentLogTab !== 'all' && e.category !== currentLogTab) return false;
        if (levelFilter !== 'all' && e.level !== levelFilter) return false;
        if (search && e.message.toLowerCase().indexOf(search) === -1 && e.category.toLowerCase().indexOf(search) === -1) return false;
        return true;
    });

    if (filtered.length === 0) {
        tbody.innerHTML = '';
        empty.style.display = 'block';
    } else {
        empty.style.display = 'none';
        var html = '';
        var colorMap = {INFO:'#00ccff',SUCCESS:'#00c853',WARNING:'#ff8800',ERROR:'#ff4444'};
        filtered.forEach(function(e) {
            var c = colorMap[e.level] || '#888';
            html += '<tr style="border-bottom:1px solid #1a1a1a;">';
            html += '<td style="padding:6px 12px;color:#666;white-space:nowrap;">' + e.time + '</td>';
            html += '<td style="padding:6px 12px;"><span style="color:' + c + ';font-weight:600;font-size:11px;">' + e.level + '</span></td>';
            html += '<td style="padding:6px 12px;color:#888;text-transform:capitalize;">' + e.category + '</td>';
            html += '<td style="padding:6px 12px;color:#ccc;word-break:break-word;">' + e.message + '</td>';
            html += '</tr>';
        });
        tbody.innerHTML = html;
    }

    // Update counts
    var counts = {INFO:0,SUCCESS:0,WARNING:0,ERROR:0};
    appLogs.forEach(function(e) { if (counts[e.level] !== undefined) counts[e.level]++; });
    document.getElementById('logCountTotal').textContent = appLogs.length;
    document.getElementById('logCountInfo').textContent = counts.INFO;
    document.getElementById('logCountSuccess').textContent = counts.SUCCESS;
    document.getElementById('logCountWarning').textContent = counts.WARNING;
    document.getElementById('logCountError').textContent = counts.ERROR;
}

function clearLogs() {
    if (confirm('Clear all logs?')) {
        appLogs = [];
        renderLogs();
    }
}

function exportLogs() {
    if (appLogs.length === 0) { alert('No logs to export'); return; }
    var csv = 'Time,Level,Category,Message\n';
    appLogs.forEach(function(e) {
        csv += '"' + e.time + '","' + e.level + '","' + e.category + '","' + e.message.replace(/"/g,'""') + '"\n';
    });
    var blob = new Blob([csv], {type:'text/csv'});
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'mukesh_algo_logs_' + new Date().toISOString().slice(0,10) + '.csv';
    a.click();
}

// Add system startup log
addLog('INFO', 'system', 'MUKESH ALGO Web App initialized');
addLog('INFO', 'system', 'Waiting for broker connection...');
</script>

    </div>

    <!-- ===== ENHANCED ADD POSITION MODAL ===== -->
    <div id="addPositionModal" class="modal" onclick="outsideCloseAddModal(event)">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="modalSymbolTitle">Add Position</h3>
                <button onclick="closeAddModal()">&#x2716;</button>
            </div>

            <div>
                <div style="margin-bottom:15px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Symbol</label>
                    <input id="positionSymbol" placeholder="Enter stock symbol (e.g., RELIANCE)">
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Order Type</label>
                        <select id="orderType">
                            <option value="BUY">BUY</option>
                            <option value="SELL">SELL</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Order Condition</label>
                        <select id="orderCondition">
                            <option value="Intraday">Intraday</option>
                            <option value="Positional">Positional</option>
                            <option value="BO">BO (Bracket Order)</option>
                            <option value="St">St (Stop Loss)</option>
                            <option value="MSL">MSL (Multiple Stop Loss)</option>
                        </select>
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Buy Qty</label>
                        <input id="buyQty" type="number" placeholder="Buy Qty" value="0">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Sell Qty</label>
                        <input id="sellQty" type="number" placeholder="Sell Qty" value="0">
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Entry Price</label>
                        <input id="entryPrice" type="number" placeholder="Entry Price">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Current Price</label>
                        <input id="currentPrice" type="number" placeholder="Current Price">
                    </div>
                </div>

                <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px">
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Buy Avg Price</label>
                        <input id="buyAvgPrice" type="number" placeholder="Buy Avg Price">
                    </div>
                    <div>
                        <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Sell Avg Price</label>
                        <input id="sellAvgPrice" type="number" placeholder="Sell Avg Price">
                    </div>
                </div>

                <!-- ===== ENABLE/DISABLE OPTIONS ===== -->
                <div style="margin: 20px 0; padding: 15px; background: #222; border-radius: 5px;">
                    <h4 style="color: var(--accent-color); margin-bottom: 15px;">
                        <i class="fas fa-toggle-on"></i> Enable/Disable Options
                    </h4>

                    <div class="enable-option" onclick="toggleEnableOption('positionSettings')">
                        <div><i class="fas fa-cog"></i> Position Settings</div>
                        <div class="enable-status enabled" id="positionSettingsStatus"><i class="fas fa-check"></i></div>
                    </div>

                    <div class="enable-option" onclick="toggleEnableOption('partitionSettings')">
                        <div><i class="fas fa-layer-group"></i> Partition Settings</div>
                        <div class="enable-status enabled" id="partitionSettingsStatus"><i class="fas fa-check"></i></div>
                    </div>

                    <div class="enable-option" onclick="toggleEnableOption('trailingSL')">
                        <div><i class="fas fa-chart-line"></i> Trailing Stop Loss</div>
                        <div class="enable-status enabled" id="trailingSLStatus"><i class="fas fa-check"></i></div>
                    </div>

                    <div class="enable-option" onclick="toggleEnableOption('profitLock')">
                        <div><i class="fas fa-lock"></i> Profit Lock</div>
                        <div class="enable-status disabled" id="profitLockStatus"><i class="fas fa-times"></i></div>
                    </div>
                </div>

                <!-- ===== POSITION SETTINGS SECTION ===== -->
                <div class="position-section" id="positionSettingsSection">
                    <div class="position-section-header" onclick="togglePositionSection()">
                        <h4><i class="fas fa-cog"></i> Position Settings</h4>
                        <button class="position-section-toggle" id="positionSectionToggle">
                            <i class="fas fa-chevron-up"></i> Collapse
                        </button>
                    </div>

                    <div class="position-section-body" id="positionSectionBody">
                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleOrderType" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Order Type</span>
                            </div>
                            <div class="position-controls">
                                <select id="positionOrderType" class="section-input">
                                    <option value="limit">Limit</option>
                                    <option value="market">Market</option>
                                    <option value="sl">Stop Loss (SL)</option>
                                    <option value="market_sl">Market Stop Loss</option>
                                </select>
                            </div>
                        </div>

                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="togglePart" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Part</span>
                            </div>
                            <div class="position-controls">
                                <select id="positionPart" class="section-input">
                                    <option value="buy">Buy</option>
                                    <option value="sell">Sell</option>
                                </select>
                            </div>
                        </div>

                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleQty" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Quantity</span>
                            </div>
                            <div class="position-controls">
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <input id="positionQty" type="number" placeholder="Buy Qty" value="10" class="section-input" style="flex: 1;">
                                    <input id="positionSellQty" type="number" placeholder="Sell Qty" value="0" class="section-input" style="flex: 1;">
                                </div>
                            </div>
                        </div>

                        <div class="position-row" id="trailingSLRow">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleTrailingSL" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Trailing SL</span>
                            </div>
                            <div class="position-controls">
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <select id="trailingSLType" style="flex: 1;">
                                        <option value="point">Point</option>
                                        <option value="price">Price</option>
                                        <option value="spot">Spot</option>
                                        <option value="fut">Futures</option>
                                        <option value="mtm">MTM</option>
                                        <option value="indicator">Indicator Based</option>
                                    </select>
                                    <input id="trailingSLValue" type="number" placeholder="Value" style="flex: 1;" value="20">
                                </div>
                            </div>
                        </div>

                        <div id="indicatorOptions" class="indicator-options" style="display:none;">
                            <div>
                                <label class="indicator-label">Period</label>
                                <input id="indicatorPeriod" type="number" placeholder="Period" class="indicator-input" value="14">
                            </div>
                            <div>
                                <label class="indicator-label">Condition</label>
                                <select id="indicatorCondition" class="indicator-input">
                                    <option value="close">Close</option>
                                    <option value="cross">Cross</option>
                                </select>
                            </div>
                        </div>

                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleTarget" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Target</span>
                            </div>
                            <div class="position-controls">
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <select id="targetType" style="flex: 1;">
                                        <option value="point">Point</option>
                                        <option value="price">Price</option>
                                        <option value="spot">Spot</option>
                                        <option value="fut">Futures</option>
                                        <option value="mtm">MTM</option>
                                    </select>
                                    <input id="targetValue" type="number" placeholder="Target Value" style="flex: 1;" value="50">
                                </div>
                            </div>
                        </div>

                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleExit" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Exit</span>
                            </div>
                            <div class="position-controls">
                                <div style="display: flex; gap: 10px; width: 100%;">
                                    <select id="exitType" style="flex: 1;">
                                        <option value="point">Point</option>
                                        <option value="price">Price</option>
                                        <option value="spot">Spot</option>
                                        <option value="fut">Futures</option>
                                        <option value="mtm">MTM</option>
                                    </select>
                                    <input id="exitValue" type="number" placeholder="Exit Value" style="flex: 1;" value="30">
                                </div>
                            </div>
                        </div>

                        <div class="position-row" id="profitLockRow">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleProfitLock" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Profit Lock</span>
                            </div>
                            <div class="position-controls">
                                <input id="profitLock" type="number" placeholder="Profit Lock Price" class="section-input">
                            </div>
                        </div>

                        <div class="position-row">
                            <div class="position-toggle">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="toggleProfitGap" checked>
                                    <span class="toggle-slider"></span>
                                </label>
                                <span class="toggle-label">Profit Gap</span>
                            </div>
                            <div class="position-controls">
                                <input id="profitGap" type="number" placeholder="Profit Gap Price" class="section-input">
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="toggleAllPositionSettings(true)" style="flex:1; padding:10px; background:#00aa66; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                                <i class="fas fa-toggle-on"></i> All ON
                            </button>
                            <button onclick="toggleAllPositionSettings(false)" style="flex:1; padding:10px; background:#ff4444; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                                <i class="fas fa-toggle-off"></i> All OFF
                            </button>
                            <button onclick="resetPositionSettings()" style="flex:1; padding:10px; background:#0077ff; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ===== PARTITION & ADD QUANTITY SECTION ===== -->
                <div class="partition-section" id="partitionSettingsSection">
                    <div class="partition-section-header" onclick="togglePartitionSection()">
                        <h4><i class="fas fa-layer-group"></i> Partition &amp; Add Quantity</h4>
                        <button class="partition-section-toggle" id="partitionSectionToggle">
                            <i class="fas fa-chevron-up"></i> Collapse
                        </button>
                    </div>

                    <div class="partition-section-body" id="partitionSectionBody">
                        <div class="partition-grid">
                            <div class="partition-column">
                                <div class="partition-item">
                                    <h5><i class="fas fa-chart-pie"></i> Partition Square Off</h5>
                                    <div class="partition-row">
                                        <div>
                                            <label class="indicator-label">Quantity (Number)</label>
                                            <input id="partitionSquareOffQty" type="number" placeholder="0" class="indicator-input" value="2">
                                        </div>
                                        <div>
                                            <label class="indicator-label">Price</label>
                                            <input id="partitionSquareOffPrice" type="number" placeholder="0.00" class="indicator-input">
                                        </div>
                                    </div>
                                </div>

                                <div class="partition-item">
                                    <h5><i class="fas fa-plus-circle"></i> Add Quantity</h5>
                                    <div class="partition-row">
                                        <div>
                                            <label class="indicator-label">Quantity (Number)</label>
                                            <input id="addQty" type="number" placeholder="0" class="indicator-input" value="5">
                                        </div>
                                        <div>
                                            <label class="indicator-label">Price</label>
                                            <input id="addQtyPrice" type="number" placeholder="0.00" class="indicator-input">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="partition-column">
                                <div class="partition-item">
                                    <h5><i class="fas fa-sliders-h"></i> Additional Settings</h5>
                                    <div style="display: flex; flex-direction: column; gap: 10px;">
                                        <div>
                                            <label class="indicator-label">Max Partition Count</label>
                                            <input id="maxPartitionCount" type="number" placeholder="5" class="indicator-input" value="5">
                                        </div>
                                        <div>
                                            <label class="indicator-label">Auto Square Off %</label>
                                            <input id="autoSquareOffPercent" type="number" placeholder="10" class="indicator-input" value="10">
                                        </div>
                                        <div>
                                            <label class="indicator-label">Re-entry Attempts</label>
                                            <input id="reentryAttempts" type="number" placeholder="3" class="indicator-input" value="3">
                                        </div>
                                    </div>
                                </div>

                                <div class="partition-item">
                                    <h5><i class="fas fa-calculator"></i> Quick Calculate</h5>
                                    <div style="text-align: center;">
                                        <button onclick="calculatePositionSizing()" style="width:100%; padding:10px; background:#0077ff; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                                            Calculate Position
                                        </button>
                                        <div id="calculationResult" style="font-size:14px; color:#aaa; padding:10px; margin-top:10px;">
                                            Enter values to calculate
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom:20px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Source</label>
                    <select id="positionSource">
                        <option value="LIVE">LIVE</option>
                        <option value="PAPER">PAPER</option>
                        <option value="SIMULATOR">SIMULATOR</option>
                    </select>
                </div>

                <button class="full-btn success" onclick="addPosition()">Add Position</button>
            </div>
        </div>
    </div>

    <!-- ===== ACTION MODAL ===== -->
    <div id="actionModal" class="modal" onclick="outsideCloseActionModal(event)">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="actionModalSymbolTitle">Position Actions</h3>
                <button onclick="closeActionModal()">&#x2716;</button>
            </div>

            <div class="tabs">
                <button class="active" onclick="switchActionTab(event,'modify')">Modify</button>
                <button onclick="switchActionTab(event,'exit')">Exit</button>
                <button onclick="switchActionTab(event,'existingCode')">Existing Code</button>
                <button onclick="switchActionTab(event,'settings')">Settings</button>
                <button onclick="switchActionTab(event,'partition')">Partition</button>
            </div>

            <div id="modify" class="tab-content active">
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Stop Loss</label>
                    <input id="modifyStopLoss" type="number" placeholder="Stop Loss Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Target</label>
                    <input id="modifyTarget" type="number" placeholder="Target Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Trailing SL</label>
                    <input id="modifyTrailingSL" type="number" placeholder="Trailing SL Points">
                </div>
                <button class="full-btn success" onclick="modifyPosition()">Update Position</button>
            </div>

            <div id="exit" class="tab-content">
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Quantity</label>
                    <input id="exitQty" type="number" placeholder="Quantity to Exit">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Exit Price</label>
                    <input id="exitPrice" type="number" placeholder="Exit Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Exit Reason</label>
                    <select id="exitReason">
                        <option value="target_hit">Target Hit</option>
                        <option value="stop_loss">Stop Loss Hit</option>
                        <option value="manual">Manual Exit</option>
                        <option value="trailing_sl">Trailing SL Hit</option>
                    </select>
                </div>
                <button class="full-btn danger" onclick="exitPosition()">Exit Position</button>
            </div>

            <div id="existingCode" class="tab-content">
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Strategy Code</label>
                    <textarea id="strategyCode" placeholder="Enter your trading strategy code here..."></textarea>
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Current Code Preview</label>
                    <div class="code-display" id="currentCodeDisplay">
                        <div class="code-line">// Sample Trading Strategy</div>
                        <div class="code-line">if (rsi &lt; 30 &amp;&amp; macd_signal &gt; 0) {</div>
                        <div class="code-line">   entryPrice = currentPrice;</div>
                        <div class="code-line">   stopLoss = entryPrice * 0.98;</div>
                        <div class="code-line">   target = entryPrice * 1.02;</div>
                        <div class="code-line">}</div>
                    </div>
                </div>
                <div style="display:flex;gap:10px">
                    <button class="full-btn info" onclick="saveStrategyCode()">Save Code</button>
                    <button class="full-btn" onclick="testStrategyCode()" style="background:#ff9900">Test Code</button>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Alert Price</label>
                    <input id="alertPrice" type="number" placeholder="Alert Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Auto Square Off Time</label>
                    <input id="autoSquareOff" type="time" value="15:15">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Max Loss Amount</label>
                    <input id="maxLoss" type="number" placeholder="Maximum Loss Amount">
                </div>
                <button class="full-btn info" onclick="saveSettings()">Save Settings</button>
            </div>

            <div id="partition" class="tab-content">
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Partition Square Off Qty</label>
                    <input id="actionPartitionSquareOffQty" type="number" placeholder="Quantity">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Partition Square Off Price</label>
                    <input id="actionPartitionSquareOffPrice" type="number" placeholder="Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Add Quantity</label>
                    <input id="actionAddQty" type="number" placeholder="Quantity">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Add Qty Price</label>
                    <input id="actionAddQtyPrice" type="number" placeholder="Price">
                </div>
                <div style="margin-bottom:12px">
                    <label style="display:block;margin-bottom:8px;font-size:14px;color:#aaa">Partition Action</label>
                    <select id="partitionAction">
                        <option value="square_off">Square Off Partition</option>
                        <option value="add_qty">Add Quantity</option>
                        <option value="both">Both</option>
                    </select>
                </div>
                <button class="full-btn success" onclick="executePartitionAction()">Execute Partition</button>
            </div>
        </div>
    </div>

    <!-- ===== SCREENER POPUP MODAL ===== -->
    <div id="screenerPopupModal" class="modal" onclick="closeScreenerPopup(event)">
        <div class="modal-box" style="width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-search"></i> Stock Screener</h3>
                <button onclick="closeScreenerPopup()">&#x2716;</button>
            </div>

            <div style="display: flex; gap: 10px; margin: 15px 0;">
                <button onclick="openChartink()" style="flex:1; padding:12px; background:#ff9900; border:none; color:#fff; border-radius:5px; cursor:pointer; font-weight:bold;">
                    <i class="fas fa-external-link-alt"></i> Open Chartink
                </button>
            </div>

            <div style="background: #333; padding: 15px; border-radius: 5px; margin: 15px 0;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">
                    <i class="fas fa-sliders-h"></i> Indicator Based Screener
                </h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <select id="indicatorSelect" style="padding:8px; background:#444; color:#fff; border:none; border-radius:5px;">
                        <option>Select Indicator</option>
                        <option>RSI (Relative Strength Index)</option>
                        <option>MACD (Moving Average Convergence Divergence)</option>
                        <option>Bollinger Bands</option>
                        <option>Moving Averages</option>
                        <option>Stochastic Oscillator</option>
                    </select>
                    <input id="indicatorValue" type="number" placeholder="Value" style="padding:8px; background:#444; color:#fff; border:none; border-radius:5px;">
                </div>
                <button onclick="deployIndicatorScreener()" style="margin-top:10px; padding:8px 15px; background:#00aa66; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-play"></i> Deploy Screener
                </button>
            </div>

            <div style="background: #333; padding: 15px; border-radius: 5px; margin: 15px 0;">
                <h4 style="color: var(--accent-color); margin-bottom: 10px;">
                    <i class="fas fa-save"></i> Saved Screeners
                </h4>
                <div id="savedScreenersList" style="margin-bottom:10px;">
                    <div style="padding:8px; background:#444; margin:5px 0; border-radius:3px; cursor:pointer;">
                        <i class="fas fa-chart-line"></i> RSI Oversold Strategy
                    </div>
                    <div style="padding:8px; background:#444; margin:5px 0; border-radius:3px; cursor:pointer;">
                        <i class="fas fa-chart-line"></i> MACD Crossover Strategy
                    </div>
                </div>
                <button onclick="deploySavedScreener()" style="margin-top:5px; padding:8px 15px; background:#0077ff; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-play"></i> Deploy Saved Screener
                </button>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="createNewScreener()" style="flex:1; padding:10px; background:#9d4edd; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                    <i class="fas fa-plus"></i> Create New Screener
                </button>
            </div>
        </div>
    </div>

    <!-- ===== STRATEGY CREATION POPUP ===== -->
    <div id="strategyCreationPopup" class="modal" onclick="closeStrategyPopup(event)">
        <div class="modal-box" style="width: 600px;">
            <div class="modal-header">
                <h3><i class="fas fa-chess-board"></i> Strategy Creation</h3>
                <button onclick="closeStrategyPopup()">&#x2716;</button>
            </div>

            <div style="text-align: center; padding: 20px 0;">
                <h4 style="color: var(--accent-color); margin-bottom: 20px;">Select Strategy Platform</h4>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <button onclick="openOpstra()" style="padding:15px; background:linear-gradient(135deg, #0077ff, #0055cc); border:none; color:#fff; border-radius:10px; cursor:pointer;">
                        <i class="fas fa-chart-pie"></i><br>
                        <strong>Opstra</strong><br>
                        <small>Options Strategy</small>
                    </button>

                    <button onclick="openSensibull()" style="padding:15px; background:linear-gradient(135deg, #00aa66, #008800); border:none; color:#fff; border-radius:10px; cursor:pointer;">
                        <i class="fas fa-bullhorn"></i><br>
                        <strong>Sensibull</strong><br>
                        <small>Options Trading</small>
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button onclick="openMarketPlace()" style="padding:15px; background:linear-gradient(135deg, #ff9900, #cc7700); border:none; color:#fff; border-radius:10px; cursor:pointer;">
                        <i class="fas fa-store"></i><br>
                        <strong>Market Place</strong><br>
                        <small>Strategy Marketplace</small>
                    </button>

                    <button onclick="openCreateStrategy()" style="padding:15px; background:linear-gradient(135deg, #9d4edd, #7b2cbf); border:none; color:#fff; border-radius:10px; cursor:pointer;">
                        <i class="fas fa-plus-circle"></i><br>
                        <strong>Create Strategy</strong><br>
                        <small>Custom Strategy Builder</small>
                    </button>
                </div>
            </div>

            <div style="background: #333; padding: 15px; border-radius: 5px; margin-top: 15px;">
                <h5 style="color: #aaa; margin-bottom: 10px;">Quick Actions:</h5>
                <div style="display: flex; gap: 10px;">
                    <button onclick="backtestStrategy()" style="flex:1; padding:8px; background:#0077ff; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                        <i class="fas fa-history"></i> Backtest
                    </button>
                    <button onclick="optimizeStrategy()" style="flex:1; padding:8px; background:#00aa66; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                        <i class="fas fa-cogs"></i> Optimize
                    </button>
                    <button onclick="shareStrategy()" style="flex:1; padding:8px; background:#9d4edd; border:none; color:#fff; border-radius:5px; cursor:pointer;">
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>
        </div>
    </div>


    <script src="/static/app.js"></script>
</body>
</html>
